.\" Automatically generated by Pod::Man v1.37, Pod::Parser v1.32
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sh \" Subsection heading
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  | will give a
.\" real vertical bar.  \*(C+ will give a nicer C++.  Capital omega is used to
.\" do unbreakable dashes and therefore won't be available.  \*(C` and \*(C'
.\" expand to `' in nroff, nothing in troff, for use with C<>.
.tr \(*W-|\(bv\*(Tr
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.Sh), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.if \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.\"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.hy 0
.if n .na
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "RFLASH.1 1"
.TH RFLASH.1 1 "2013-02-06" "perl v5.8.8" "User Contributed Perl Documentation"
.SH "Name"
.IX Header "Name"
\&\fBrflash\fR \- Performs Licensed Internal Code (\s-1LIC\s0) update support for HMC-attached \s-1POWER5\s0 and \s-1POWER6\s0 Systems, and \s-1POWER7\s0 systems using Direct \s-1FSP\s0 management. 
.SH "\fBSynopsis\fP"
.IX Header "Synopsis"
\&\fBrflash\fR [\fB\-h\fR|\fB\-\-help\fR | \fB\-v\fR|\fB\-\-version\fR]
.Sh "\s-1PPC\s0 (with \s-1HMC\s0) specific:"
.IX Subsection "PPC (with HMC) specific:"
\&\fBrflash\fR \fInoderange\fR \fB\-p\fR \fIdirectory\fR {\fB\-\-activate\fR \fBconcurrent\fR|\fBdisruptive\fR} [\fB\-V\fR|\fB\-\-verbose\fR]
.PP
\&\fBrflash\fR \fInoderange\fR {\fB\-\-commit\fR|\fB\-\-recover\fR} [\fB\-V\fR|\fB\-\-verbose\fR]
.Sh "\s-1PPC\s0 (without \s-1HMC\s0, using Direct \s-1FSP\s0 Management) specific:"
.IX Subsection "PPC (without HMC, using Direct FSP Management) specific:"
\&\fBrflash\fR \fInoderange\fR \fB\-p\fR \fIdirectory\fR \fB\-\-activate\fR \fBdisruptive\fR|\fBdeferred\fR [\fB\-d\fR \fIdata_directory\fR]
.PP
\&\fBrflash\fR \fInoderange\fR {\fB\-\-commit\fR|\fB\-\-recover\fR}
.SH "\fBDescription\fP"
.IX Header "Description"
\&\fBrflash\fR The \fBrflash\fR command initiates Firmware updates on supported xCAT nodes.  Licensed Internal Code (also known as microcode) updates are performed on supported HMC-attached  \s-1POWER5\s0 and \s-1POWER6\s0 pSeries nodes, and \s-1POWER7\s0 systems using Direct \s-1FSP\s0 management.
.PP
The command scans the specified directory structure for Firmware update package files applicable to the given nodes and components. And then it will \fBautomatically\fR select the \fBlatest\fR version for the upgrade. The firmware update files include the Microcode update package and associated \s-1XML\s0 file. They can be downloaded from the \s-1IBM\s0 Web site: \fIhttp://www\-933.ibm.com/support/fixcentral/\fR.
.PP
The \s-1POWER5\s0  and \s-1POWER6\s0 systems contain several components that use Licensed Internal Code.  The \fBrflash\fR command supports two of these components: the managed system (also known as the Central Electronics Complex, or \s-1CEC\s0) and the power subsystem (also known as the Bulk Power Assembly (\s-1BPA\s0) or Bulk Power Controller (\s-1BPC\s0)).  Some \s-1POWER5\s0 managed systems can be attached to a power subsystem.  These power subsystems can support multiple managed systems.  When the \fBrflash\fR command is invoked, xCAT will determine the managed system or power subsystem associated with that \s-1CEC\s0 and perform the update. 
.PP
The \fBnoderange\fR can be an \s-1CEC\s0 or \s-1CEC\s0 list, a Lpar or Lpar list and a Frame or Frame list. But \s-1CEC\s0 (or Lpar) and Frame \fBcan't\fR be used at the same time. When the \fInoderange\fR is an \s-1CEC\s0 or \s-1CEC\s0 list, \fBrflash\fR will upgrade the firmware of the \s-1CEC\s0 or CECs in the cec list. If \fInoderange\fR is a Lpar or Lpar list, \fBrflash\fR will update Licensed Internal Code (\s-1LIC\s0) on  HMC-attached \s-1POWER5\s0 and \s-1POWER6\s0 pSeries nodes, and \s-1POWER7\s0 systems using Direct \s-1FSP\s0 management.  If \fInoderange\fR is a Frame or Frame list, \fBrflash\fR will update Licensed Internal Code (\s-1LIC\s0) of the power subsystem on  HMC-attached \s-1POWER5\s0 and \s-1POWER6\s0 pSeries nodes. The \fInoderange\fR can also be the specified node groups. You  can  specify a  comma or space-separated list of node group ranges. See the \fInoderange\fR  man  page  for  detailed usage information. 
.Sh "\s-1PPC\s0 (with \s-1HMC\s0) specific:"
.IX Subsection "PPC (with HMC) specific:"
The \fBrflash\fR command uses the \fBxdsh\fR command to connect to the \s-1HMC\s0 controlling the given managed system and perform the updates. Before run \fBrflash\fR, please use \fBrspconfig\fR to check if the related \s-1HMC\s0 ssh is enabled. If enable a \s-1HMC\s0 ssh connection, please use \fBrspconfig\fR comamnd.
.PP
\&\fBWarning!\fR  This command may take considerable time to complete, depending on the number of systems being updated and the workload on the target \s-1HMC\s0.  In particular, power subsystem updates may take an hour or more if there are many attached managed systems.
.PP
Depending on the Licensed Internal Code update that is installed, the affected HMC-attached \s-1POWER5\s0 and \s-1POWER6\s0 systems may need to be recycled.  The \fB\-\-activate\fR flag determines how the affected systems activate the new code.  The concurrent option activates code updates that do not require a system recycle (known as a \*(L"concurrent update\*(R").  If this option is given with an update that requires a system recycle (known as a \*(L"disruptive update\*(R"), a message will be returned, and no activation will be performed.  The disruptive option will cause any affected systems that are powered on to be powered down before installing and activating the update.  Once the update is complete, the command will attempt to power on any affected systems that it powered down.  Those systems that were powered down when the command was issued will remain powered down when the update is complete.
.PP
The flash chip of a \s-1POWER5\s0 and \s-1POWER6\s0 managed system or power subsystem stores firmware in two locations, referred to as the temporary side and the permanent side.  By default, most \s-1POWER5\s0 and \s-1POWER6\s0 systems boot from the temporary side of the flash.  When the \fBrflash\fR command updates code, the current contents of the temporary side are written to the permanent side, and the new code is written to the temporary side.  The new code is then activated.  Therefore, the two sides of the flash will contain different levels of code when the update has completed.
.PP
The \fB\-\-commit\fR flag is used to write the contents of the temporary side of the flash to the permanent side.  This flag should be used after updating code and verifying correct system operation.  The \fB\-\-recover\fR flag is used to write the permanent side of the flash chip back to the temporary side.  This flag should be used to recover from a corrupt flash operation, so that the previously running code can be restored.
.PP
\&\fB\s-1NOTE:\s0\fRWhen the \fB\-\-commit\fR or \fB\-\-recover\fR two flags is used, the noderange \fBcannot\fR be \s-1BPA\s0. It only \fBcan\fR be \s-1CEC\s0 or \s-1LPAR\s0 ,and  will take effect for \fBboth\fR managed systems and power subsystems.
.PP
xCAT recommends that you shutdown your Operating System images and power off your managed systems before applying disruptive updates to managed systems or power subsystems.
.PP
Any previously activated code on the affected systems will be automatically accepted into permanent flash by this procedure.  
.PP
\&\fB\s-1IMPORTANT\s0!\fR  If the power subsystem is recycled, all of its attached managed systems will be recycled. 
.PP
If it outputs \fB\*(L"Timeout waiting for prompt\*(R"\fR during the upgrade, please set the \fB\*(L"ppctimeout\*(R"\fR larger in the \fBsite\fR table. After the upgrade, remeber to change it back. If run the \fB\*(L"rflash\*(R"\fR command on an \s-1AIX\s0 management node, need to make sure the value of \fB\*(L"useSSHonAIX\*(R"\fR is \fB\*(L"yes\*(R"\fR in the site table.
.Sh "\s-1PPC\s0 (using Direct \s-1FSP\s0 Management) specific:"
.IX Subsection "PPC (using Direct FSP Management) specific:"
In currently Direct \s-1FSP/BPA\s0 Management, our \fBrflash\fR doesn't support \fBconcurrent\fR value of \fB\-\-activate\fR flag, and supports \fBdisruptive\fR and \fBdeferred\fR. The \fBdisruptive\fR option will cause any affected systems that are powered on to be powered down before installing and activating the update. So we require that the systems should be powered off before do the firmware update. 
.PP
The \fBdeferred\fR option will load the new firmware into the T (temp) side, but will not activate it like the disruptive firmware. The customer will continue to run the Frames and CECs working with the P (perm) side and can wait for a maintenance window where they can activate and boot the Frame/CECs with new firmware levels. Refer to the link to get more details:
  https://sourceforge.net/apps/mediawiki/xcat/index.php?title=XCAT_Power_775_Hardware_Management#Perform_Deferred_Firmware_upgrades_for_frame.2FCEC_on_Power_775
.PP
In Direct \s-1FSP/BPA\s0 Management, there is \-d <data_directory> option. The default value is /tmp. When do firmware update, rflash will put some related data from rpm packages in <data_directory> directory, so the execution of rflash will require available disk space in <data_directory> for the command to properly execute: 
.PP
For one \s-1GFW\s0 rpm package and one power code rpm package , if the \s-1GFW\s0 rpm package size is gfw_rpmsize, and the Power code rpm package size is power_rpmsize, it requires that the available disk space should be more than: 
  1.5*gfw_rpmsize + 1.5*power_rpmsize
.PP
For Power 775, the rflash command takes effect on the primary and secondary FSPs or BPAs almost in parallel. 
.PP
For more details about the Firmware Update using Direct \s-1FSP/BPA\s0 Management, refer to:
  https://sourceforge.net/apps/mediawiki/xcat/index.php?title=XCAT_Power_775_Hardware_Management#Updating_the_BPA_and_FSP_firmware_using_xCAT_DFM
.SH "\fBOptions\fP"
.IX Header "Options"
.IP "\fB\-h|\-\-help\fR" 7
.IX Item "-h|--help"
Writes the command's usage statement to standard output.
.IP "\fB\-p directory\fR" 7
.IX Item "-p directory"
Specifies the directory where the packages are located.
.IP "\fB\-d data_directory\fR" 7
.IX Item "-d data_directory"
Specifies the directory where the raw data from rpm packages for each CEC/Frame are located. The default directory is /tmp. The option is only used in Direct \s-1FSP/BPA\s0 Management. 
.IP "\fB\-\-activate\fR \fBconcurrent\fR | \fBdisruptive\fR" 7
.IX Item "--activate concurrent | disruptive"
Must be specified to activate the new Licensed Internal Code.  The \*(L"disruptive\*(R" option will cause the target systems to be recycled.  Without this flag, \s-1LIC\s0 updates will be installed only, not activated.
.IP "\fB\-\-commit\fR" 7
.IX Item "--commit"
Used to commit the flash image in the temporary side of the chip to the permanent side for both managed systems and power subsystems.
.IP "\fB\-\-recover\fR" 7
.IX Item "--recover"
Used to recover the flash image in the permanent side of the chip to the temporary side for both managed systems and power subsystems.
.IP "\fB\-v|\-\-version\fR" 7
.IX Item "-v|--version"
Displays the command's version.
.IP "\fB\-V|\-\-verbose\fR" 7
.IX Item "-V|--verbose"
Verbose output.
.SH "\fBExit Status\fP"
.IX Header "Exit Status"
0 The command completed successfully.
.PP
1 An error has occurred.
.SH "\fBExamples\fP"
.IX Header "Examples"
.IP "1" 4
.IX Item "1"
To  update  only the  power subsystem attached to a single HMC-attached pSeries \s-1CEC\s0(cec_name), and recycle the power  subsystem  and  all attached managed systems when the update is complete, and the Microcode update package and associated \s-1XML\s0 file are in /tmp/fw, enter:
.Sp
.Vb 1
\& rflash cec_name -p /tmp/fw --activate disruptive
.Ve
.IP "2" 4
.IX Item "2"
To  update  only the  power subsystem attached to a single HMC-attached pSeries node, and recycle the power  subsystem  and  all attached managed systems when the update is complete, and the Microcode update package and associated \s-1XML\s0 file are in /tmp/fw, enter:
.Sp
.Vb 1
\& rflash bpa_name -p /tmp/fw --activate disruptive
.Ve
.IP "3" 4
.IX Item "3"
To commit a firmware update to permanent flash for both managed system and the related power subsystems, enter:
.Sp
.Vb 1
\& rflash cec_name --commit
.Ve
.SH "\fBLocation\fP"
.IX Header "Location"
\&\fB/opt/xcat/bin/rflash\fR
.SH "NOTES"
.IX Header "NOTES"
This command is part of the xCAT software product.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIrinv\fR\|(1), \fIrspconfig\fR\|(1)
