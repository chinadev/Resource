<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0059)http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/shares.php" charset="utf-8"></script>

<title>深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园</title>
<link type="text/css" rel="stylesheet" href="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/style.css">
<link type="text/css" rel="stylesheet" href="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/common2.css">
<link type="text/css" rel="stylesheet" href="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/shStyle.css">
<link type="text/css" rel="stylesheet" href="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/customcss.aspx">
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/yuxc/rss">
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/yuxc/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/yuxc/wlwmanifest.xml">
<script async="" type="text/javascript" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/gpt.js"></script><script type="text/javascript" async="" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/ga.js"></script><script src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">
var currentBlogApp = 'yuxc';
</script>
<script src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/common.js" type="text/javascript"></script> 
<script src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/json2.js" type="text/javascript"></script>
<script type="text/javascript" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/syntaxHighlighter.js"></script>
<script async="" type="text/javascript" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/google_ads_gpt.js"></script><script type="text/javascript" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/osd.js"></script></head>
<body><link href="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/jiathis_counter.css" rel="stylesheet" type="text/css"><script src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/jiathis.php" charset="utf-8"></script><link href="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/jiathis_share.css" rel="stylesheet" type="text/css"><iframe frameborder="0" style="position: absolute; display: none; opacity: 0;"></iframe><div class="jiathis_style" style="position: absolute; z-index: 1000000000; display: none; top: 50%; left: 50%; overflow: auto;"></div><div class="jiathis_style" style="position: absolute; z-index: 1000000000; display: none; overflow: auto;"></div><iframe frameborder="0" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/jiathis_utility.htm" style="display: none;"></iframe>
<a name="top"></a>
<!--PageBeginHtml Block Begin-->
<script type="text/javascript">
window.onload = show;
function show(){
 var h3 = document.getElementsByTagName('H3');
 var len = h3.length;
 var currH3;
 for(var i = 0 ; i < len ; i++){
    currH3 = h3[i].innerText;
    if(currH3 == '公告'){
        h3[i].innerText='牛皮糖的Blog';
       }
  }
}
</script>
<!--PageBeginHtml Block End-->

<div id="home">
<div id="header">
	<div id="blogTitle">
		
<!--done-->
<div class="title"><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/yuxc/">牛皮糖的旅程</a></div>
<div class="subtitle">Brick walls,they let us prove how badly we want things.    
            --------摘自Randy Pausch的《最后一课》</div>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li id="nav_sitehome"><a id="MyLinks1_HomeLink" class="menu" href="http://www.cnblogs.com/">博客园</a></li>
<li id="nav_myhome"><a id="MyLinks1_MyHomeLink" class="menu" href="http://www.cnblogs.com/yuxc/">首页</a></li>
<li id="nav_q"><a class="menu" href="http://q.cnblogs.com/">博问</a></li>
<li id="nav_ing"><a class="menu" href="http://home.cnblogs.com/ing/">闪存</a></li>
<li id="nav_newpost"></li>
<li id="nav_contact"><a id="MyLinks1_ContactLink" class="menu" rel="nofollow" href="http://space.cnblogs.com/msg/send/%e7%89%9b%e7%9a%ae%e7%b3%96NewPtone">联系</a></li>
<li id="nav_rss">
<!----></li>
<li id="nav_admin"><a id="MyLinks1_Admin" class="menu" rel="nofollow" href="http://www.cnblogs.com/yuxc/admin/EditPosts.aspx">管理</a></li>
</ul>

		<div class="blogStats">
			
			
<!--done-->
随笔-215&nbsp;
文章-0&nbsp;
评论-165&nbsp;

			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
	
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园.htm">深入云存储系统Swift存储节点：存储实现分析</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><div class="Section0" style="line-height: normal; text-indent: 0pt; layout-grid: 15.6pt none; word-break: normal;">
<blockquote>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp; &nbsp;原文链接：<a id="Editor_Edit_hlEntryLink" title="view: 深入云存储系统Swift存储节点：存储实现分析" href="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园.htm" target="_blank">http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html</a>&nbsp; </span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp; &nbsp;作者：余兴超 @SAE.Sina Web Service Team</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp; &nbsp;请尊重作者辛勤劳动，转载请标注链接和作者&nbsp;&nbsp;&nbsp;</span></span></span></span></p>
</blockquote>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp;</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp; 在<a href="http://www.cnblogs.com/yuxc/archive/2012/06/22/2558312.html">深入云存储系统Swift核心组件：Ring实现原理剖析</a>和<a href="http://www.cnblogs.com/yuxc/archive/2012/06/28/2568584.html">深入云存储系统Swift核心组件：Ring数据结构及构建、重平衡操作</a>两篇博文中，我们详细地分析了Swift中数据的映射机制和具体操作。那么在集群中的每一台存储节点上，Swift是如何实现Account、Container、Object的具体存储呢？<span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">本篇旨在分析</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">Storage node</span><span style="font-family: 宋体;">与</span><span style="font-family: &#39;Times New Roman&#39;;">partition</span><span style="font-family: 宋体;">，</span><span style="font-family: &#39;Times New Roman&#39;;">partition</span><span style="font-family: 宋体;">与</span><span style="font-family: &#39;Times New Roman&#39;;">data</span><span style="font-family: 宋体;">间的映射关系在实际存储目录中的以何种格式存储，即怎么存，存什么。</span></span></span></span></span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp;&nbsp; 在</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">Storage node</span><span style="font-family: 宋体;">上运行着</span><span style="font-family: &#39;Times New Roman&#39;;">Linux系统并<span style="font-family: 宋体;">使用了</span><span style="font-family: &#39;Times New Roman&#39;;">XFS文件系统</span></span><span style="font-family: 宋体;">，逻辑上使用一致性哈希算法将固定总数的</span><span style="font-family: &#39;Times New Roman&#39;;">partition</span><span style="font-family: 宋体;">映射到每个</span><span style="font-family: &#39;Times New Roman&#39;;">Storage node</span><span style="font-family: 宋体;">上，每个</span><span style="font-family: &#39;Times New Roman&#39;;">Data</span><span style="font-family: 宋体;">也使用同样的哈希算法映射到</span><span style="font-family: &#39;Times New Roman&#39;;">Partition</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">上，其层次结构如下图所示：</span></span></span></span></p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/2012070409420145.jpg" alt=""></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="center"><span><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000; font-family: 宋体;"><em>Figure1:Stoage node hierachy</em></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">以我们的一台</span><span style="font-family: &#39;Times New Roman&#39;;">storage node sws51</span><span style="font-family: 宋体;">为例，该</span><span style="font-family: &#39;Times New Roman&#39;;">device</span><span style="font-family: 宋体;">的文件路径挂载到</span><span style="font-family: &#39;Times New Roman&#39;;">/srv/node/sdc</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">，目录结构如下所示：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<blockquote style="line-height: normal;">
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; color: #000000;"><em>root@sws51:/srv/node/sdc# ls</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; color: #000000;"><strong><em>accounts&nbsp; async_pending&nbsp; containers&nbsp; objects&nbsp; quarantined&nbsp; tmp</em></strong></span></span></span></p>







</blockquote>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　其中</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">accounts</span><span style="font-family: 宋体;">、</span><span style="font-family: &#39;Times New Roman&#39;;">containers</span><span style="font-family: 宋体;">、</span><span style="font-family: &#39;Times New Roman&#39;;">objects</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">分别是账号、容器、对象的存储目录，</span></span></span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">async_pending是异步待更新目录，</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">quarantined</span><span style="font-family: 宋体;">是隔离目录，</span><span style="font-family: &#39;Times New Roman&#39;;">tmp</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">是临时目录。</span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<h3 class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><strong>1.objects目录</strong></span></span></span></h3>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　在</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">objects</span><span style="font-family: 宋体;">目录下存放的是各个</span><span style="font-family: &#39;Times New Roman&#39;;">partition</span><span style="font-family: 宋体;">目录，其中每个</span><span style="font-family: &#39;Times New Roman&#39;;">partition</span><span style="font-family: 宋体;">目录是由若干个</span><span style="font-family: &#39;Times New Roman&#39;;">suffix_path</span><span style="font-family: 宋体;">名的目录和一个</span><span style="font-family: &#39;Times New Roman&#39;;">hashes.pkl</span><span style="font-family: 宋体;">文件组成，</span><span style="font-family: &#39;Times New Roman&#39;;">suffix_path</span><span style="font-family: 宋体;">目录下是由</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">hash_path</span><span style="font-family: 宋体;">名构成的目录，在</span><span style="font-family: &#39;Times New Roman&#39;;">hash_path</span><span style="font-family: 宋体;">目录下存放了关于</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">的数据和元数据，</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">存储目录的层次结构如图</span><span style="font-family: &#39;Times New Roman&#39;;">2</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">所示。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="center"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: inline; padding-top: 0px; border: 0px;" title="wps_clip_image-16011" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/201207040058385566.png" alt="wps_clip_image-16011" width="455" height="447" border="0"></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="center"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><em>Figure2: Object directory hierachy</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="center">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">hashes.pkl是存放在每个</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">partition</span><span style="font-family: 宋体;">中的一个</span><span style="font-family: &#39;Times New Roman&#39;;">2</span><span style="font-family: 宋体;">进制</span><span style="font-family: &#39;Times New Roman&#39;;">pickle</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">化文件。例如：</span></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>root@sws50:/srv/node/sdc/objects/100000# ls</em></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>8bd&nbsp; hashes.pkl</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>In [1]: with open('hashes.pkl', 'rb') as fp:</em></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>&nbsp;&nbsp; ...:&nbsp;&nbsp;&nbsp;&nbsp; import pickle</em></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>&nbsp;&nbsp; ...:&nbsp;&nbsp;&nbsp;&nbsp; hashes = pickle.load(fp)</em></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>&nbsp;&nbsp; ...:&nbsp;&nbsp;&nbsp;&nbsp; </em></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>&nbsp;&nbsp; ...:&nbsp;&nbsp;&nbsp;&nbsp; </em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>In [2]: hashes</em></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>Out[2]: {'8bd': '9e99c8eedaa3197a63f685dd92a5b4b8'}</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">‘</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">8bd</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">’</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">是</span><span style="font-family: &#39;Times New Roman&#39;;">suffix_dir</span><span style="font-family: 宋体;">，而</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">9e99c8eedaa3197a63f685dd92a5b4b8</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">则是该</span><span style="font-family: &#39;Times New Roman&#39;;">partition</span><span style="font-family: 宋体;">下数据的</span><span style="font-family: &#39;Times New Roman&#39;;">md5</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">哈希值。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><strong>Object path生成过程</strong></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">object的存储路径由</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">object server</span><span style="font-family: 宋体;">进程内部称为</span><span style="font-family: &#39;Times New Roman&#39;;">DiskFile</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">类初始化时产生，过程如下：</span></span></span></span></p>
<blockquote style="line-height: normal;">
<p class="p0" style="text-indent: -18pt; margin: 0pt 0pt 0pt 18pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">1.</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">由文件所属的</span><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">、</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">和</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">名称产生</span><span style="font-family: &#39;Times New Roman&#39;;">'/account/container/object'</span><span style="font-family: 宋体;">格式的字符串，和</span><span style="font-family: &#39;Times New Roman&#39;;">HASH_PATH_SUFFIX</span><span style="font-family: 宋体;">组成新的字符串，调用</span><span style="font-family: &#39;Times New Roman&#39;;">hash_path</span><span style="font-family: 宋体;">函数，生成</span><span style="font-family: &#39;Times New Roman&#39;;">md5 hash</span><span style="font-family: 宋体;">值</span><span style="font-family: &#39;Times New Roman&#39;;">name_hash</span><span style="font-family: 宋体;">。其中</span><span style="font-family: &#39;Times New Roman&#39;;">HASH_PATH_SUFFIX</span><span style="font-family: 宋体;">作为</span><span style="font-family: &#39;Times New Roman&#39;;">salt</span><span style="font-family: 宋体;">来增加安全性，</span><span style="font-family: &#39;Times New Roman&#39;;">HASH_PATH_SUFFIX</span><span style="font-family: 宋体;">值存放在</span><span style="font-family: &#39;Times New Roman&#39;;">/etc/swift/swift.conf</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">中。</span></span></span></span></p>
<p class="p0" style="text-indent: -18pt; margin: 0pt 0pt 0pt 18pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">2. </span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">调用</span><span style="font-family: &#39;Times New Roman&#39;;">storage_directory</span><span style="font-family: 宋体;">函数，传入</span><span style="font-family: &#39;Times New Roman&#39;;">DATADIR, partition, hash_path</span><span style="font-family: 宋体;">参数生成</span><span style="font-family: &#39;Times New Roman&#39;;">DATADIR/partition/name_path[-3:]/name_path</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">格式字符串</span></span></span></span></p>
<p class="p0" style="text-indent: -18pt; margin: 0pt 0pt 0pt 18pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">3. </span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">连结</span><span style="font-family: &#39;Times New Roman&#39;;">path/devcie/storage_directory(DATADIR, partition,name_ hash)</span><span style="font-family: 宋体;">生成数据存储路径</span></span><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">datadir</span></span></span></span></p>
<p class="p0" style="text-indent: -18pt; margin: 0pt 0pt 0pt 18pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">4. </span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">调用</span><span style="font-family: &#39;Times New Roman&#39;;">normalize_timestamp</span><span style="font-family: 宋体;">函数生成“</span><span style="font-family: &#39;Times New Roman&#39;;">16</span><span style="font-family: 宋体;">位</span><span style="font-family: &#39;Times New Roman&#39;;">.5</span><span style="font-family: 宋体;">位”的时间戳</span><span style="font-family: &#39;Times New Roman&#39;;">+</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">扩展名的格式生成对象名称</span></span></span></span></p>







</blockquote>
<p class="p0" style="text-indent: -18pt; margin: 0pt 0pt 0pt 18pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp;</span></span></span></span></p>
<p class="p0" style="text-indent: -18pt; margin: 0pt 0pt 0pt 18pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp;</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　例如，某</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">object</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">的存储路径为：</span></span></span></span><span><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">/srv/node/sdc/objects/19892/ab1/136d0ab88371e25e16663fbd2ef42ab1/1320050752.09979.d</span></span></span><span><span style="font-family: 宋体;"><span style="font-size: 12pt;">ata</span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;">　　其中每个目录分别表示：</span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><img style="background-image: none; margin-top: 0px; margin-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; display: block; margin-left: auto; margin-right: auto; border-width: 0px; border-color: initial; border-style: initial;" title="wps_clip_image-23876" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/201207040058381073.png" alt="wps_clip_image-23876" width="599" height="86" border="0"></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="center"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><em>Figure3: Object directory represention</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<h3 class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><strong>Object数据</strong></span></span></span></h3>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">Object的数据存放在后缀为</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">.data</span><span style="font-family: 宋体;">的文件中，它的</span><span style="font-family: &#39;Times New Roman&#39;;">metadata</span><span style="font-family: 宋体;">存放在以后缀为</span><span style="font-family: &#39;Times New Roman&#39;;">.meta</span><span style="font-family: 宋体;">的文件中，将被删除的</span><span style="font-family: &#39;Times New Roman&#39;;">Object</span><span style="font-family: 宋体;">以一个</span><span style="font-family: &#39;Times New Roman&#39;;">0</span><span style="font-family: 宋体;">字节后缀为</span><span style="font-family: &#39;Times New Roman&#39;;">.ts</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">的文件存放。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<h3 class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><strong>2.accounts目录</strong></span></span></span></h3>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">在</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">accounts</span><span style="font-family: 宋体;">目录下存放的是各个</span><span style="font-family: &#39;Times New Roman&#39;;">partition</span><span style="font-family: 宋体;">，而每个</span><span style="font-family: &#39;Times New Roman&#39;;">partition</span><span style="font-family: 宋体;">目录是由若干个</span><span style="font-family: &#39;Times New Roman&#39;;">suffix_path</span><span style="font-family: 宋体;">目录组成，</span><span style="font-family: &#39;Times New Roman&#39;;">suffix_path</span><span style="font-family: 宋体;">目录下是由</span><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">hsh</span><span style="font-family: 宋体;">名构成的目录，在</span><span style="font-family: &#39;Times New Roman&#39;;">hsh</span><span style="font-family: 宋体;">目录下存放了关于</span><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">sqlite db</span><span style="font-family: 宋体;">，</span><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">存储目录的层次结构如图</span><span style="font-family: &#39;Times New Roman&#39;;">4</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">所示。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><img style="background-image: none; margin-top: 0px; margin-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; display: block; margin-left: auto; margin-right: auto; border-width: 0px; border-color: initial; border-style: initial;" title="wps_clip_image-24231" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/201207040058392676.png" alt="wps_clip_image-24231" width="504" height="494" border="0"></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="center"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><em>Figure4: Account directory hierachy</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<h3 class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><strong>Account path生成过程</strong></span></span></span></h3>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　account使用</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">AccountController</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">类来生成</span><span style="font-family: &#39;Times New Roman&#39;;">path</span><span style="font-family: 宋体;">，其过程与</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">类似，唯一的不同之处在于，</span><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">命名调用</span><span style="font-family: &#39;Times New Roman&#39;;">hash_path(account)</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">来生成，而不是使用时间戳的形式。</span></span></span></span><span><span><span style="font-family: 宋体;"><span style="font-size: 12pt;">例如，某</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">db</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">存储路径为：</span></span></span></span><span><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">/srv/node/sdc/accounts/20443/ac8/c7a5e0f94b23b79345b6036209f9cac8</span></span></span><span><span style="font-family: 宋体;"><span style="font-size: 12pt;">/</span></span></span><span style="font-family: &#39;Times New Roman&#39;;"><span>&nbsp;</span><span><span style="font-size: 12pt;">c7a5e0f94b23b79345b6036209f9cac8.db</span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><a href="http://images.cnblogs.com/cnblogs_com/yuxc/201207/201207040058399578.png"><img style="background-image: none; margin-top: 0px; margin-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; display: block; margin-left: auto; margin-right: auto; border-width: 0px; border-color: initial; border-style: initial;" title="wps_clip_image-9097" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/201207040058394562.png" alt="wps_clip_image-9097" width="555" height="77" border="0"></a></p>
<p class="p0" style="text-indent: 0pt; text-align: center; margin: 0pt;" align="justify">　　&nbsp;<span style="font-family: 宋体; font-size: 16px;"><em>Figure5: Object directory represention</em></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><strong>Account db数据</strong></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><strong>&nbsp;</strong></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　在</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">文件中，包含了</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">account_stat</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">、</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">container</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">、</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">incoming_sync </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">、</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">outgoing_sync</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;"> 4张表。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　表</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">account_stat</span><span style="font-family: 宋体;">是记录关于</span><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">的信息，如名称、创建时间、</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">数统计等等，其</span><span style="font-family: &#39;Times New Roman&#39;;">schema</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">如下：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt; background: #242424;" align="left"><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #ffffff;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TABLE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> account_stat (</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; account TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; created_at TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; put_timestamp TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'0'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delete_timestamp TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'0'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; container_count INTEGER,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; object_count INTEGER </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">0</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytes_used INTEGER </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">0</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">default</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'00000000000000000000000000000000'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>''</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_changed_at TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'0'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; metadata TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>''</em></span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　account表示</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">名称，</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">created_at</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">表示创建时间，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">put_timestamp</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">put request</span><span style="font-family: 宋体;">的时间戳，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">delete_timestamp</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">delete request</span><span style="font-family: 宋体;">的时间戳，</span><span style="font-family: &#39;Times New Roman&#39;;">container_count</span><span style="font-family: 宋体;">为</span><span style="font-family: &#39;Times New Roman&#39;;">countainer</span><span style="font-family: 宋体;">的计数，</span><span style="font-family: &#39;Times New Roman&#39;;">object_count</span><span style="font-family: 宋体;">为</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">的计数，</span><span style="font-family: &#39;Times New Roman&#39;;">bytes_used</span><span style="font-family: 宋体;">表示已使用的字节数，</span><span style="font-family: &#39;Times New Roman&#39;;">hash</span><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">文件的</span><span style="font-family: &#39;Times New Roman&#39;;">hash</span><span style="font-family: 宋体;">值，</span><span style="font-family: &#39;Times New Roman&#39;;">id</span><span style="font-family: 宋体;">表示统一标识符，</span><span style="font-family: &#39;Times New Roman&#39;;">status</span><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">是否被标记为删除，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">status_changed_at</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">表示状态修改时间，</span><span style="font-family: &#39;Times New Roman&#39;;">metadata</span><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">account</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">的元数据。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">以</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">test</span><span style="font-family: 宋体;">账号为例，该</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">的表</span><span style="font-family: &#39;Times New Roman&#39;;">account_stat</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">中存放了以下数据项：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp;</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="left"><img style="background-image: none; padding-left: 0px; padding-right: 0px; padding-top: 0px; border-style: initial; border-color: initial; margin-top: 0px; margin-bottom: 0px; display: block; margin-left: auto; margin-right: auto;" title="wps_clip_image-5299" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/201207040058405085.png" alt="wps_clip_image-5299" width="800" height="26"></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　表</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">记录关于</span><span style="font-family: &#39;Times New Roman&#39;;">container</span></span><span style="font-size: 12pt; font-family: 宋体;">的信息</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 9.5pt; font-family: 宋体;">，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">其</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">schema</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">如下：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt; background: #242424;" align="left"><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #ffffff;"><span style="font-size: 9pt;">CREATE</span></span></span><span style="font-size: 9pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TABLE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> container (</span></span></span></span><span style="font-size: 9pt;"><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ROWID INTEGER </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">PRIMARY</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">KEY</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> AUTOINCREMENT,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; put_timestamp TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delete_timestamp TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; object_count INTEGER,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytes_used INTEGER,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; deleted INTEGER </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">0</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">INDEX</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> ix_container_deleted_name </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">ON</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; container (deleted, name);</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TRIGGER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> container_delete </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">AFTER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DELETE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">ON</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> container</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">BEGIN</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UPDATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> account_stat</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">SET</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> container_count = container_count - (</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">1</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> - </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">old</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.deleted),</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; object_count = object_count - </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">old</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.object_count,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytes_used = bytes_used - </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">old</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.bytes_used,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash = chexor(hash, </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">old</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.name,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">old</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.put_timestamp || </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'-'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> ||</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">old</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.delete_timestamp || </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'-'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> ||</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">old</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.object_count || </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'-'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> || </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">old</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.bytes_used);</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">END</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">;</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TRIGGER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> container_insert </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">AFTER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">INSERT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">ON</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> container</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">BEGIN</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UPDATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> account_stat</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">SET</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> container_count = container_count + (</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">1</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> - </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.deleted),</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; object_count = object_count + </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.object_count,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytes_used = bytes_used + </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.bytes_used,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash = chexor(hash, </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.name,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.put_timestamp || </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'-'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> ||</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.delete_timestamp || </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'-'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> ||</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.object_count || </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'-'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> || </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.bytes_used);</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">END</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">;</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TRIGGER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> container_update </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">BEFORE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UPDATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">ON</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> container</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">BEGIN</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">SELECT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> RAISE(FAIL, </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'UPDATE not allowed; DELETE and INSERT'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">);</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span></span><span style="font-family: Consolas;"><span style="font-size: 9pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">END</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 9pt; color: #f6f3e8;">;</span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　其中</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">ROWID</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">字段表示自增的主键，</span><span style="font-family: &#39;Times New Roman&#39;;">name</span><span style="font-family: 宋体;">字段表示</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">的名称，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">put_timestamp</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">和</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">delete_timestamp</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">分别表示</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">put</span><span style="font-family: 宋体;">和</span><span style="font-family: &#39;Times New Roman&#39;;">delete</span><span style="font-family: 宋体;">的时间戳，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">object_count</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">内的</span><span style="font-family: &#39;Times New Roman&#39;;">object</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">数，</span></span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #f6f3e8;">&nbsp;</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; color: #000000;">bytes_used</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: Consolas;"><span style="font-size: 9pt; color: #f6f3e8;">&nbsp;</span></span></span><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">&nbsp;</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">表示已使用的空间，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">deleted</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">container</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">是否标记为删除。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　账号</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">test</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">account</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">表中的数据项如下所示：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><a href="http://images.cnblogs.com/cnblogs_com/yuxc/201207/201207040058406971.png"><img style="background-image: none; margin-top: 0px; margin-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; border-style: initial; border-color: initial; display: block; margin-left: auto; margin-right: auto; border-width: 0px;" title="wps_clip_image-28912" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/201207040058412727.png" alt="wps_clip_image-28912" width="573" height="219" border="0"></a></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　表</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">incoming_sync</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">记录到来的同步数据项，其</span><span style="font-family: &#39;Times New Roman&#39;;">schema</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">如下：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt; background: #242424;" align="left"><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #ffffff;"><span style="font-size: 9.5pt;">CREATE</span></span></span><span style="font-size: 9.5pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TABLE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> incoming_sync (</span></span></span></span><span style="font-size: 9.5pt;"><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; remote_id TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UNIQUE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sync_point INTEGER,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updated_at TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">0</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TRIGGER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> incoming_sync_insert </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">AFTER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">INSERT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">ON</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> incoming_sync</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">BEGIN</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UPDATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> incoming_sync</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">SET</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> updated_at = STRFTIME(</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'%s'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">, </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'NOW'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">)</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">WHERE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> ROWID = </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.ROWID;</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">END</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">;</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TRIGGER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> incoming_sync_update </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">AFTER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UPDATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">ON</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> incoming_sync</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">BEGIN</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UPDATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> incoming_sync</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">SET</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> updated_at = STRFTIME(</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'%s'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">, </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'NOW'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">)</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">WHERE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> ROWID = </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.ROWID;</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span></span><span style="font-family: Consolas;"><span style="font-size: 9.5pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">END</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 9.5pt; color: #f6f3e8;">;</span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">　　remote_id</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">字段表示远程节点的</span><span style="font-family: &#39;Times New Roman&#39;;">id</span><span style="font-family: 宋体;">，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">sync_point</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">字段表示上一次更新所在的行位置，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">updated_at</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">字段表示更新时间。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp;</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">账号</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">test</span><span style="font-family: 宋体;">的表</span><span style="font-family: &#39;Times New Roman&#39;;">incoming_sync</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">中的数据项如下所示：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><a href="http://images.cnblogs.com/cnblogs_com/yuxc/201207/201207040058417711.png"><img style="background-image: none; margin-top: 0px; margin-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; border-style: initial; border-color: initial; display: block; margin-left: auto; margin-right: auto; border-width: 0px;" title="wps_clip_image-16251" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/201207040058422379.png" alt="wps_clip_image-16251" width="554" height="32" border="0"></a></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp;</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">表</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">outgoing_sync</span><span style="font-family: 宋体;">表示推送出的同步数据项，其</span><span style="font-family: &#39;Times New Roman&#39;;">schema</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">如下：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt; background: #242424;" align="left"><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #ffffff;"><span style="font-size: 9.5pt;">CREATE</span></span></span><span style="font-size: 9.5pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TABLE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> outgoing_sync (</span></span></span></span><span style="font-size: 9.5pt;"><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; remote_id TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UNIQUE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sync_point INTEGER,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updated_at TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">0</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TRIGGER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> outgoing_sync_insert </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">AFTER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">INSERT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">ON</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> outgoing_sync</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">BEGIN</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UPDATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> outgoing_sync</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">SET</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> updated_at = STRFTIME(</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'%s'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">, </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'NOW'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">)</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">WHERE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> ROWID = </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.ROWID;</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">END</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">;</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TRIGGER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> outgoing_sync_update </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">AFTER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UPDATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">ON</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> outgoing_sync</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">BEGIN</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UPDATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> outgoing_sync</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">SET</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> updated_at = STRFTIME(</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'%s'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">, </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'NOW'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">)</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">WHERE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> ROWID = </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.ROWID;</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span></span><span style="font-family: Consolas;"><span style="font-size: 9.5pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">END</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 9.5pt; color: #f6f3e8;">;</span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">　　remote_id</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">字段表示远程节点的</span><span style="font-family: &#39;Times New Roman&#39;;">id</span><span style="font-family: 宋体;">，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">sync_point</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">字段表示上一次更新所在的行位置，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">updated_at</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">字段表示更新时间。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">账号</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">test</span><span style="font-family: 宋体;">的表</span><span style="font-family: &#39;Times New Roman&#39;;">remote_id</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">中的数据项如下所示：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><a href="http://images.cnblogs.com/cnblogs_com/yuxc/201207/201207040058421822.png"><img style="background-image: none; margin-top: 0px; margin-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; border-style: initial; border-color: initial; display: block; margin-left: auto; margin-right: auto; border-width: 0px;" title="wps_clip_image-4803" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/201207040058424854.png" alt="wps_clip_image-4803" width="591" height="42" border="0"></a></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><strong>&nbsp;</strong></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><strong>3.Container目录</strong></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">Container目录结构和生成过程与</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">Account</span><span style="font-family: 宋体;">类似，</span><span style="font-family: &#39;Times New Roman&#39;;">Containerdb</span><span style="font-family: 宋体;">中共有</span><span style="font-family: &#39;Times New Roman&#39;;">5</span><span style="font-family: 宋体;">张表，其中</span><span style="font-family: &#39;Times New Roman&#39;;">incoming_sync</span><span style="font-family: 宋体;">和</span><span style="font-family: &#39;Times New Roman&#39;;">outgoing_sync</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">schema</span><span style="font-family: 宋体;">与</span><span style="font-family: &#39;Times New Roman&#39;;">Account</span><span style="font-family: 宋体;">中的相同。其他</span><span style="font-family: &#39;Times New Roman&#39;;">3</span><span style="font-family: 宋体;">张表分别为</span><span style="font-family: &#39;Times New Roman&#39;;">container_stat</span><span style="font-family: 宋体;">、</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">、</span><span style="font-family: &#39;Times New Roman&#39;;">sqlite_sequence</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">表</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">container_stat</span><span style="font-family: 宋体;">与表</span><span style="font-family: &#39;Times New Roman&#39;;">account_stat</span><span style="font-family: 宋体;">相似，其区别是</span><span style="font-family: &#39;Times New Roman&#39;;">container_stat</span><span style="font-family: 宋体;">存放的是关于</span><span style="font-family: &#39;Times New Roman&#39;;">container</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">信息：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt; background: #242424;" align="left"><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #ffffff;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TABLE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> container_stat (</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; account TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; container TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; created_at TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; put_timestamp TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'0'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delete_timestamp TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'0'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; object_count INTEGER,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytes_used INTEGER,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reported_put_timestamp TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'0'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reported_delete_timestamp TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'0'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reported_object_count INTEGER </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">0</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reported_bytes_used INTEGER </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">0</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">default</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'00000000000000000000000000000000'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>''</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_changed_at TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'0'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; metadata TEXT </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>''</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x_container_sync_point1 INTEGER </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> -</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">1</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x_container_sync_point2 INTEGER </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> -</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">1</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　其中</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">字段表示</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">所示的</span><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">，</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">字段表示</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">名称，</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">created_at</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">表示创建时间，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">put_timestamp</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">put request</span><span style="font-family: 宋体;">的时间戳，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">delete_timestamp</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">delete request</span><span style="font-family: 宋体;">的时间戳，</span><span style="font-family: &#39;Times New Roman&#39;;">object_count</span><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">计数，</span><span style="font-family: &#39;Times New Roman&#39;;">bytes_used</span><span style="font-family: 宋体;">表示使用空间，</span><span style="font-family: &#39;Times New Roman&#39;;">hash</span><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">文件的哈希值</span><span style="font-family: &#39;Times New Roman&#39;;">,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"> reported_put_timestamp</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">,</span></span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;</span></span><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">reported_delete_timestamp</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"> reported_object_count</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"> reported_bytes_used</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">reported</span><span style="font-family: 宋体;">的状态信息，</span><span style="font-family: &#39;Times New Roman&#39;;">id</span><span style="font-family: 宋体;">表示统一标识符，</span><span style="font-family: &#39;Times New Roman&#39;;">status</span><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">状态，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">status_changed_at</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">表示更改时间，</span><span style="font-family: &#39;Times New Roman&#39;;">metadata</span><span style="font-family: 宋体;">表示</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">的元数据，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">x_container_sync_point1</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">表示同步点</span><span style="font-family: &#39;Times New Roman&#39;;">1</span><span style="font-family: 宋体;">，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">x_container_sync_point</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">2表示同步点</span></span><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">2.</span></span></span></span></p>
<p class="p0" style="text-indent: -21pt; margin: 0pt 0pt 0pt 21pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">以名称为</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">test</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">container db</span><span style="font-family: 宋体;">为例，其中的表</span><span style="font-family: &#39;Times New Roman&#39;;">container_stat</span><span style="font-family: 宋体;">数据项如下</span></span><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">:</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><a href="http://images.cnblogs.com/cnblogs_com/yuxc/201207/201207040058429837.png"><img style="background-image: none; margin-top: 0px; margin-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; border-style: initial; border-color: initial; display: block; margin-left: auto; margin-right: auto;" title="wps_clip_image-25120" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/201207040058432214.png" alt="wps_clip_image-25120" width="500" height="30"></a></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">表</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">schema</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">如下：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt; background: #242424;" align="left"><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #ffffff;"><span style="font-size: 9.5pt;">CREATE</span></span></span><span style="font-size: 9.5pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TABLE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">object</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> (</span></span></span></span><span style="font-size: 9.5pt;"><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ROWID INTEGER </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">PRIMARY</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">KEY</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> AUTOINCREMENT,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; created_at TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">size</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> INTEGER,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; content_type TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; etag TEXT,</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; deleted INTEGER </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DEFAULT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">0</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8; font-family: Consolas;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">INDEX</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> ix_object_deleted_name </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">ON</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">object</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> (deleted, name);</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TRIGGER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> object_delete </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">AFTER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">DELETE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">ON</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">object</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">BEGIN</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UPDATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> container_stat</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">SET</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> object_count = object_count - (</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">1</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> - </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">old</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.deleted),</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytes_used = bytes_used - </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">old</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">size</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash = chexor(hash, </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">old</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.name, </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">old</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.created_at);</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">END</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">;</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TRIGGER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> object_insert </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">AFTER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">INSERT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">ON</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">object</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">BEGIN</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UPDATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> container_stat</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">SET</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> object_count = object_count + (</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #e5786d;">1</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> - </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.deleted),</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bytes_used = bytes_used + </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">size</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">,</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hash = chexor(hash, </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.name, </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">new</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">.created_at);</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">END</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">;</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">CREATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">TRIGGER</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> object_update </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">BEFORE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">UPDATE</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">ON</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">object</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">BEGIN</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span><span style="font-family: Consolas;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">SELECT</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;"> RAISE(FAIL, </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #95e454;"><em>'UPDATE not allowed; DELETE and INSERT'</em></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">);</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><br></span></span><span style="font-family: Consolas;"><span style="font-size: 9.5pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #f6f3e8;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #8ac6f2;">END</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 9.5pt; color: #f6f3e8;">;</span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">test container db的表</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">object</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">数据项如下所示：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><a href="http://images.cnblogs.com/cnblogs_com/yuxc/201207/201207040058439149.png"><img style="background-image: none; margin-top: 0px; margin-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; border-style: initial; border-color: initial; display: block; margin-left: auto; margin-right: auto; border-width: 0px;" title="wps_clip_image-18073" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/201207040058435004.png" alt="wps_clip_image-18073" width="614" height="43" border="0"></a></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: -18pt; margin: 0pt 0pt 0pt 18pt;" align="justify"><span style="color: #000000;"><strong><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">4. </span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">tmp目录</span></span></span></strong></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">tmp目录作为</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">account/container/object server</span><span style="font-family: 宋体;">向</span><span style="font-family: &#39;Times New Roman&#39;;">partition</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">目录内写入数据前的临时目录。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">例如，在</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">client</span><span style="font-family: 宋体;">向服务端上传某一文件，</span><span style="font-family: &#39;Times New Roman&#39;;">object server</span><span style="font-family: 宋体;">调用</span><span style="font-family: &#39;Times New Roman&#39;;">DiskFile</span><span style="font-family: 宋体;">类的</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">mkstemp</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">方法在创建路径为</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">path/device</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">/t</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">mp</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">的目录。在数据上传完成之后，调用</span><span style="font-family: &#39;Times New Roman&#39;;">put()</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">方法，将数据移动到相应路径。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: -18pt; margin: 0pt 0pt 0pt 18pt;" align="justify"><span style="color: #000000;"><strong><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;">5. </span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;">async_pending</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">目录</span></span></span></strong></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><strong><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp;&nbsp; </span></span></strong></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">本地</span><span style="font-family: &#39;Times New Roman&#39;;">server</span><span style="font-family: 宋体;">在与</span><span style="font-family: &#39;Times New Roman&#39;;">remote server</span><span style="font-family: 宋体;">建立</span><span style="font-family: &#39;Times New Roman&#39;;">http</span><span style="font-family: 宋体;">连接或者发送数据时超时导致更新失败时，将把文件放入</span><span style="font-family: &#39;Times New Roman&#39;;">async_pending</span><span style="font-family: 宋体;">目录。</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">这种情况经常发生在系统故障或者是高负荷的情况下。如果更新失败，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">本</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">次更新被加入队列，然后</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">由</span><span style="font-family: &#39;Times New Roman&#39;;">Updater</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">继续处理这些失败的更新工作。例如，假设一个container</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"> server处于负荷下</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">此时</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">一个新的对象被加入到系统。当</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">Proxy</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">成功地响应</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">Client</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">的请求</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">时</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">，这个对象将变为直接</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">可访问的</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">。但是container</span><span style="font-family: 宋体;">服务器并没有更新对象列表，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">本次</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">更新将进入队列等待延后的更新。所以，container</span><span style="font-family: 宋体;">列表不可能马上就包含这个新对象。</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">随后</span><span style="font-family: &#39;Times New Roman&#39;;">Updater</span><span style="font-family: 宋体;">使用</span><span style="font-family: &#39;Times New Roman&#39;;">object_sweep</span><span style="font-family: 宋体;">扫描</span><span style="font-family: &#39;Times New Roman&#39;;">device</span><span style="font-family: 宋体;">上的</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">async pendings</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">目录，遍历每一个</span><span style="font-family: &#39;Times New Roman&#39;;">prefix</span><span style="font-family: 宋体;">目录并执行升级。一旦完成升级，则移除</span><span style="font-family: &#39;Times New Roman&#39;;">pending</span><span style="font-family: 宋体;">目录下的文件</span><span style="font-family: &#39;Times New Roman&#39;;">(</span><span style="font-family: 宋体;">实际上，是通过调用</span><span style="font-family: &#39;Times New Roman&#39;;">renamer</span><span style="font-family: 宋体;">函数将文件移动到</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">相应的目录下</span><span style="font-family: &#39;Times New Roman&#39;;">)</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">为了验证以上过程，通过执行一个并发上传</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">1000</span><span style="font-family: 宋体;">个文件的脚本，观察</span><span style="font-family: &#39;Times New Roman&#39;;">sws50</span><span style="font-family: 宋体;">的</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">async_pending</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">目录下的所发生的变化。</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">async_pending</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">的路径为</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">/srv/node/sdc/async_pending/</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">，在执行脚本前，该目录下为空。脚本执行完毕后，</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">async_pending</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">目录下产生了一些</span><span style="font-family: &#39;Times New Roman&#39;;">prefix</span><span style="font-family: 宋体;">目录，</span><span style="font-family: &#39;Times New Roman&#39;;">cd</span><span style="font-family: 宋体;">到一个</span><span style="font-family: &#39;Times New Roman&#39;;">prefix</span><span style="font-family: 宋体;">为</span><span style="font-family: &#39;Times New Roman&#39;;">cb9</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">的目录中，观察其中的数据：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="background-color: #7f7f7f;"><em><span style="color: #000000; font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">root@sws50:</span></span><span style="font-size: 12pt;"><a style="border-bottom-style: none;" name="OLE_LINK1"></a><a style="border-bottom-style: none;" name="OLE_LINK2"></a><span style="font-family: &#39;Times New Roman&#39;;">/srv/node/sdc/async_pending/</span></span><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; color: #000000;">cb9# ll</span></span></em></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">total 2</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">4</span></span></span></em></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 9pt; background-color: #7f7f7f; color: #000000;"><em>-rw------- 1 swift swift 324 2011-11-08 10:15 69a5ee25ea7a4a4b08ea47102930fcb9-1320718532.01864</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 9pt; background-color: #7f7f7f; color: #000000;"><em>-rw------- 1 swift swift 324 2011-11-08 10:15 69a5ee25ea7a4a4b08ea47102930fcb9-1320718537.04863</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 9pt; background-color: #7f7f7f; color: #000000;"><em>-rw------- 1 swift swift 324 2011-11-08 10:15 69a5ee25ea7a4a4b08ea47102930fcb9-1320718543.08122</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 9pt; background-color: #7f7f7f; color: #000000;"><em>-rw------- 1 swift swift 324 2011-11-08 10:15 69a5ee25ea7a4a4b08ea47102930fcb9-1320718550.13288</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 9pt; background-color: #7f7f7f; color: #000000;"><em>-rw------- 1 swift swift 324 2011-11-08 10:15 69a5ee25ea7a4a4b08ea47102930fcb9-1320718558.18801</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 9pt; background-color: #7f7f7f; color: #000000;"><em>-rw------- 1 swift swift 324 2011-11-08 10:16 69a5ee25ea7a4a4b08ea47102930fcb9-1320718567.25494</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">文件路径的组成如下图所示，其中数据名称是由</span><span style="font-family: &#39;Times New Roman&#39;;">hash_path</span><span style="font-family: 宋体;">后面紧跟</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">’</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">-</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">‘</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">，后面是以发送</span><span style="font-family: &#39;Times New Roman&#39;;">container request</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">header</span><span style="font-family: 宋体;">中包含的时间戳所产生：</span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><a href="http://images.cnblogs.com/cnblogs_com/yuxc/201207/201207040058448036.png"><img style="background-image: none; margin-top: 0px; margin-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; display: block; margin-left: auto; margin-right: auto; border-width: 0px; border-color: initial; border-style: initial;" title="wps_clip_image-22259" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/201207040058441068.png" alt="wps_clip_image-22259" width="555" height="84" border="0"></a></p>
<p class="p0" style="text-indent: 0pt; text-align: center; margin: 0pt;" align="justify"><span style="font-family: 宋体; font-size: 16px;">&nbsp;<em>Figure6: &nbsp;async_pendingdirectory represention</em></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;">2分钟之后，查看该目录下的文件，仅剩下一个文件：</span></span></span></p>
<blockquote>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="background-color: #7f7f7f; color: #000000; font-family: &#39;Times New Roman&#39;;"><em>root@sws50:/srv/node/sdc/async_pending/cb9# ll</em></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="background-color: #7f7f7f; color: #000000; font-family: &#39;Times New Roman&#39;;"><em>total 4</em></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="background-color: #7f7f7f; color: #000000; font-family: &#39;Times New Roman&#39;;"><em>-rw------- 1 swift swift 356 2011-11-08 10:18 69a5ee25ea7a4a4b08ea47102930fcb9-1320718567.25494</em></span></span></p>








</blockquote>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">最后，</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">async_pending</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">目录变为空。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp;</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">　　account和</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">db pending</span><span style="font-family: 宋体;">文件并不会独立地存在于</span><span style="font-family: &#39;Times New Roman&#39;;">async_pending</span><span style="font-family: 宋体;">目录下，它们的</span><span style="font-family: &#39;Times New Roman&#39;;">pending</span><span style="font-family: 宋体;">文件会与其</span><span style="font-family: &#39;Times New Roman&#39;;">db</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">文件在一个目录下存放。例如：</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">某</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">文件为</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">b8e7f40f8c2012d17aca4e0483d391d0.db</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">，其</span><span style="font-family: &#39;Times New Roman&#39;;">pending</span><span style="font-family: 宋体;">文件为</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">b8e7f40f8c2012d17aca4e0483d391d0.db.pending</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">，一起存放在</span><span style="font-family: &#39;Times New Roman&#39;;">suffix</span><span style="font-family: 宋体;">目录</span><span style="font-family: &#39;Times New Roman&#39;;">1d0</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">下。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">再次执行测试脚本观察</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">1d0</span><span style="font-family: 宋体;">目录下的变化，执行前</span><span style="font-family: &#39;Times New Roman&#39;;">pending</span><span style="font-family: 宋体;">文件的大小为</span><span style="font-family: &#39;Times New Roman&#39;;">0kb</span><span style="font-family: 宋体;">，执行过程中，</span><span style="font-family: &#39;Times New Roman&#39;;">pending</span><span style="font-family: 宋体;">的大小慢慢增加到</span><span style="font-family: &#39;Times New Roman&#39;;">12kb</span><span style="font-family: 宋体;">左右，接着又缓慢下降直到</span><span style="font-family: &#39;Times New Roman&#39;;">0kb</span><span style="font-family: 宋体;">。读取此过程某一时刻的</span><span style="font-family: &#39;Times New Roman&#39;;">pending</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">文件。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;">其中内容如下所示：</span></span></span></p>
<blockquote>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 7.5pt;">':gAIoVQM3MzVxAVUQMTMyMTE4NjczMy4yNTQ0N3ECSgBwAQBVGGFwcGxpY2F0aW9uL29jdGV0LXN0</span></span></span></em></span></span></p>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 7.5pt;">\ncmVhbXEDVSBkYmQzZjhmYjQ1ZmQyZjBkZGZmNTA1ODZkNWU0ZGY3ZnEESwB0Lg==\n:gAIoVQM3Mzh</span></span></span></em></span></span></p>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 7.5pt;">xAVUQMTMyMTE4NjczMy41MjM4MXECTQDcVRhhcHBsaWNhdGlvbi9vY3RldC1zdHJl\nYW1xA1UgOGI3YzR</span></span></span></em></span></span></p>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 7.5pt;">iZGVlYzNkZGU4ZDI5OWU1Yzk1ZmE1N2ExZWVxBEsAdC4=\n:gAIoVQM3MzlxAVUQMTMyMTE4NjczMy42M</span></span></span></em></span></span></p>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 7.5pt;">zg0NnECTQCgVRhhcHBsaWNhdGlvbi9vY3RldC1zdHJl\nYW1xA1UgMmQ1ZDlhYjk0MzlkMTNiMmZhODhiZmF</span></span></span></em></span></span></p>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 7.5pt;">mNTk3NTRkMjZxBEsAdC4=\n:g</span></span></span><span style="font-size: 7.5pt;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: 宋体;">..........................................</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 7.5pt;">AIoVQM3NDdxAVUQMTM</span></span></span></em></span></span></p>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 7.5pt;">yMTE4NjczNC40MzIxNnECSgBoAQBVGGFwcGxpY2F0aW9uL29jdGV0LXN0\ncmVhbXEDVSBjYTgzNmZhY2Fh</span></span></span></em></span></span></p>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 7.5pt;">MzY0MGQwNDc4YTU5OGQzZmUzYmRiNHEESwB0Lg==\n:gAIoVQM3NDlxAVUQMTMyMTE4NjczNC42MzA</span></span></span></em></span></span></p>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 7.5pt;">1NXECTQCUVRhhcHBsaWNhdGlvbi9vY3RldC1zdHJl\nYW1xA1UgY2Y5NWU3MDIxNWEzOTFlNzcwZDBkODB</span></span></span></em></span></span></p>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 7.5pt;">jZjlhN2Q5OTlxBEsAdC4=\n:gAIoVQM3NTBxAVUQMTMyMTE4NjczNC43NTA2MXECSgAoAQBVGGFwcGxpY2</span></span></span></em></span></span></p>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 7.5pt;">F0aW9uL29jdGV0LXN0\ncmVhbXEDVSAyYzU4Zjc3ZGIwMGUxMTgxNjZmNjg2Zjc0YzlmZmNjZHEESwB0Lg==\n'</span></span></span></em></span></span></p>









</blockquote>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">使用</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">’</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">:</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">’</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">对以上字符串进行分割成</span><span style="font-family: &#39;Times New Roman&#39;;">list</span><span style="font-family: 宋体;">，我们得到第一个非空元素</span></span></span></span></p>
<blockquote>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">y[1]</span><span style="font-family: 宋体;">：</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f;"><em>'gAIoVQM3MzVxAVUQMTMyMTE4NjczMy4yNTQ0N3ECSgBwAQBVGG</em></span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f;"><em>FwcGxpY2F0aW9uL29jdGV0LXN0\ncmVhbXEDVSBkYmQzZjhmYjQ1ZmQyZjBk</em></span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f;"><em>ZGZmNTA1ODZkNWU0ZGY3ZnEESwB0Lg==\n'</em></span></span></span></span></p>









</blockquote>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">使用</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">pickle</span><span style="font-family: 宋体;">模块对其进行解码</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">pickle.loads(y[1].decode('base64'))</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">，获得一个</span><span style="font-family: &#39;Times New Roman&#39;;">dict</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">类型的数据：</span></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="color: #000000;"><span style="background-color: #7f7f7f;"><em><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt;">name, timestamp, size, content_type, etag,deleted</span></span></span><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">=</span></span></span></em></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>('735',</em></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>'1321186733.25447',</em></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>94208,</em></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>'application/octet-stream',</em></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>'dbd3f8fb45fd2f0ddff50586d5e4df7f',</em></span></span></span></p>
<p class="p0" style="line-height: normal; text-indent: 0pt; margin-top: 0pt; margin-right: 0pt; margin-bottom: 0pt; margin-left: 30px;" align="justify"><span style="background-image: none; background-attachment: scroll; background-repeat: repeat; background-position: 0% 0%; mso-spacerun: &#39;yes&#39;; mso-shading: #7f7f7f;"><span style="font-family: &#39;Times New Roman&#39;;"><span style="font-size: 12pt; background-color: #7f7f7f; color: #000000;"><em>0)</em></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">表示一个名称为</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">’</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">735</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">’</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">，大小为</span><span style="font-family: &#39;Times New Roman&#39;;">94208B</span><span style="font-family: 宋体;">，</span><span style="font-family: &#39;Times New Roman&#39;;">md5</span><span style="font-family: 宋体;">哈希值为</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">dbd3f8fb45fd2f0ddff50586d5e4df7f</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">，可访问的字节流文件。此过程由</span><span style="font-family: &#39;Times New Roman&#39;;">ContainerBroker</span><span style="font-family: 宋体;">类的</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">_commit_puts</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">方法完成，随后使用</span><span style="font-family: &#39;Times New Roman&#39;;">put_object</span><span style="font-family: 宋体;">方法把这些数据项放入</span><span style="font-family: &#39;Times New Roman&#39;;">container db</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">表中，</span><span style="font-family: &#39;Times New Roman&#39;;">.pending</span><span style="font-family: 宋体;">文件中的数据类型与</span><span style="font-family: &#39;Times New Roman&#39;;">object</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">表中的字段定义一致。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">从</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">与</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">和</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">两者的</span><span style="font-family: &#39;Times New Roman&#39;;">pending</span><span style="font-family: 宋体;">文件处理方式中发现其不同之处在于，</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">pending</span><span style="font-family: 宋体;">文件在更新完其中的一项数据之后，删除</span><span style="font-family: &#39;Times New Roman&#39;;">pending</span><span style="font-family: 宋体;">文件中的相应的数据项，而</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">的数据在更新完成之后，移动</span><span style="font-family: &#39;Times New Roman&#39;;">pending</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">文件到目标目录。</span></span></span></span></p>
<p class="p0" style="text-indent: 0pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: -18pt; margin: 0pt 0pt 0pt 18pt;" align="justify"><span style="color: #000000;"><strong><span style="font-family: &#39;Times New Roman&#39;;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;">6. </span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;">quarantined</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">目录</span></span></span></strong></span></p>
<p class="p0" style="text-indent: 24pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">Auditor进程会在本地服务器上每隔一段时间就扫面一次磁盘来检测</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">、</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">、</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">的完整性。一旦发现不完整的数据，该文件就会被隔离，该目录就称为</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">quarantined</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">目录。为了限制</span><span style="font-family: &#39;Times New Roman&#39;;">Auditor</span><span style="font-family: 宋体;">消耗过多的系统资源，其默</span></span></span></span></p>
<p class="p0" style="text-indent: 24pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">认扫描间隔是</span><span style="font-family: &#39;Times New Roman&#39;;">30</span><span style="font-family: 宋体;">秒，每秒最大的扫描文件数为</span><span style="font-family: &#39;Times New Roman&#39;;">20</span><span style="font-family: 宋体;">，最高速率为</span><span style="font-family: &#39;Times New Roman&#39;;">10Mb/s</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">。</span></span></span></span></p>
<p class="p0" style="text-indent: 24pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">obj auditor使用</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">AuditorWorker</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">类的</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">object_audit</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">方法来检查文件的完整性，该方法封装了</span><span style="font-family: &#39;Times New Roman&#39;;">obj server</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">DiskFile</span><span style="font-family: 宋体;">类，该类有一个</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">_handle_close_quarantine</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">方法，用来检测文件是否需要被隔离，如果发现损坏，则直接将文件移动到隔离目录下。随后</span><span style="font-family: &#39;Times New Roman&#39;;">replicator</span><span style="font-family: 宋体;">从其他</span><span style="font-family: &#39;Times New Roman&#39;;">replica</span><span style="font-family: 宋体;">那拷贝新的文件来替换，最后</span><span style="font-family: &#39;Times New Roman&#39;;">Server</span><span style="font-family: 宋体;">计算文件的</span><span style="font-family: &#39;Times New Roman&#39;;">hash</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">值是否正确。整个处理流程如下所示：</span></span></span></span></p>
<p class="p0" style="text-indent: 24pt; margin: 0pt;" align="justify">&nbsp;</p>
<p><a style="line-height: normal;" href="http://images.cnblogs.com/cnblogs_com/yuxc/201207/201207040058444099.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: block; float: none; margin-left: auto; margin-right: auto; padding-top: 0px; border: 0px;" title="image" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/201207040058441035.png" alt="image" width="275" height="253" border="0"></a></p>
<div style="text-indent: 0px; text-align: center;"><em><span style="font-family: 宋体;">&nbsp;Figure7:&nbsp;<span style="font-size: 12pt;">quarantined</span><span style="font-size: 12pt;">&nbsp;</span>object处理流程</span></em></div>
<p>&nbsp;</p>
<p class="p0" style="text-indent: 24pt; text-align: justify; margin: 0pt;" align="justify"><span style="mso-spacerun: &#39;yes&#39;;"><span style="color: #000000;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">为了验证</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">auditor</span><span style="font-family: 宋体;">的有效性，做一个简单的测试，在路径为</span></span></span><span style="font-size: 12pt;"><a style="border-bottom-style: none;" name="OLE_LINK3"></a><a style="border-bottom-style: none;" name="OLE_LINK4"></a><span style="font-family: 宋体;">srv/4</span></span></span><span style="color: #000000;"><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">/</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">node/</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">sdb4/objects/210/82c/003499609ba80372d62aa39a9f9a482c/1321186693.02822.data</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">的文件中随意写入了一串字符。约过了</span><span style="font-family: &#39;Times New Roman&#39;;">10</span><span style="font-family: 宋体;">秒之后，发现</span><span style="font-family: &#39;Times New Roman&#39;;">sdb4/</span><span style="font-family: 宋体;">目录下建立了一个</span><span style="font-family: &#39;Times New Roman&#39;;">quarantined</span><span style="font-family: 宋体;">目录，其中包含</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">目录，里面损坏了的文件，其路径为</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">/srv/4/node/sdb4/quarantined/objects/003499609ba80372d62aa39a9f9a482c/1321186693.02822.data</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">。此时，打开原目录下的文件，已恢复为修改前的状态。</span></span></span></span></p>
<p class="p0" style="text-indent: 24pt; text-align: justify; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">account使用</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">AccountAuditor</span><span style="font-family: 宋体;">类的</span></span></span><span style="font-size: 12pt;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">account_audit</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">方法，</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">使用</span><span style="font-family: &#39;Times New Roman&#39;;">ContainerAuditor</span><span style="font-family: 宋体;">类的</span><span style="font-family: &#39;Times New Roman&#39;;">container</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">_audit</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;">方法对目录下的</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">文件进行检查。然而，我在测试时，对</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">目录下的某</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">文件进行了修改，大约经过了数分钟后，该</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">文件才被隔离。在阅读源代码时，发现</span><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">和</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">的</span><span style="font-family: &#39;Times New Roman&#39;;">auditor</span><span style="font-family: 宋体;">的扫面间隔与</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">差异较大。在类初始化时设置了一个</span><span style="font-family: &#39;Times New Roman&#39;;">interval</span><span style="font-family: 宋体;">的变量，默认为</span><span style="font-family: &#39;Times New Roman&#39;;">1800s</span><span style="font-family: 宋体;">，然后在</span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: &#39;Times New Roman&#39;;">run_forever</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-size: 12pt;"><span style="font-family: 宋体;">中传入该参数到</span><span style="font-family: &#39;Times New Roman&#39;;">random</span><span style="font-family: 宋体;">函数来设置休眠时间，每次执行的间隔在</span><span style="font-family: &#39;Times New Roman&#39;;">180~1800s</span><span style="font-family: 宋体;">之间，也就是</span><span style="font-family: &#39;Times New Roman&#39;;">3</span><span style="font-family: 宋体;">到</span><span style="font-family: &#39;Times New Roman&#39;;">30</span><span style="font-family: 宋体;">分钟。设置较长间隔的原因，我认为主要是由于每次检查</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">文件前，需要锁住</span><span style="font-family: &#39;Times New Roman&#39;;">db</span><span style="font-family: 宋体;">文件，如果检查的频率过于频繁会影响存储节点的</span><span style="font-family: &#39;Times New Roman&#39;;">db</span></span><span style="font-family: 宋体;"><span style="font-size: 12pt;">正常的读写性能。</span></span></span></span></p>
<p class="p0" style="text-indent: 24pt; text-align: justify; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 0pt; text-align: justify; margin: 0pt;" align="left"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt; color: #000000;"><strong>总结</strong></span></span></span></p>
<p class="p0" style="text-indent: 24pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">存储结点上的各路径由不同的进程产生和维护，</span></span><span style="font-size: 12pt;"><span style="font-family: &#39;Times New Roman&#39;;">Accounts</span><span style="font-family: 宋体;">目录存放了关于</span><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">的信息，主要记录</span><span style="font-family: &#39;Times New Roman&#39;;">account</span><span style="font-family: 宋体;">下的</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">信息，</span><span style="font-family: &#39;Times New Roman&#39;;">Containes</span><span style="font-family: 宋体;">目录存放了关于&nbsp;</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">的信息，主要记录了该</span><span style="font-family: &#39;Times New Roman&#39;;">container</span><span style="font-family: 宋体;">下的</span><span style="font-family: &#39;Times New Roman&#39;;">object</span><span style="font-family: 宋体;">信息，</span><span style="font-family: &#39;Times New Roman&#39;;">Objects</span><span style="font-family: 宋体;">目录则是存放了文件的数据和元数据，</span><span style="font-family: &#39;Times New Roman&#39;;">tmp</span><span style="font-family: 宋体;">目录用于数据写入以上目录前的临时目录，&nbsp;</span><span style="font-family: &#39;Times New Roman&#39;;">async_pending</span><span style="font-family: 宋体;">存放未能及时更新而被加入更新队列的数据，</span><span style="font-family: &#39;Times New Roman&#39;;">quaraninued</span><span style="font-family: 宋体;">路径用于隔离发生损坏的数据</span></span></span><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">。</span></span></span></span></p>
<p class="p0" style="text-indent: 24pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 24pt; margin: 0pt;" align="justify">&nbsp;</p>
<p class="p0" style="text-indent: 24pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp;</span></span></span></span></p>
<p class="p0" style="text-indent: 24pt; margin: 0pt;" align="justify"><span style="color: #000000;"><span style="mso-spacerun: &#39;yes&#39;;"><span style="font-family: 宋体;"><span style="font-size: 12pt;">&nbsp;</span></span></span></span></p>











</div></div><div id="MySignature"><br>
<br>
<p><span style="font-family: 幼圆; color: #000000; font-size: 14px;">---</span><span style="font-family: Comic Sans MS; color: #000000; font-size: 14px">我是低调的不显眼的简洁的不会被敌人发现的分割</span><span style="font-family: 幼圆; color: #000000; font-size: 14px">线---</span></p>
<!-- JiaThis 代码 -->
<div id="jiathis_style_32x32">
<a class="jiathis_button_tsina" title="分享到新浪微博"><span class="jiathis_txt jtico jtico_tsina"></span></a>
<a class="jiathis_button_tqq" title="分享到腾讯微博"><span class="jiathis_txt jtico jtico_tqq"></span></a>
<a class="jiathis_button_renren" title="分享到人人网"><span class="jiathis_txt jtico jtico_renren"></span></a>
<a class="jiathis_button_kaixin001" title="分享到开心网"><span class="jiathis_txt jtico jtico_kaixin001"></span></a>
<a class="jiathis_button_douban" title="分享到豆瓣"><span class="jiathis_txt jtico jtico_douban"></span></a>
<a class="jiathis_button_hi" title="分享到百度空间"><span class="jiathis_txt jtico jtico_hi"></span></a>
<a class="jiathis_button_fanfou" title="分享到饭否"><span class="jiathis_txt jtico jtico_fanfou"></span></a>
<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
<a class="jiathis_counter_style"><span class="jiathis_button_expanded jiathis_counter jiathis_bubble_style" id="jiathis_counter_33" title="累计分享2次">2</span></a>
</div>
<div style="position:absolute;width:0px;height:0px;"><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="0" height="0" id="JIATHISSWF" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab"><param name="allowScriptAccess" value="always"><param name="swLiveConnect" value="true"><param name="movie" value="http://www.jiathis.com/code/swf/m.swf"><param name="FlashVars" value="z=a"><embed name="JIATHISSWF" src="http://www.jiathis.com/code/swf/m.swf" flashvars="z=a" width="0" height="0" allowscriptaccess="always" swliveconnect="true" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer"></object></div><!-- JiaThis Button END -->
<br>
<!-- 自定义代码 -->
<br>
<div style="background-color: #a2dcea;">
<p><span style="font-family: Georgia; color: #000000; font-size: 12pt">&nbsp;&nbsp;&nbsp;&nbsp; This </span><span style="font-family: Georgia; color: #ff6600; font-size: 12pt">article</span><span style="font-family: Georgia; color: #ff0000; font-size: 12pt"> Powered </span><span style="font-family: Georgia; color: #008000; font-size: 12pt">by </span><strong><span style="font-family: Georgia; color: #0000ff; font-size: 12pt">努力</span><span style="font-family: Georgia; color: #0000ff; font-size: 12pt">的</span><span style="color: #808080; font-size: 12pt">牛皮</span><span style="color: #808080; font-size: 12pt">糖</span></strong><span></span></p>
<div><strong><span style="color: #00ccff;"><span style="font-family: 宋体;"><span style="color: #0000ff;"><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium Simsun; white-space: normal; orphans: 2; letter-spacing: normal; color: #000000; word-spacing: 0px;"><span style="line-height: 21px; font-family: Comic Sans MS; color: #0000ff; font-size: 10pt">&nbsp;&nbsp; &nbsp; 新手上路，不恰之处，恳请指出，不胜感谢</span></span></span></span></span></strong></div>
<p><strong><span style="color: #00ccff"><span style="font-family: 宋体"><span style="font-family: Comic Sans MS; color: #0000ff; font-size: 10pt">&nbsp;&nbsp; 转载请注明出处</span><span style="font-family: Comic Sans MS; color: #0000ff; font-size: 10pt">“</span><span style="color: #0000ff"><a href="http://www.cnblogs.com/yuxc/"><font color="#000000"><span style="font-family: Comic Sans MS; font-size: 10pt">一块努力的牛皮糖</span></font></a></span><span style="font-family: Comic Sans MS; color: #0000ff; font-size: 10pt">”：<a href="http://www.cnblogs.com/yuxc/"><font color="#000000"><span style="font-family: Comic Sans MS; font-size: 10pt">http://www.cnblogs.com/yuxc/</span></font></a></span></span></span></strong></p>
<p><strong><span style="color: #00ccff;"><span style="font-family: 宋体;"><span style="color: #0000ff;"><span style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium Simsun; white-space: normal; orphans: 2; letter-spacing: normal; color: #000000; word-spacing: 0px;" class="Apple-style-span"><span style="line-height: 21px; font-family: Comic Sans MS; color: #0000ff; font-size: 10pt" class="Apple-style-span"></span></span></span></span></span></strong></p>
</div>
</div>
<script type="text/javascript">
var isLogined = false;
var cb_blogId = 88100;
var cb_entryId = 2575536;
var cb_blogApp = currentBlogApp;
var cb_blogUserGuid = "4e16972c-ba5d-e011-a53f-842b2b196315";
var cb_entryCreatedDate = '2012/7/4 10:00:00';
var enableGoogleAd = true;
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
</script>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="blog_post_info"><div id="BlogPostCategory">分类: <a href="http://www.cnblogs.com/yuxc/category/324510.html">Swift云存储</a></div>
<div id="EntryTag">标签: <a href="http://www.cnblogs.com/yuxc/tag/Swift/">Swift</a>, <a href="http://www.cnblogs.com/yuxc/tag/openstack/">openstack</a>, <a href="http://www.cnblogs.com/yuxc/tag/Object%20storage/">Object storage</a>, <a href="http://www.cnblogs.com/yuxc/tag/%E5%88%86%E6%9E%90/">分析</a></div>
<div id="green_channel">
绿色通道：
<a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(cb_entryId,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
<a id="green_channel_follow" onclick="c_follow();" href="javascript:void(0);">关注我</a>
<a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a><a id="green_channel_contact" href="http://space.cnblogs.com/msg/send/%e7%89%9b%e7%9a%ae%e7%b3%96NewPtone" target="_blank">与我联系</a>
<a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/icon_weibo_24.png" alt=""></a>
</div>
<div id="digg_block">
<div id="author_profile">
<div id="author_profile_info" class="author_profile_info">
<a href="http://home.cnblogs.com/u/yuxc/" target="_blank"><img src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/u288756.jpg" class="author_avatar" alt=""></a>
<div id="author_profile_detail" class="author_profile_info">
<a href="http://home.cnblogs.com/u/yuxc/">牛皮糖NewPtone</a><br>
<a href="http://home.cnblogs.com/u/yuxc/followees">关注 - 50</a><br>
<a href="http://home.cnblogs.com/u/yuxc/followers">粉丝 - 98</a>
</div>
</div>
<div class="clear"></div>
<div id="author_profile_honor"></div>
<div id="author_profile_follow">
<a href="javascript:void(0);" onclick="c_follow();return false;">+加关注</a>
</div>
</div>
<div id="div_digg">										
	<div class="diggit" onclick="votePost(cb_entryId,&#39;Digg&#39;)"> 
		<span class="diggnum" id="digg_count">5</span>
	</div>
	<div class="buryit" onclick="votePost(cb_entryId,&#39;Bury&#39;)"> 
		<span class="burynum" id="bury_count">0</span>
	</div>
	<div class="clear"></div>	
	<div class="diggword" id="digg_tips">
    (请您对文章做出评价)
    </div>	
</div>
</div></div>
<div class="clear"></div>
<div id="post_next_prev"><a href="http://www.cnblogs.com/yuxc/archive/2012/06/28/2568584.html" class="p_n_p_prefix">« </a> 上一篇：<a href="http://www.cnblogs.com/yuxc/archive/2012/06/28/2568584.html" title="发布于2012-06-28 18:30">深入云存储系统Swift核心组件：Ring数据结构及构建、重平衡操作</a><br><a href="http://www.cnblogs.com/yuxc/archive/2012/07/11/2586950.html" class="p_n_p_prefix">» </a> 下一篇：<a href="http://www.cnblogs.com/yuxc/archive/2012/07/11/2586950.html" title="发布于2012-07-11 21:10">解决Mac OS X下bash: alias: ll: not found的问题</a><br></div>
</div>
<script type="text/javascript">
    //SyntaxHighlighter.config.strings.expandSource = '<span><img src="http://static.cnblogs.com/images/expand-code.gif" alt="" class="expand-code-icon"/>View Code</span>';
    $(function () {  
        loadViewCount(cb_entryId);
        fixPostBodyFormat();
        loadAdUnderPost();
        loadBlogSignature();
        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);        
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);        
    });
</script>
		</div>
		<div class="postDesc">posted @ <span id="post-date">2012-07-04 10:00</span> <a href="http://www.cnblogs.com/yuxc/">牛皮糖NewPtone</a> 阅读(<span id="post_view_count">2600</span>) 评论(<span id="post_comment_count">19</span>)  <a href="http://www.cnblogs.com/yuxc/admin/EditPosts.aspx?postid=2575536" rel="nofollow">编辑</a> <a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#" onclick="AddToWz(2575536);return false;">收藏</a></div>
	</div>
	<script src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/2575536" type="text/javascript"></script>
	
</div><!--end: topics 文章、评论容器-->
<div id="blog-comments-placeholder"><div id="comments_pager_top"></div>
<!--done-->
<div class="feedback_area_title">评论列表</div>
<div class="feedbackNoItems"></div>
	

		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2416867" class="layer">#1楼</a><a name="2416867" id="comment_anchor_2416867"></a>  <span class="comment_date">2012-07-04 10:25</span> <a id="a_comment_author_2416867" href="http://www.cnblogs.com/iMetro/" target="_blank">iMetro</a> <a href="http://space.cnblogs.com/msg/send/iMetro" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2416867" class="blog_comment_body">进来啥也不做，顶了你的文章再说。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2416867,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2416867,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2416867_avatar" style="display:none;">http://pic.cnitblog.com/face/u394147.png?id=27104505</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2416939" class="layer">#2楼</a><a name="2416939" id="comment_anchor_2416939"></a>  <span class="comment_date">2012-07-04 10:58</span> <a id="a_comment_author_2416939" href="http://www.cnblogs.com/jinzhao/" target="_blank">今昭</a> <a href="http://space.cnblogs.com/msg/send/%e4%bb%8a%e6%98%ad" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2416939" class="blog_comment_body">一看就是好文，推荐~</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2416939,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2416939,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2416939_avatar" style="display:none;">http://pic.cnitblog.com/face/22791/20130710114318.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2417339" class="layer">#3楼</a><a name="2417339" id="comment_anchor_2417339"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2012-07-04 14:13</span> <a id="a_comment_author_2417339" href="http://www.cnblogs.com/yuxc/" target="_blank">牛皮糖NewPtone</a> <a href="http://space.cnblogs.com/msg/send/%e7%89%9b%e7%9a%ae%e7%b3%96NewPtone" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2417339" class="blog_comment_body"><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2416867" title="查看所回复的评论">@</a>iMetro<br>感谢支持哈～</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2417339,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2417339,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2417339_avatar" style="display:none;">http://pic.cnitblog.com/face/u288756.jpg?id=05165748</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2417340" class="layer">#4楼</a><a name="2417340" id="comment_anchor_2417340"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2012-07-04 14:13</span> <a id="a_comment_author_2417340" href="http://www.cnblogs.com/yuxc/" target="_blank">牛皮糖NewPtone</a> <a href="http://space.cnblogs.com/msg/send/%e7%89%9b%e7%9a%ae%e7%b3%96NewPtone" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2417340" class="blog_comment_body"><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2416939" title="查看所回复的评论">@</a>今昭<br>感谢支持～</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2417340,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2417340,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2417340_avatar" style="display:none;">http://pic.cnitblog.com/face/u288756.jpg?id=05165748</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2436120" class="layer">#5楼</a><a name="2436120" id="comment_anchor_2436120"></a>  <span class="comment_date">2012-07-27 15:31</span> <a id="a_comment_author_2436120" href="http://home.cnblogs.com/u/402595/" target="_blank">BUYI</a> <a href="http://space.cnblogs.com/msg/send/BUYI" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2436120" class="blog_comment_body">小弟刚开始看swift<br>请问 从使用角度或者说从管理员角度说<br>常用的命令和操作是什么样的？<br>怎么简单的开始使用和测试swift存储<br><br>不胜感激~</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2436120,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2436120,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2436571" class="layer">#6楼</a><a name="2436571" id="comment_anchor_2436571"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2012-07-28 15:01</span> <a id="a_comment_author_2436571" href="http://www.cnblogs.com/yuxc/" target="_blank">牛皮糖NewPtone</a> <a href="http://space.cnblogs.com/msg/send/%e7%89%9b%e7%9a%ae%e7%b3%96NewPtone" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2436571" class="blog_comment_body"><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2436120" title="查看所回复的评论">@</a>BUYI<br>shell下输入swift然后按TAB补全，然后查看每个命令的用法，看官方的SAIO的安装文档，或者看我以前写的文档</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2436571,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2436571,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2436571_avatar" style="display:none;">http://pic.cnitblog.com/face/u288756.jpg?id=05165748</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2438930" class="layer">#7楼</a><a name="2438930" id="comment_anchor_2438930"></a>  <span class="comment_date">2012-08-01 11:00</span> <a id="a_comment_author_2438930" href="http://home.cnblogs.com/u/433266/" target="_blank">chb19871001</a> <a href="http://space.cnblogs.com/msg/send/chb19871001" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2438930" class="blog_comment_body">小兄弟你好！<br>看了你的文章学习了不少。<br>我现在有几个问题想请教下你：<br>ring文件是不是每个storage node都会存储？如果是的话，那么每台机子的ring文件是不是都是一样的？如果是一样的，那么，在当我需要查找object的时候，swift是从哪台机子的ring文件去查找映射信息？<br>另外，如果每台机子都存储有ring，那么怎么保证这些ring文件的一致性？意思是当上传一个object的时候需要更新ring文件，那怎么同步更新到每台机子的ring文件？<br><br>问题有点多，在网上找了一下没找到答案，在这里请教你哈。<br>不怎么懂python，看源码很费力～呵呵～</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2438930,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2438930,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2439032" class="layer">#8楼</a><a name="2439032" id="comment_anchor_2439032"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2012-08-01 12:47</span> <a id="a_comment_author_2439032" href="http://www.cnblogs.com/yuxc/" target="_blank">牛皮糖NewPtone</a> <a href="http://space.cnblogs.com/msg/send/%e7%89%9b%e7%9a%ae%e7%b3%96NewPtone" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2439032" class="blog_comment_body"><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2438930" title="查看所回复的评论">@</a>chb19871001<br>是的，ring文件每台node上都会存储，ring文件通过rsync进行同步，会有相应的进程每隔一定时间检查ring文件是否发生变化来重新载入，在查询object的位置时，都是从本机的object.ring.gz文件查询（已载入内存）。<br>上传object的时候不需要更新ring文件，因为object的位置是根据它的文件名+路径的哈希值来计算的。ring文件里已经规定好每个哈希值属于哪个partition了。所以每当上传一个object的时候，object server通过ring文件就可以计算出把它上传到哪个node的哪个partition上去</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2439032,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2439032,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2439032_avatar" style="display:none;">http://pic.cnitblog.com/face/u288756.jpg?id=05165748</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2439124" class="layer">#9楼</a><a name="2439124" id="comment_anchor_2439124"></a>  <span class="comment_date">2012-08-01 14:47</span> <a id="a_comment_author_2439124" href="http://home.cnblogs.com/u/433266/" target="_blank">chb19871001</a> <a href="http://space.cnblogs.com/msg/send/chb19871001" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2439124" class="blog_comment_body"><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2439032" title="查看所回复的评论">@</a>牛皮糖NewPtone<br>嘿，谢谢解答。<br>如果ring只是在增减节点时才更新，那么在更新时才将新的ring同步到其他机器吧（新增node的时候是不是在就近的node那里计算新的ring然后再同步到其他node？）。这样的话rsync不就多余了？因为没有增减节点的时候不需要去同步ring。还是说rsync除了同步ring之外还同步其他数据？<br>还有一个问题哦，当上传一个object的时候，需要产生3份数据（副本），那经过hash计算后object应该只定位到某一个partition，然后再定位到某个node，那么另外2个副本该存储到哪个partition？这里面是怎么定义副本存放的位置的？<br>～～</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2439124,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2439124,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2439355" class="layer">#10楼</a><a name="2439355" id="comment_anchor_2439355"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2012-08-01 19:25</span> <a id="a_comment_author_2439355" href="http://www.cnblogs.com/yuxc/" target="_blank">牛皮糖NewPtone</a> <a href="http://space.cnblogs.com/msg/send/%e7%89%9b%e7%9a%ae%e7%b3%96NewPtone" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2439355" class="blog_comment_body"><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2439124" title="查看所回复的评论">@</a>chb19871001<br>rsync要负责object、container、account、ring数据的更新。<br>object以及副本的位置通过计算该object的哈希值，然后去ring中查询应该存储在哪3个node上。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2439355,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2439355,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2439355_avatar" style="display:none;">http://pic.cnitblog.com/face/u288756.jpg?id=05165748</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2440175" class="layer">#11楼</a><a name="2440175" id="comment_anchor_2440175"></a>  <span class="comment_date">2012-08-02 17:43</span> <a id="a_comment_author_2440175" href="http://home.cnblogs.com/u/433856/" target="_blank">Allen Guo</a> <a href="http://space.cnblogs.com/msg/send/Allen+Guo" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2440175" class="blog_comment_body">Hi<br>在文档中我读到下面一句:“If a replicator detects that a remote drive is has failed, it will use the ring’s “get_more_nodes” interface to choose an alternate node to synchronize with." 按这句话的意思我的理解是：副本丢失(drive is has failed)的情况下,为了保持副本数，会改变相应partition到node的对应关系，请问这种改变是怎样同步到其他node？谢谢.</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2440175,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2440175,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2440440" class="layer">#12楼</a><a name="2440440" id="comment_anchor_2440440"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2012-08-03 08:09</span> <a id="a_comment_author_2440440" href="http://www.cnblogs.com/yuxc/" target="_blank">牛皮糖NewPtone</a> <a href="http://space.cnblogs.com/msg/send/%e7%89%9b%e7%9a%ae%e7%b3%96NewPtone" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2440440" class="blog_comment_body"><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2440175" title="查看所回复的评论">@</a>Allen Guo<br>非也，这句话是说明三副本带来的高可用性，如果replicator进程检测到对远程node执行同步操作失败，那么它就会通过ring类提供的get_more_nodes接口来获得其他副本存放的node进行同步。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2440440,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2440440,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2440440_avatar" style="display:none;">http://pic.cnitblog.com/face/u288756.jpg?id=05165748</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2567494" class="layer">#13楼</a><a name="2567494" id="comment_anchor_2567494"></a>  <span class="comment_date">2012-11-30 16:40</span> <a id="a_comment_author_2567494" href="http://home.cnblogs.com/u/464667/" target="_blank">zous</a> <a href="http://space.cnblogs.com/msg/send/zous" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2567494" class="blog_comment_body">牛哥 Partition到底是个什么啊  怎么在objects，containers，accounts目录里都有呢，然后在我的理解partition是虚节点，不是在一致性哈希算法里用上的么？然后还想请教一下，之前看了一些文档包括你翻译的那个openstack的文档，我一直觉得accounts目录里应该能够包含containers，然后objects目录在containers里，然后看了你这些我觉得有些迷茫~求答疑啊</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2567494,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2567494,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2568076" class="layer">#14楼</a><a name="2568076" id="comment_anchor_2568076"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2012-12-01 21:04</span> <a id="a_comment_author_2568076" href="http://www.cnblogs.com/yuxc/" target="_blank">牛皮糖NewPtone</a> <a href="http://space.cnblogs.com/msg/send/%e7%89%9b%e7%9a%ae%e7%b3%96NewPtone" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2568076" class="blog_comment_body"><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2567494" title="查看所回复的评论">@</a>zous<br>partition见我前面一篇文章，为了减少每次集群节点变化时的数据迁移量，是swift中数据迁移的最小单位。account的db表里面有记录container的信息，container则有记录object的信息。<br>但是它们的目录是平行的，acc和con目录存的是sqlite数据库文件，obj目录里存的就是数据文件了。每个都有相应的服务(account-server,container-server,obejct-server)来管理。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2568076,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2568076,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2568076_avatar" style="display:none;">http://pic.cnitblog.com/face/u288756.jpg?id=05165748</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2568466" class="layer">#15楼</a><a name="2568466" id="comment_anchor_2568466"></a>  <span class="comment_date">2012-12-02 23:08</span> <a id="a_comment_author_2568466" href="http://home.cnblogs.com/u/464667/" target="_blank">zous</a> <a href="http://space.cnblogs.com/msg/send/zous" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2568466" class="blog_comment_body">呵呵 嗯嗯 听你这么说我好想懂了 谢谢牛哥</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2568466,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2568466,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2569333" class="layer">#16楼</a><a name="2569333" id="comment_anchor_2569333"></a>  <span class="comment_date">2012-12-03 22:55</span> <a id="a_comment_author_2569333" href="http://home.cnblogs.com/u/464667/" target="_blank">zous</a> <a href="http://space.cnblogs.com/msg/send/zous" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2569333" class="blog_comment_body">牛哥 我现在环境有了 有三个问题想请教下你<br>1、我这个device目录下面没有 async_pending和 quarantined 两个目录 是不是因为我的链接和更新都成功 ，没有不完整的数据吗？<br>2、我现在配的节点只有三个节点  然后我发现三个节点里存的东西都一样 是因为系统默认存了两份冗余么？<br>3、最后Accountdb与Containerdb在哪呢 我在mysql里找不到啊</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2569333,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2569333,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2571783" class="layer">#17楼</a><a name="2571783" id="comment_anchor_2571783"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2012-12-06 18:33</span> <a id="a_comment_author_2571783" href="http://www.cnblogs.com/yuxc/" target="_blank">牛皮糖NewPtone</a> <a href="http://space.cnblogs.com/msg/send/%e7%89%9b%e7%9a%ae%e7%b3%96NewPtone" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2571783" class="blog_comment_body"><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2569333" title="查看所回复的评论">@</a>zous<br><br>1.你可以写个脚本，并发上传大量文件，然后切换到swift的挂载目录下观察<br><br>2.对啊，swift的数据默认是存三份的<br><br><br>3.account和container用的是sqlite啊，去相应的目录下查看</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2571783,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2571783,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2571783_avatar" style="display:none;">http://pic.cnitblog.com/face/u288756.jpg?id=05165748</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2571893" class="layer">#18楼</a><a name="2571893" id="comment_anchor_2571893"></a>  <span class="comment_date">2012-12-06 22:21</span> <a id="a_comment_author_2571893" href="http://home.cnblogs.com/u/464667/" target="_blank">zous</a> <a href="http://space.cnblogs.com/msg/send/zous" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2571893" class="blog_comment_body"><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2571783" title="查看所回复的评论">@</a>牛皮糖NewPtone<br>嗯 谢谢牛哥 <br>那个我安装了sqlite 然后打开出现这样的 <br><br> sqlite 84c00d645829e45957a037353fb533a2.db<br>提示：<br>Unable to open database "84c00d645829e45957a037353fb533a2.db": unable to open database: 84c00d645829e45957a037353fb533a2.db<br>  <br><br>然后我用VI 和cat打开 都勉强能看 但是有点乱码 肿么回事呀</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2571893,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2571893,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2726683" class="layer">#19楼</a><a name="2726683" id="comment_anchor_2726683"></a><span id="comment-maxId" style="display:none;">2726683</span><span id="comment-maxDate" style="display:none;">2013/7/14 0:02:12</span>  <span class="comment_date">2013-07-14 00:02</span> <a id="a_comment_author_2726683" href="http://www.cnblogs.com/lizhe88/" target="_blank">IntoTheRain</a> <a href="http://space.cnblogs.com/msg/send/IntoTheRain" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2726683" class="blog_comment_body">作者有没有研究过riak，和swift类似的云存储，用erlang编写，apache lisence。有兴趣可以一起讨论。<br><a href="http://basho.com/riak/" target="_blank">http://basho.com/riak/</a></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2726683,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2726683,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	<div id="comments_pager_bottom"></div></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" id="lnk_RefreshComments" onclick="return RefreshCommentList();">刷新评论</a><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#" onclick="return RefreshPage();">刷新页面</a><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#top">返回顶部</a></div>
<div id="comment_form_container"><div class="login_tips">注册用户登录后才能发表评论，请 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return login(&#39;commentform&#39;);">登录</a> 或 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return register();">注册</a>，<a href="http://www.cnblogs.com/">访问</a>网站首页。</div></div>

<script type="text/javascript">
    if (typeof commentManager === 'undefined') {
        commentManager = new blogCommentManager();
    }
    commentManager.loadCommentForm();   
</script>

<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="site_nav_under"><a href="http://www.cnblogs.com/" target="_blank" title="程序员的网上家园">博客园首页</a><a href="http://q.cnblogs.com/" target="_blank" title="程序员问答社区">博问</a><a href="http://news.cnblogs.com/" target="_blank" title="IT新闻">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a></div>
<div id="ad_under_post_holder">
<div id="google_ad_c1" class="c_ad_block">
    <!-- cnblogs_blogpost_C1_sitehome -->
    <div id="div-gpt-ad-1346480159711-0" style="width:300px; height:250px;">
    
    <iframe id="google_ads_iframe_/1090369/cnblogs_blogpost_C1_sitehome_0" name="google_ads_iframe_/1090369/cnblogs_blogpost_C1_sitehome_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:"<html><body style='background:transparent'></body></html>"" style="border: 0px; vertical-align: bottom;"></iframe><iframe id="google_ads_iframe_/1090369/cnblogs_blogpost_C1_sitehome_0__hidden__" name="google_ads_iframe_/1090369/cnblogs_blogpost_C1_sitehome_0__hidden__" width="0" height="0" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:"<html><body style='background:transparent'></body></html>"" style="border: 0px; vertical-align: bottom; visibility: hidden; display: none;"></iframe></div>
</div>
<div id="blog_news_kb"><div class="itnews c_ad_block"><b>最新IT新闻</b>:<br> ·  <a href="http://news.cnblogs.com/n/182345/" target="_blank">果冻豆迅速普及难解决Android碎片化问题</a><br> ·  <a href="http://news.cnblogs.com/n/182344/" target="_blank">阿里技术嘉年华7月14日上午场内容</a><br> ·  <a href="http://news.cnblogs.com/n/182343/" target="_blank">德国电信开售阿卡手机 搭载Firefox OS</a><br> ·  <a href="http://news.cnblogs.com/n/182342/" target="_blank">世界级3D设计师拉斐尔•格拉萨蒂访谈录</a><br> ·  <a href="http://news.cnblogs.com/n/182341/" target="_blank">Gartner：三星苹果将继续上演“双雄争霸”</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div><div class="itnews c_ad_block" id="kb_block"><b>最新知识库文章</b>:<br><div id="kb_recent"> ·  <a href="http://kb.cnblogs.com/page/182265/" target="_blank">硅谷归来7点分享：创业者，做你自己</a><br> ·  <a href="http://kb.cnblogs.com/page/182200/" target="_blank">我为什么不能坚持？</a><br> ·  <a href="http://kb.cnblogs.com/page/168725/" target="_blank">成为高效程序员的7个重要习惯</a><br> ·  <a href="http://kb.cnblogs.com/page/182047/" target="_blank">谈谈对BPM的理解</a><br> ·  <a href="http://kb.cnblogs.com/page/175976/" target="_blank">编程从业五年的十四条经验，句句朴实</a><br></div>» <a href="http://kb.cnblogs.com/" target="_blank">更多知识库文章...</a></div></div>
<div id="google_ad_c2" class="c_ad_block">
    <!-- cnblogs_blogpost_C2_sitehome -->
    <div id="div-gpt-ad-1346479110744-1" style="width:468px; height:60px;">
    
    <iframe id="google_ads_iframe_/1090369/cnblogs_blogpost_C2_sitehome_0" name="google_ads_iframe_/1090369/cnblogs_blogpost_C2_sitehome_0" width="468" height="60" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="javascript:"<html><body style='background:transparent'></body></html>"" style="border: 0px; vertical-align: bottom;"></iframe></div>
</div></div>
<div id="HistoryToday" class="c_ad_block"></div>
</div>





	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">牛皮糖的Blog</h3>
	<div id="blog-news"><div>
<div><span style="font-family: Comic Sans MS; color: #800080">This is a newbie' Blog...</span><span style="color: #0000ff"><span style="color: #0000ff"><span style="color: #0000ff"><img alt="" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/224027861.gif"></span></span></span></div></div>
<p><span style="font-family: Comic Sans MS; color: #ff6600">Welcome here,If you like...</span><span style="color: #0000ff"><span style="color: #0000ff"><img alt="" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/224026855.gif"></span></span></p><p>&nbsp;</p><p><span style="font-family: &#39;Comic Sans MS&#39;; color: #0000ff; ">You could do something as follows:&nbsp;</span></p><div><ul><li><a href="http://www.cnblogs.com/yuxc/rss" rel="nofollow" target="_blank"><img border="0" alt="订阅我的博客" align="absMiddle" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/feed-icon32x32.png" style="border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; border-bottom-width: medium; border-bottom-color: initial; border-left-width: medium; border-left-color: initial; border-top-width: medium; border-top-color: initial; border-right-width: medium; border-right-color: initial; ">&nbsp;订阅我的博客</a>&nbsp;</li><li><a href="http://weibo.com/nupta" rel="nofollow" target="_blank"><img border="0" alt="" align="absMiddle" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/sina.jpg" style="border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; ">&nbsp;我的新浪微博</a>&nbsp;</li><li><a href="http://www.douban.com/people/Nupta/" target="_blank"><img align="absMiddle" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/douban.jpg" width="32" height="32" border="0" alt="" style="border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; ">&nbsp;我的豆瓣</a>&nbsp;</li><li><a href="http://blog.163.com/yuxcer@126/" target="_blank"><img alt="YuxcBlog" align="absMiddle" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/ava.s" width="32" height="32" border="0" style="border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; ">&nbsp;我的网易博客</a>&nbsp;</li><li><a href="http://www.google.com/reader/view/feed/http://www.cnblogs.com/yuxc/rss" rel="nofollow" target="_blank"><img border="0" alt="通过Google订阅本站" align="absMiddle" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/icon_subshot01_google.gif" style="border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; "></a></li><li><a href="http://www.xianguo.com/subscribe.php?url=http://www.cnblogs.com/yuxc/rss" rel="nofollow" target="_blank"><img border="0" alt="通过鲜果订阅本站" align="absMiddle" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/icon_subshot01_xianguo.gif" style="border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; "></a></li><li><a href="http://www.zhuaxia.com/add_channel.php?url=http://www.cnblogs.com/yuxc/rss" target="_blank"><img border="0" alt="抓虾" vspace="2" align="absMiddle" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/icon_subshot01_zhuaxia.gif" style="border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; margin-bottom: 3px; "></a></li></ul></div><div id="profile_block">昵称：<a href="http://home.cnblogs.com/u/yuxc/">牛皮糖NewPtone</a><br>园龄：<a href="http://home.cnblogs.com/u/yuxc/" title="入园时间：2011-04-03">2年3个月</a><br>粉丝：<a href="http://home.cnblogs.com/u/yuxc/followers/">98</a><br>关注：<a href="http://home.cnblogs.com/u/yuxc/followees/">50</a><div id="p_b_follow"><a href="javascript:void(0);" onclick="cnblogs.UserManager.FollowBlogger(&#39;4e16972c-ba5d-e011-a53f-842b2b196315&#39;)">+加关注</a></div></div></div>
</div>

			<div id="calendar"><div id="blog-calendar" style="displya:none"></div></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn">

<div class="mySearch">
<h3 class="catListTitle">搜索</h3>
<div id="widget_my_zzk" class="div_my_zzk"><input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk"></div>

</div>


<div class="catListPostCategory">
<h3 class="catListTitle">随笔分类<span style="font-size:11px;font-weight:normal">(218)</span></h3>

<ul>

<li><a id="ctl01_CatList_LinkList_0_Link_0" href="http://www.cnblogs.com/yuxc/category/416768.html">DevOps(6)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_1" href="http://www.cnblogs.com/yuxc/category/359533.html">Linux集市(24)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_2" href="http://www.cnblogs.com/yuxc/category/400759.html">Mac OS(1)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_3" href="http://www.cnblogs.com/yuxc/category/416451.html">OpenStack云计算(7)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_4" href="http://www.cnblogs.com/yuxc/category/296453.html">Project 1：Audio(5)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_5" href="http://www.cnblogs.com/yuxc/category/296463.html">Project 2：Grid(7)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_6" href="http://www.cnblogs.com/yuxc/category/431506.html">Puppet(2)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_7" href="http://www.cnblogs.com/yuxc/category/296461.html">PYMOTW(1)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_8" href="http://www.cnblogs.com/yuxc/category/314865.html">Python美味食谱(9)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_9" href="http://www.cnblogs.com/yuxc/category/307122.html">Python自然语言处理(71)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_10" href="http://www.cnblogs.com/yuxc/category/410887.html">StackOps(3)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_11" href="http://www.cnblogs.com/yuxc/category/324510.html">Swift云存储(18)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_12" href="http://www.cnblogs.com/yuxc/category/296455.html">ThinkPython(7)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_13" href="http://www.cnblogs.com/yuxc/category/493381.html">生活和思考(1)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_14" href="http://www.cnblogs.com/yuxc/category/318339.html">数据库(2)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_15" href="http://www.cnblogs.com/yuxc/category/313480.html">网络编程(4)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_16" href="http://www.cnblogs.com/yuxc/category/307123.html">我在看的书(7)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_17" href="http://www.cnblogs.com/yuxc/category/296458.html">形式化技术(7)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_18" href="http://www.cnblogs.com/yuxc/category/296450.html">有趣的Python(22)</a> </li>

<li><a id="ctl01_CatList_LinkList_0_Link_19" href="http://www.cnblogs.com/yuxc/category/296486.html">杂货铺(14)</a> </li>

</ul>

</div>

<div class="catListPostArchive">
<h3 class="catListTitle">随笔档案<span style="font-size:11px;font-weight:normal">(215)</span></h3>

<ul>

<li><a id="ctl01_CatList_LinkList_1_Link_0" href="http://www.cnblogs.com/yuxc/archive/2013/06.html">2013年6月 (2)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_1" href="http://www.cnblogs.com/yuxc/archive/2013/04.html">2013年4月 (2)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_2" href="http://www.cnblogs.com/yuxc/archive/2013/03.html">2013年3月 (2)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_3" href="http://www.cnblogs.com/yuxc/archive/2013/02.html">2013年2月 (4)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_4" href="http://www.cnblogs.com/yuxc/archive/2012/12.html">2012年12月 (1)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_5" href="http://www.cnblogs.com/yuxc/archive/2012/11.html">2012年11月 (10)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_6" href="http://www.cnblogs.com/yuxc/archive/2012/10.html">2012年10月 (3)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_7" href="http://www.cnblogs.com/yuxc/archive/2012/09.html">2012年9月 (6)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_8" href="http://www.cnblogs.com/yuxc/archive/2012/08.html">2012年8月 (8)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_9" href="http://www.cnblogs.com/yuxc/archive/2012/07.html">2012年7月 (4)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_10" href="http://www.cnblogs.com/yuxc/archive/2012/06.html">2012年6月 (4)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_11" href="http://www.cnblogs.com/yuxc/archive/2012/05.html">2012年5月 (7)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_12" href="http://www.cnblogs.com/yuxc/archive/2012/03.html">2012年3月 (4)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_13" href="http://www.cnblogs.com/yuxc/archive/2012/02.html">2012年2月 (5)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_14" href="http://www.cnblogs.com/yuxc/archive/2012/01.html">2012年1月 (1)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_15" href="http://www.cnblogs.com/yuxc/archive/2011/12.html">2011年12月 (2)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_16" href="http://www.cnblogs.com/yuxc/archive/2011/11.html">2011年11月 (1)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_17" href="http://www.cnblogs.com/yuxc/archive/2011/10.html">2011年10月 (2)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_18" href="http://www.cnblogs.com/yuxc/archive/2011/09.html">2011年9月 (13)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_19" href="http://www.cnblogs.com/yuxc/archive/2011/08.html">2011年8月 (67)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_20" href="http://www.cnblogs.com/yuxc/archive/2011/07.html">2011年7月 (10)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_21" href="http://www.cnblogs.com/yuxc/archive/2011/06.html">2011年6月 (19)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_22" href="http://www.cnblogs.com/yuxc/archive/2011/05.html">2011年5月 (7)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_23" href="http://www.cnblogs.com/yuxc/archive/2011/04.html">2011年4月 (20)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_24" href="http://www.cnblogs.com/yuxc/archive/2011/03.html">2011年3月 (9)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_25" href="http://www.cnblogs.com/yuxc/archive/2009/07.html">2009年7月 (1)</a> </li>

<li><a id="ctl01_CatList_LinkList_1_Link_26" href="http://www.cnblogs.com/yuxc/archive/2008/10.html">2008年10月 (1)</a> </li>

</ul>

</div>


<div class="catListBlogRank">
<h3 class="catListTitle">积分与排名</h3>
<ul>
	<li class="liScore">
		积分 -	92647
	</li>
	<li class="liRank">
		排名 -	1267
	</li>
</ul>
</div>



<div class="catListComment">
<h3 class="catListTitle">最新评论</h3>
	<div id="RecentCommentsBlock"><ul>
    <li class="recent_comment_title"><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2726683">1. Re:深入云存储系统Swift存储节点：存储实现分析</a></li>
    <li class="recent_comment_body">作者有没有研究过riak，和swift类似的云存储，用erlang编写，apache lisence。有兴趣可以一起讨论。<br><a href="http://basho.com/riak/" target="_blank">http://basho.com/riak/</a></li>
    <li class="recent_comment_author">--IntoTheRain</li>
    <li class="recent_comment_title"><a href="http://www.cnblogs.com/yuxc/archive/2012/06/22/2558312.html#2720594">2. Re:深入云存储系统Swift核心组件：Ring实现原理剖析</a></li>
    <li class="recent_comment_body">你好，首先谢谢作者能写这么好的博文让我们学习，我有一点不太明白博文中有这样一段， “所以在设置虚结点数的时候，需要对系统预期的规模做充分考虑，假如集群的规模不会超过6000个结点，那么可以将虚结点数设置为结点数的100倍。这样，变动任意一个结点的负载仅影响1%的数据项。此时有6百万个vnode数，使用2bytes来存储结点数(0~65535)。基本的内存占用是6*106*2bytes=12Mb，”...</li>
    <li class="recent_comment_author">--SA高处不胜寒</li>
    <li class="recent_comment_title"><a href="http://www.cnblogs.com/yuxc/archive/2012/06/22/2558312.html#2696999">3. Re:深入云存储系统Swift核心组件：Ring实现原理剖析</a></li>
    <li class="recent_comment_body"><a href="http://www.cnblogs.com/yuxc/archive/2012/07/04/2575536.html#2696938" title="查看所回复的评论">@</a>IntoTheRain<br>我在致谢里添加了详细说明，以杜绝抄袭之嫌。<br>另外感谢指出我的错误，关于虚拟节点的说明，已经更正。</li>
    <li class="recent_comment_author">--牛皮糖NewPtone</li>
</ul>
</div>
</div>
</div>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright ©2013 牛皮糖NewPtone
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->
<script type="text/javascript" src="./深入云存储系统Swift存储节点：存储实现分析 - 牛皮糖NewPtone - 博客园_files/google-analytics.js"></script>


</body></html>