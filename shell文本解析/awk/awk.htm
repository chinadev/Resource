<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0038)http://linuxfire.com.cn/~lily/awk.html -->
<html><head><title>awk 手册</title>
<meta http-equiv="Content-Type" content="text/html; charset=GB2312">
<meta content="MSHTML 6.00.2900.3395" name="GENERATOR">
<style>@font-face {
	font-family: Helvetica;
}
@font-face {
	font-family: Wingdings;
}
@font-face {
	font-family: 宋体;
}
@font-face {
	font-family: 文鼎PL细上海宋Uni;
}
@font-face {
	font-family: StarSymbol;
}
@font-face {
	font-family: Times;
}
@font-face {
	font-family: Kochi Mincho;
}
@font-face {
	font-family: @宋体;
}
@page Section1 {size: 595.25pt 841.85pt; margin: 2.0cm 2.0cm 2.0cm 2.0cm; }
P.MsoNormal {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: "Times New Roman"
}
LI.MsoNormal {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: "Times New Roman"
}
DIV.MsoNormal {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: "Times New Roman"
}
H1 {
	FONT-SIZE: 16pt; MARGIN: 12pt 0cm 6pt 14.15pt; TEXT-INDENT: -14.15pt; FONT-FAMILY: Helvetica
}
H2 {
	FONT-SIZE: 14pt; MARGIN: 12pt 0cm 6pt 11.35pt; TEXT-INDENT: -11.35pt; FONT-FAMILY: Helvetica
}
H4 {
	FONT-SIZE: 12pt; MARGIN: 12pt 0cm 6pt; TEXT-INDENT: 0cm; FONT-STYLE: italic; FONT-FAMILY: Helvetica
}
P.MsoList {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 6pt; FONT-FAMILY: Times
}
LI.MsoList {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 6pt; FONT-FAMILY: Times
}
DIV.MsoList {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 6pt; FONT-FAMILY: Times
}
P.MsoBodyText {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 6pt; FONT-FAMILY: "Times New Roman"
}
LI.MsoBodyText {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 6pt; FONT-FAMILY: "Times New Roman"
}
DIV.MsoBodyText {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 6pt; FONT-FAMILY: "Times New Roman"
}
A:link {
	COLOR: navy; TEXT-DECORATION: underline
}
SPAN.MsoHyperlink {
	COLOR: navy; TEXT-DECORATION: underline
}
A:visited {
	COLOR: maroon; TEXT-DECORATION: underline
}
SPAN.MsoHyperlinkFollowed {
	COLOR: maroon; TEXT-DECORATION: underline
}
SPAN.a1 {
	FONT-FAMILY: StarSymbol
}
P.1 {
	FONT-SIZE: 14pt; MARGIN: 12pt 0cm 6pt; FONT-FAMILY: Helvetica
}
LI.1 {
	FONT-SIZE: 14pt; MARGIN: 12pt 0cm 6pt; FONT-FAMILY: Helvetica
}
DIV.1 {
	FONT-SIZE: 14pt; MARGIN: 12pt 0cm 6pt; FONT-FAMILY: Helvetica
}
P.a3 {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: "Times New Roman"
}
LI.a3 {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: "Times New Roman"
}
DIV.a3 {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: "Times New Roman"
}
P.a4 {
	FONT-WEIGHT: bold; FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: "Times New Roman"; TEXT-ALIGN: center
}
LI.a4 {
	FONT-WEIGHT: bold; FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: "Times New Roman"; TEXT-ALIGN: center
}
DIV.a4 {
	FONT-WEIGHT: bold; FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: "Times New Roman"; TEXT-ALIGN: center
}
P.a5 {
	FONT-SIZE: 12pt; MARGIN: 6pt 0cm; FONT-STYLE: italic; FONT-FAMILY: Times
}
LI.a5 {
	FONT-SIZE: 12pt; MARGIN: 6pt 0cm; FONT-STYLE: italic; FONT-FAMILY: Times
}
DIV.a5 {
	FONT-SIZE: 12pt; MARGIN: 6pt 0cm; FONT-STYLE: italic; FONT-FAMILY: Times
}
P.a6 {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: Times
}
LI.a6 {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: Times
}
DIV.a6 {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt; FONT-FAMILY: Times
}
P.a7 {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt 1cm; FONT-FAMILY: "Times New Roman"
}
LI.a7 {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt 1cm; FONT-FAMILY: "Times New Roman"
}
DIV.a7 {
	FONT-SIZE: 12pt; MARGIN: 0cm 0cm 0pt 1cm; FONT-FAMILY: "Times New Roman"
}
P.a8 {
	FONT-SIZE: 10.5pt; BACKGROUND: #e6e6e6; MARGIN: 0cm 1cm 0pt; LINE-HEIGHT: 14.15pt; FONT-FAMILY: "Kochi Mincho"
}
LI.a8 {
	FONT-SIZE: 10.5pt; BACKGROUND: #e6e6e6; MARGIN: 0cm 1cm 0pt; LINE-HEIGHT: 14.15pt; FONT-FAMILY: "Kochi Mincho"
}
DIV.a8 {
	FONT-SIZE: 10.5pt; BACKGROUND: #e6e6e6; MARGIN: 0cm 1cm 0pt; LINE-HEIGHT: 14.15pt; FONT-FAMILY: "Kochi Mincho"
}
DIV.Section1 {
	page: Section1
}
OL {
	MARGIN-BOTTOM: 0cm
}
UL {
	MARGIN-BOTTOM: 0cm
}
</style>
</head>
<body style="LINE-BREAK: strict" lang="ZH-CN" link="navy" vlink="maroon">
<div class="Section1">
<p class="MsoNormal" style="TEXT-ALIGN: center" align="center"><b><span style="FONT-SIZE: 24pt" lang="EN-US">awk </span></b><b><span style="FONT-SIZE: 24pt; FONT-FAMILY: 宋体">手册</span></b><b><span style="FONT-SIZE: 24pt" lang="EN-US"> </span></b></p>
<p class="MsoBodyText"><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US"></span>&nbsp;</p>
<p class="MsoBodyText"><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">简体中文版由</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">bones7456 (</span><span lang="EN-US"><a href="mailto:bones7456@gmail.com">bones7456@gmail.com</a></span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">)</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">整理</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">原文</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">:</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">应该是</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c"> </span><span lang="EN-US"><a href="http://phi.sinica.edu.tw/aspac/reports/94/94011/">http://phi.sinica.edu.tw/aspac/reports/94/94011/</a></span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US"> </span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">但是原文很乱</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">说明</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">:</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">之前也是对</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">awk</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">几乎一无所知</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">,</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">无意中看到这篇文章</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">,</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">网上一搜</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">,</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">居然没有像样的简体中文版</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">.</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">有的也是不怎么完整</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">,</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">或者错误一大堆的</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">.</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">于是就顺手整理了下这篇文章</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">.</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">通过整理这篇文章</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">,</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">自己也渐渐掌握了</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">awk</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">的种种用法</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">原文可能比较老</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">,</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">有些目前已经不适用的命令有所改动</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">,</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">文中所有命令均在</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">ubuntu7.04</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">下调试通过</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">,</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">用的</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">awk</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">是</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">mawk.</span></p>
<p class="MsoBodyText"><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">由于本人能力有限</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">,</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">错误和不妥之处在所难免</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">,</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c; FONT-FAMILY: 宋体">欢迎多多指正</span><span style="FONT-SIZE: 7.5pt; COLOR: #4c4c4c" lang="EN-US">.</span></p>
<h1><span lang="EN-US">1.<span style="FONT: 7pt 'Times New Roman'"> 
</span></span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">前言</span><span lang="EN-US"> 
</span></h1>
<p class="MsoNormal"><b><span style="FONT-FAMILY: 宋体">有关本手册</span> <span lang="EN-US">: </span></b></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">这是一本</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">学习指引</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">其重点着重于</span><span lang="EN-US"> : 
</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">适于解决哪些问题</span><span lang="EN-US"> ? </span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">常见的解题模式为何</span><span lang="EN-US"> ? </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">为使读者快速掌握</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">解题的模式及特性</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">本手册系由一些较具代表性的范例及其题解所构成</span><span lang="EN-US">; 
</span><span style="FONT-FAMILY: 宋体">各范例由浅入深</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">彼此间相互连贯</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">范例中并对所使用的</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">语法及指令辅以必要的说明</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">有关</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的指令</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">函数</span><span lang="EN-US">,...</span><span style="FONT-FAMILY: 宋体">等条列式的说明则收录于附录中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">以利读者往后撰写程序时查阅</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">如此编排</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">可让读者在短时间内顺畅地学会使用</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">来解决问题</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">建议读者循着范例上机实习</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">以加深学习效果</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span style="FONT-FAMILY: 宋体">读者宜先具备下列背景</span> <span lang="EN-US">: </span></b></p>
<p class="MsoNormal"><span lang="EN-US">[a.] UNIX </span><span style="FONT-FAMILY: 宋体">环境下的简单操作及基本概念</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span><span style="FONT-FAMILY: 宋体">文件编辑</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">文件复制</span> <span style="FONT-FAMILY: 宋体">及</span> <span style="FONT-FAMILY: 宋体">管道</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">输入</span><span lang="EN-US">/</span><span style="FONT-FAMILY: 宋体">输出重定向</span> <span style="FONT-FAMILY: 宋体">等概念</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">[b.] C </span><span style="FONT-FAMILY: 宋体">语言的基本语法及流程控制指令</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">(awk </span><span style="FONT-FAMILY: 宋体">指令并不多</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">且其中之大部分与</span><span lang="EN-US"> C</span><span style="FONT-FAMILY: 宋体">语言中之用法一致</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">本手册中对该类指令之语法及特性不再加以繁冗的说明</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">读者若欲深究</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">可自行翻阅相关的</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言书籍</span><span lang="EN-US">) </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h1><span lang="EN-US">2.<span style="FONT: 7pt 'Times New Roman'"> 
</span></span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">概述</span><span lang="EN-US"> </span></h1>
<p class="MsoNormal"><b><span style="FONT-FAMILY: 宋体">为什么使用</span><span lang="EN-US">awk </span></b></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">是一种程序语言</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">它具有一般程序语言常见的功能</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">因</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">语言具有某些特点</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US"> : 
</span><span style="FONT-FAMILY: 宋体">使用直译器</span><span lang="EN-US">(Interpreter)</span><span style="FONT-FAMILY: 宋体">不需先行编译</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">变量无类型之分</span><span lang="EN-US">(Typeless), </span><span style="FONT-FAMILY: 宋体">可使用文字当数组的下标</span><span lang="EN-US">(Associative 
Array)...</span><span style="FONT-FAMILY: 宋体">等特色</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">因此</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">使用</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">撰写程序比起使用其它语言更简洁便利且节省时间</span><span lang="EN-US">. 
awk</span><span style="FONT-FAMILY: 宋体">还具有一些内建功能</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">使得</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">擅于处理具数据行</span><span lang="EN-US">(Record), </span><span style="FONT-FAMILY: 宋体">字段</span><span lang="EN-US">(Field)</span><span style="FONT-FAMILY: 宋体">型态的资料</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">此外</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">内建有</span><span lang="EN-US">pipe</span><span style="FONT-FAMILY: 宋体">的功能</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">可将处理中的数据传送给外部的</span><span lang="EN-US"> Shell</span><span style="FONT-FAMILY: 宋体">命令加以处理</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">再将</span><span lang="EN-US">Shell</span><span style="FONT-FAMILY: 宋体">命令处理后的数据传回</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">这个特点也使得</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序很容易使用系统资源</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">由于</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">具有上述特色</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">在问题处理的过程中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">可轻易使用</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">来撰写一些小工具</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">这些小工具并非用来解决整个大问题</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">它们只扮演解决个别问题过程的某些角色</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">可藉由</span><span lang="EN-US">Shell</span><span style="FONT-FAMILY: 宋体">所提供的</span><span lang="EN-US">pipe</span><span style="FONT-FAMILY: 宋体">将数据按需要传送给不同的小工具进行处理</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">以解决整个大问题</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">这种解题方式</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">使得这些小工具可因不同需求而被重复组合及重用</span><span lang="EN-US">(reuse); </span><span style="FONT-FAMILY: 宋体">也可藉此方式来先行测试大程序原型的可行性与正确性</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">将来若需要较高的执行速度时再用</span><span lang="EN-US">C</span><span style="FONT-FAMILY: 宋体">语言来改写</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">这是</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">最常被应用之处</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">若能常常如此处理问题</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">读者可以以更高的角度来思考抽象的问题</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">而不会被拘泥于细节的部份</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">本手册为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">入门的学习指引</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">其内容将先强调如何撰写</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">未列入进一步解题方式的应用实例</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">这部分将留待</span><span lang="EN-US">UNIX</span><span style="FONT-FAMILY: 宋体">进阶手册中再行讨论</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span style="FONT-FAMILY: 宋体">如何取得</span><span lang="EN-US">awk </span></b></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">一般的</span><span lang="EN-US">UNIX</span><span style="FONT-FAMILY: 宋体">操作系统</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">本身即附有</span><span lang="EN-US">awk. </span><span style="FONT-FAMILY: 宋体">不同的</span><span lang="EN-US">UNIX</span><span style="FONT-FAMILY: 宋体">操作系统</span><span lang="EN-US"> 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">所附的</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">其版本亦不尽相同</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">若读者所使用的系统上未附有</span><span lang="EN-US">awk, </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">可透过</span><span lang="EN-US"> 
anonymous ftp </span><span style="FONT-FAMILY: 宋体">到下列地方取得</span><span lang="EN-US"> : </span></p>
<p class="MsoNormal"><span lang="EN-US">phi.sinica.edu.tw:/pub/gnu </span></p>
<p class="MsoNormal"><span lang="EN-US">ftp.edu.tw:/UNIX/gnu </span></p>
<p class="MsoNormal"><span lang="EN-US">prep.ai.mit.edu:/pub/gnu </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span lang="EN-US">awk</span></b><b><span style="FONT-FAMILY: 宋体">如何工作</span><span lang="EN-US"> </span></b></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">为便于解释</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序架构</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">及有关术语</span><span lang="EN-US">(terminology), 
</span><span style="FONT-FAMILY: 宋体">先以一个员工薪资档</span><span lang="EN-US">(emp.dat 
), </span><span style="FONT-FAMILY: 宋体">来加以介绍</span><span lang="EN-US">. 
</span></p>
<p class="a8"><span lang="EN-US">A125 Jenny 100 210 </span></p>
<p class="a8"><span lang="EN-US">A341 Dan 110 215 </span></p>
<p class="a8"><span lang="EN-US">P158 Max 130 209 </span></p>
<p class="a8"><span lang="EN-US">P148 John 125 220 </span></p>
<p class="a8"><span lang="EN-US">A123 Linda 95 210 </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">文件中各字段依次为</span> <span style="FONT-FAMILY: 宋体">员工</span><span lang="EN-US">ID, </span><span style="FONT-FAMILY: 宋体">姓名</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">薪资率</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">及</span> <span style="FONT-FAMILY: 宋体">实际工时</span><span lang="EN-US">. ID</span><span style="FONT-FAMILY: 宋体">中的第一码为部门识别码</span><span lang="EN-US">. "A","P"</span><span style="FONT-FAMILY: 宋体">分别表示</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">组装</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">及</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">包装</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">部门</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">本小节着重于说明</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序的主要架构及工作原理</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并对一些重要的名词辅以必要的解释</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">由这部分内容</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">读者可体会出</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">语言的主要精神及</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">与其它语程序言的差异处</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">为便于说明</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">以条列方式说明于后</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><b><span style="FONT-FAMILY: 宋体">名词定义</span></b><span lang="EN-US"> </span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><span style="FONT-FAMILY: 宋体">数据行</span><span lang="EN-US">: 
awk</span><span style="FONT-FAMILY: 宋体">从数据文件上读取数据的基本单位</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">以上列文件</span><span lang="EN-US">emp.dat</span><span style="FONT-FAMILY: 宋体">为例</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">读入的</span><span lang="EN-US"> 
</span></p>
<p class="MsoNormal" style="TEXT-INDENT: 37.5pt"><span style="FONT-FAMILY: 宋体">第一笔数据行是</span><span lang="EN-US"> "A125 Jenny 100 210" 
</span></p>
<p class="MsoNormal" style="TEXT-INDENT: 37.5pt"><span style="FONT-FAMILY: 宋体">第二笔数据行是</span><span lang="EN-US"> "A341 Dan 110 215" 
</span></p>
<p class="MsoNormal" style="TEXT-INDENT: 37.5pt"><span style="FONT-FAMILY: 宋体">一般而言</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">一个</span> <span style="FONT-FAMILY: 宋体">数据行</span> <span style="FONT-FAMILY: 宋体">就相当于数据文件上的一行资料</span><span lang="EN-US">. (</span><span style="FONT-FAMILY: 宋体">参考</span><span lang="EN-US"> : </span><span style="FONT-FAMILY: 宋体">附录</span><span lang="EN-US"> B </span><span style="FONT-FAMILY: 宋体">内建变量</span><span lang="EN-US">"RS" ) </span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><span style="FONT-FAMILY: 宋体">字段</span><span lang="EN-US">(Field) : 
</span><span style="FONT-FAMILY: 宋体">为数据行上被分隔开的子字符串</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal" style="TEXT-INDENT: 37.5pt"><span style="FONT-FAMILY: 宋体">以数据行</span><span lang="EN-US">"A125 Jenny 100 
210"</span><span style="FONT-FAMILY: 宋体">为例</span><span lang="EN-US">, </span></p>
<p class="MsoNormal" style="TEXT-INDENT: 37.5pt"><span style="FONT-FAMILY: 宋体">第一栏</span> <span style="FONT-FAMILY: 宋体">第二栏</span> 
<span style="FONT-FAMILY: 宋体">第三栏</span> <span style="FONT-FAMILY: 宋体">第四栏</span><span lang="EN-US"> "A125" "Jenny" 100 210 
</span></p>
<p class="MsoNormal" style="TEXT-INDENT: 37.5pt"><span style="FONT-FAMILY: 宋体">一般是以空格符来分隔相邻的字段</span><span lang="EN-US">. ( </span><span style="FONT-FAMILY: 宋体">参考</span><span lang="EN-US"> : </span><span style="FONT-FAMILY: 宋体">附录</span><span lang="EN-US"> D </span><span style="FONT-FAMILY: 宋体">内建变量</span><span lang="EN-US">"FS" ) </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h1><span lang="EN-US">3.<span style="FONT: 7pt 'Times New Roman'"> 
</span></span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">如何执行</span><span lang="EN-US">awk </span></h1>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">于</span><span lang="EN-US">UNIX</span><span style="FONT-FAMILY: 宋体">的命令行上键入诸如下列格式的指令</span><span lang="EN-US">: ( "$"</span><span style="FONT-FAMILY: 宋体">表</span><span lang="EN-US">Shell</span><span style="FONT-FAMILY: 宋体">命令行上的提示符号</span><span lang="EN-US">) </span></p>
<p class="a8"><span lang="EN-US">$awk 'awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US">' </span><span style="FONT-FAMILY: 宋体">数据文件文件名</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">会先编译该程序</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">然后执行该程序来处理所指定的数据文件</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">上列方式系直接把程序写在</span><span lang="EN-US">UNIX</span><span style="FONT-FAMILY: 宋体">的命令行上</span><span lang="EN-US">) </span></p>
<p class="MsoNormal"><b><span lang="EN-US">awk</span></b><b><span style="FONT-FAMILY: 宋体">程序的主要结构</span><span lang="EN-US">: </span></b></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中主要语法是</span><span lang="EN-US"> Pattern { Actions}, 
</span><span style="FONT-FAMILY: 宋体">故常见之</span><span lang="EN-US">awk 
</span><span style="FONT-FAMILY: 宋体">程序其型态如下</span><span lang="EN-US"> : 
</span></p>
<p class="MsoNormal"><span lang="EN-US">Pattern1 { Actions1 } </span></p>
<p class="MsoNormal"><span lang="EN-US">Pattern2 { Actions2 } </span></p>
<p class="MsoNormal"><span lang="EN-US">...... </span></p>
<p class="MsoNormal"><span lang="EN-US">Pattern3 { Actions3 } </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span lang="EN-US">Pattern </span></b><b><span style="FONT-FAMILY: 宋体">是什么</span> <span lang="EN-US">? </span></b></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">可接受许多不同型态的</span><span lang="EN-US"> Pattern. </span><span style="FONT-FAMILY: 宋体">一般常使用</span><span lang="EN-US"> "</span><span style="FONT-FAMILY: 宋体">关系表达式</span><span lang="EN-US">"(Relational expression) 
</span><span style="FONT-FAMILY: 宋体">来当成</span><span lang="EN-US"> Pattern. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
</span></p>
<p class="MsoNormal"><span lang="EN-US">x &gt; 34 </span><span style="FONT-FAMILY: 宋体">是一个</span><span lang="EN-US">Pattern, </span><span style="FONT-FAMILY: 宋体">判断变量</span><span lang="EN-US"> x </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> 34 </span><span style="FONT-FAMILY: 宋体">是否存在大于的关系</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">x == y </span><span style="FONT-FAMILY: 宋体">是一个</span><span lang="EN-US">Pattern, </span><span style="FONT-FAMILY: 宋体">判断变量</span><span lang="EN-US"> x </span><span style="FONT-FAMILY: 宋体">与变量</span><span lang="EN-US"> y </span><span style="FONT-FAMILY: 宋体">是否存在等于的关系</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">上式中</span><span lang="EN-US"> x 
&gt;34 , x == y </span><span style="FONT-FAMILY: 宋体">便是典型的</span><span lang="EN-US">Pattern. </span></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">提供</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言中常见的关系运算符</span><span lang="EN-US">(Relational 
Operators) </span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US"> 
</span></p>
<p class="MsoNormal"><span lang="EN-US">&gt;, &lt;, &gt;=, &lt;=, ==, !=</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">此外</span><span lang="EN-US">, awk 
</span><span style="FONT-FAMILY: 宋体">还提供</span><span lang="EN-US"> ~ (match) 
</span><span style="FONT-FAMILY: 宋体">及</span><span lang="EN-US"> !~(not match) 
</span><span style="FONT-FAMILY: 宋体">二个关系运算符</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">注一</span><span lang="EN-US">). 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">其用法与涵义如下</span><span lang="EN-US">: </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">若</span><span lang="EN-US"> A 
</span><span style="FONT-FAMILY: 宋体">为一字符串</span><span lang="EN-US">, B 
</span><span style="FONT-FAMILY: 宋体">为一正则表达式</span><span lang="EN-US">(Regular 
Expression)</span></p>
<p class="MsoNormal"><span lang="EN-US">A ~ B </span><span style="FONT-FAMILY: 宋体">判断</span> <span style="FONT-FAMILY: 宋体">字符串</span><span lang="EN-US">A </span><span style="FONT-FAMILY: 宋体">中是否</span> <span style="FONT-FAMILY: 宋体">包含</span> <span style="FONT-FAMILY: 宋体">能匹配</span><span lang="EN-US">(match)B</span><span style="FONT-FAMILY: 宋体">表达式的子字符串</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">A !~ B </span><span style="FONT-FAMILY: 宋体">判断</span> <span style="FONT-FAMILY: 宋体">字符串</span><span lang="EN-US">A </span><span style="FONT-FAMILY: 宋体">中是否</span> <span style="FONT-FAMILY: 宋体">不包含</span> <span style="FONT-FAMILY: 宋体">能匹配</span><span lang="EN-US">(match)B</span><span style="FONT-FAMILY: 宋体">表达式的子字符串</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span></p>
<p class="MsoNormal"><span lang="EN-US">"banana" ~ /an/ </span><span style="FONT-FAMILY: 宋体">整个是一个</span><span lang="EN-US">Pattern. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">因为</span><span lang="EN-US">"banana"</span><span style="FONT-FAMILY: 宋体">中含有可以匹配</span><span lang="EN-US"> /an/ </span><span style="FONT-FAMILY: 宋体">的子字符串</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">故此关系式成立</span><span lang="EN-US">(true),</span><span style="FONT-FAMILY: 宋体">整个</span><span lang="EN-US">Pattern</span><span style="FONT-FAMILY: 宋体">的值也是</span><span lang="EN-US">true. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">相关细节请参考</span> <span style="FONT-FAMILY: 宋体">附录</span><span lang="EN-US"> A Patterns, </span><span style="FONT-FAMILY: 宋体">附录</span><span lang="EN-US"> E Regular Expression 
</span></p>
<p class="MsoNormal"><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">注一</span><span lang="EN-US">:) </span><span style="FONT-FAMILY: 宋体">有少数</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">论著</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">把</span><span lang="EN-US"> ~, !~ </span><span style="FONT-FAMILY: 宋体">当成另一类的</span><span lang="EN-US"> Operator,</span><span style="FONT-FAMILY: 宋体">并不视为一种</span><span lang="EN-US"> Relational Operator. 
</span><span style="FONT-FAMILY: 宋体">本手册中将这两个运算符当成一种</span><span lang="EN-US"> 
Relational Operator. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span lang="EN-US">Actions </span></b><b><span style="FONT-FAMILY: 宋体">是什么</span><span lang="EN-US">? </span></b></p>
<p class="MsoNormal"><span lang="EN-US">Actions </span><span style="FONT-FAMILY: 宋体">是由许多</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">指令构成</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">而</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的指令与</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言中的指令十分类似</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US"> I/O</span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US"> : print, printf( ), 
getline...</span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的</span> <span style="FONT-FAMILY: 宋体">流程控制指令</span><span lang="EN-US"> : if(...){..} else{..}, 
while(...){...}... </span></p>
<p class="MsoNormal"><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">请参考</span> <span style="FONT-FAMILY: 宋体">附录</span><span lang="EN-US"> B --- "Actions" ) </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span lang="EN-US">awk </span></b><b><span style="FONT-FAMILY: 宋体">如何处理</span> <span lang="EN-US">Pattern { Actions } 
?</span></b><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">会先判断</span><span lang="EN-US">(Evaluate) </span><span style="FONT-FAMILY: 宋体">该</span><span lang="EN-US"> Pattern </span><span style="FONT-FAMILY: 宋体">的值</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若</span><span lang="EN-US"> Pattern </span><span style="FONT-FAMILY: 宋体">判断后的值为</span><span lang="EN-US">true (</span><span style="FONT-FAMILY: 宋体">或不为</span><span lang="EN-US">0</span><span style="FONT-FAMILY: 宋体">的数字</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">或不是空的字符串</span><span lang="EN-US">), </span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US"> awk</span><span style="FONT-FAMILY: 宋体">将执行该</span><span lang="EN-US"> Pattern </span><span style="FONT-FAMILY: 宋体">所对应的</span><span lang="EN-US"> Actions.</span><span style="FONT-FAMILY: 宋体">反之</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若</span><span lang="EN-US"> Pattern </span><span style="FONT-FAMILY: 宋体">之值不为</span><span lang="EN-US"> true, </span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">将不执行该</span><span lang="EN-US"> Pattern</span><span style="FONT-FAMILY: 宋体">所对应的</span><span lang="EN-US"> Actions. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span><span style="FONT-FAMILY: 宋体">若</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中有下列两指令</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">50 &gt; 23 {print "Hello! The word!!" } 
</span></p>
<p class="MsoNormal"><span lang="EN-US">"banana" ~ /123/ { print "Good morning !" } 
</span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">会先判断</span><span lang="EN-US"> 50 &gt;23 </span><span style="FONT-FAMILY: 宋体">是否成立</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">因为该式成立</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">所以</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">将印出</span><span lang="EN-US">"Hello! The word!!". 
</span><span style="FONT-FAMILY: 宋体">而另一</span><span lang="EN-US"> Pattern 
</span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> "banana" ~/123/, 
</span><span style="FONT-FAMILY: 宋体">因为</span><span lang="EN-US">"banana" 
</span><span style="FONT-FAMILY: 宋体">内未含有任何子字符串可</span><span lang="EN-US"> match 
/123/, </span><span style="FONT-FAMILY: 宋体">该</span><span lang="EN-US"> Pattern 
</span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US">false, 
</span><span style="FONT-FAMILY: 宋体">故</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">将不会印出</span><span lang="EN-US"> "Good morning !" 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span lang="EN-US">awk </span></b><b><span style="FONT-FAMILY: 宋体">如何处理</span><span lang="EN-US">{ Actions } 
</span></b><b><span style="FONT-FAMILY: 宋体">的语法</span><span lang="EN-US">?(</span></b><b><span style="FONT-FAMILY: 宋体">缺少</span><span lang="EN-US">Pattern</span></b><b><span style="FONT-FAMILY: 宋体">部分</span><span lang="EN-US">) </span></b></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">有时语法</span><span lang="EN-US"> 
Pattern { Actions }</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">, Pattern </span><span style="FONT-FAMILY: 宋体">部分被省略</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">只剩</span><span lang="EN-US"> 
{Actions}.</span><span style="FONT-FAMILY: 宋体">这种情形表示</span><span lang="EN-US"> 
"</span><span style="FONT-FAMILY: 宋体">无条件执行这个</span><span lang="EN-US"> Actions". 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span lang="EN-US">awk </span></b><b><span style="FONT-FAMILY: 宋体">的字段变量</span><span lang="EN-US"> </span></b></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">所内建的字段变量及其涵意如下</span><span lang="EN-US"> : </span></p>
<table class="MsoNormalTable" style="MARGIN-LEFT: 2.75pt; BORDER-COLLAPSE: collapse" border="0" cellpadding="0" cellspacing="0">
  <tbody>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: black 1pt solid; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 84.8pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="113">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">字段变量</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: black 1pt solid; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 397.05pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="529">
      <p class="a3"><span style="FONT-FAMILY: 宋体">含义</span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 84.8pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" width="113">
      <p class="MsoNormal"><span lang="EN-US">$0</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 397.05pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="529">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">一字符串</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">其内容为目前</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">所读入的数据行</span><span lang="EN-US">.</span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 84.8pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" width="113">
      <p class="MsoNormal"><span lang="EN-US">$1</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 397.05pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="529">
      <p class="MsoNormal"><span lang="EN-US">$0 </span><span style="FONT-FAMILY: 宋体">上第一个字段的数据</span><span lang="EN-US">.</span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 84.8pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" width="113">
      <p class="MsoNormal"><span lang="EN-US">$2</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 397.05pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="529">
      <p class="MsoNormal"><span lang="EN-US">$0 </span><span style="FONT-FAMILY: 宋体">上第二个字段的数据</span><span lang="EN-US">.</span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 84.8pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" width="113">
      <p class="MsoNormal"><span lang="EN-US">...</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 397.05pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="529">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">其余类推</span></p></td></tr></tbody></table>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span style="FONT-FAMILY: 宋体">读入数据行时</span><span lang="EN-US">, awk</span></b><b><span style="FONT-FAMILY: 宋体">如何更新</span><span lang="EN-US">(update)</span></b><b><span style="FONT-FAMILY: 宋体">这些内建的字段变量</span><span lang="EN-US">?</span></b><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> awk 
</span><span style="FONT-FAMILY: 宋体">从数据文件中读取一个数据行时</span><span lang="EN-US">, awk 
</span><span style="FONT-FAMILY: 宋体">会使用内建变量</span><span lang="EN-US">$0 
</span><span style="FONT-FAMILY: 宋体">予以记录</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">每当</span><span lang="EN-US"> $0 </span><span style="FONT-FAMILY: 宋体">被改动时</span><span lang="EN-US"> (</span><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : </span><span style="FONT-FAMILY: 宋体">读入新的数据行</span> <span style="FONT-FAMILY: 宋体">或</span> 
<span style="FONT-FAMILY: 宋体">自行变更</span><span lang="EN-US"> $0,...) awk 
</span><span style="FONT-FAMILY: 宋体">会立刻重新分析</span><span lang="EN-US"> $0 
</span><span style="FONT-FAMILY: 宋体">的字段情况</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并将</span><span lang="EN-US"> $0 </span><span style="FONT-FAMILY: 宋体">上各字段的数据用</span><span lang="EN-US"> $1, $2, ..</span><span style="FONT-FAMILY: 宋体">予以记录</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span lang="EN-US">awk</span></b><b><span style="FONT-FAMILY: 宋体">的内建变量</span><span lang="EN-US">(Built-in Variables) 
</span></b></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">提供了许多内建变量</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">使用者于程序中可使用这些变量来取得相关信息</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">常见的内建变量有</span><span lang="EN-US"> : </span></p>
<table class="MsoNormalTable" style="MARGIN-LEFT: 2.75pt; BORDER-COLLAPSE: collapse" border="0" cellpadding="0" cellspacing="0">
  <tbody>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: black 1pt solid; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 133.3pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="178">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">内建变量</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: black 1pt solid; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 348.55pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="465">
      <p class="a3"><span style="FONT-FAMILY: 宋体">含义</span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 133.3pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="178">
      <p class="MsoNormal"><span lang="EN-US">NF (Number of Fields)</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 348.55pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="465">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">为一整数</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">其值表</span><span lang="EN-US">$0</span><span style="FONT-FAMILY: 宋体">上所存在的字段数目</span><span lang="EN-US">.</span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 133.3pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="178">
      <p class="MsoNormal"><span lang="EN-US">NR (Number of Records)</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 348.55pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="465">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">为一整数</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">其值表</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">已读入的数据行数目</span><span lang="EN-US">.</span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 133.3pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="178">
      <p class="MsoNormal"><span lang="EN-US">FILENAMEawk</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 348.55pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="465">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">正在处理的数据文件文件名</span><span lang="EN-US">. </span></p></td></tr></tbody></table>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
awk </span><span style="FONT-FAMILY: 宋体">从资料文件</span><span lang="EN-US"> emp.dat 
</span><span style="FONT-FAMILY: 宋体">中读入第一笔数据行</span><span lang="EN-US"> 
</span></p>
<p class="MsoNormal"><span lang="EN-US">"A125 Jenny 100 210" </span><span style="FONT-FAMILY: 宋体">之后</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">程序中</span><span lang="EN-US">: </span></p>
<p class="MsoNormal"><span lang="EN-US">$0 </span><span style="FONT-FAMILY: 宋体">之值将是</span><span lang="EN-US"> "A125 Jenny 100 210" 
</span></p>
<p class="MsoNormal"><span lang="EN-US">$1 </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> "A125" </span></p>
<p class="MsoNormal"><span lang="EN-US">$2 </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> "Jenny" </span></p>
<p class="MsoNormal"><span lang="EN-US">$3 </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> 100 </span></p>
<p class="MsoNormal"><span lang="EN-US">$4 </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> 210 </span></p>
<p class="MsoNormal"><span lang="EN-US">$NF </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> 4 </span></p>
<p class="MsoNormal"><span lang="EN-US">$NR </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> 1 </span></p>
<p class="MsoNormal"><span lang="EN-US">$FILENAME </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> "emp.dat" </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span lang="EN-US">awk</span></b><b><span style="FONT-FAMILY: 宋体">的工作流程</span> <span lang="EN-US">: </span></b></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">它会反复进行下列四步骤</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<ol style="MARGIN-TOP: 0cm" type="1">
  <li class="MsoNormal"><span style="FONT-FAMILY: 宋体">自动从指定的数据文件中读取一个数据行</span><span lang="EN-US">. </span>
  </li><li class="MsoNormal"><span style="FONT-FAMILY: 宋体">自动更新</span><span lang="EN-US">(Update)</span><span style="FONT-FAMILY: 宋体">相关的内建变量之值</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US"> : 
  NF, NR, $0... </span>
  </li><li class="MsoNormal"><span style="FONT-FAMILY: 宋体">依次执行程序中</span> <span style="FONT-FAMILY: 宋体">所有</span> <span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US"> Pattern { Actions } </span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">. </span>
  </li><li class="MsoNormal"><span style="FONT-FAMILY: 宋体">当执行完程序中所有</span><span lang="EN-US"> Pattern { Actions } </span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若数据文件中还有未读取的数据</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">则反复执行步骤</span><span lang="EN-US">1</span><span style="FONT-FAMILY: 宋体">到步骤</span><span lang="EN-US">4. </span></li></ol>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">会自动重复进行上述</span><span lang="EN-US">4</span><span style="FONT-FAMILY: 宋体">个步骤</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">使用者不须于程序中编写这个循环</span><span lang="EN-US"> (Loop). 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span style="FONT-FAMILY: 宋体">打印文件中指定的字段数据并加以计算</span></b><span lang="EN-US"> 
</span></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">处理数据时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">它会自动从数据文件中一次读取一笔记录</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并会</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">将该数据切分成一个个的字段</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">程序中可使用</span><span lang="EN-US"> 
$1, $2,... </span><span style="FONT-FAMILY: 宋体">直接取得</span><span lang="EN-US"> 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">各个字段的内容</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">这个特色让使用者易于用</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">编写</span><span lang="EN-US"> 
reformatter </span><span style="FONT-FAMILY: 宋体">来改变量据格式</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> :] </span><span style="FONT-FAMILY: 宋体">以文件</span><span lang="EN-US"> emp.dat </span><span style="FONT-FAMILY: 宋体">为例</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">计算每人应发工资并打印报表</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">分析</span><span lang="EN-US"> :] awk </span><span style="FONT-FAMILY: 宋体">会自行一次读入一列数据</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">故程序中仅需告诉</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">如何处理所读入的数据行</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行如下命令</span><span lang="EN-US"> 
: ( $ </span><span style="FONT-FAMILY: 宋体">表</span><span lang="EN-US">UNIX</span><span style="FONT-FAMILY: 宋体">命令行上的提示符</span><span lang="EN-US"> ) </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US">$ awk '{ print $2, $3 * $4 }' emp.dat </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行结果如下</span><span lang="EN-US"> 
: </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">屏幕出现</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">Jenny 21000 </span></p>
<p class="a8"><span lang="EN-US">Dan 23650 </span></p>
<p class="a8"><span lang="EN-US">Max 27170 </span></p>
<p class="a8"><span lang="EN-US">John 27500 </span></p>
<p class="a8"><span lang="EN-US">Linda 19950 </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">说明</span><span lang="EN-US"> :] </span></p>
<p class="MsoNormal"><span lang="EN-US">UNIX</span><span style="FONT-FAMILY: 宋体">命令行上</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的语法为</span><span lang="EN-US">: </span></p>
<p class="a8"><span lang="EN-US">$awk 'awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US">' </span><span style="FONT-FAMILY: 宋体">欲处理的资料文件文件名</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">本范例中的</span> <span style="FONT-FAMILY: 宋体">程序部分</span> <span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> {print $2, $3 * $4}. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">把程序置于命令行时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">程序之前后须以</span><span lang="EN-US"> ' </span><span style="FONT-FAMILY: 宋体">括住</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">emp.dat </span><span style="FONT-FAMILY: 宋体">为指定给该程序处理的数据文件文件名</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">本程序中使用</span><span lang="EN-US"> 
: Pattern { Actions } </span><span style="FONT-FAMILY: 宋体">语法</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">Pattern </span><span style="FONT-FAMILY: 宋体">部分被省略</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">表无任何限制条件</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">故</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">读入每笔数据行后都将无条件执行这个</span><span lang="EN-US"> Actions. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">print</span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">所提供的输出指令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">会将数据输出到</span><span lang="EN-US">stdout(</span><span style="FONT-FAMILY: 宋体">屏幕</span><span lang="EN-US">). </span></p>
<p class="MsoNormal"><span lang="EN-US">print </span><span style="FONT-FAMILY: 宋体">的参数间彼此以</span><span lang="EN-US"> "," (</span><span style="FONT-FAMILY: 宋体">逗号</span><span lang="EN-US">) </span><span style="FONT-FAMILY: 宋体">隔开</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">印出数据时彼此间会以空白隔开</span><span lang="EN-US">. (</span><span style="FONT-FAMILY: 宋体">参考</span> <span style="FONT-FAMILY: 宋体">附录</span><span lang="EN-US"> D </span><span style="FONT-FAMILY: 宋体">内建变量</span><span lang="EN-US">OFS) </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">将上述的</span> <span style="FONT-FAMILY: 宋体">程序部分</span> <span style="FONT-FAMILY: 宋体">储存于文件</span><span lang="EN-US"> pay1.awk </span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">执行命令时再指定</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序文件</span> <span style="FONT-FAMILY: 宋体">之文件名</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">这是执行</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的另一种方式</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">特别适用于程序较大的情况</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">其语法如下</span><span lang="EN-US">: </span></p>
<p class="a8"><span lang="EN-US">$ awk -f awk</span><span style="FONT-FAMILY: 宋体">程序文件名</span> <span style="FONT-FAMILY: 宋体">数据文件文件名</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">故执行下列两命令</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">将产生同样的结果</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">$ awk -f pay1.awk emp.dat </span></p>
<p class="a8"><span lang="EN-US">$ awk '{ print $2, $3 * $4 }' emp.dat </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">读者可使用</span><span lang="EN-US"> 
"-f" </span><span style="FONT-FAMILY: 宋体">参数</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">让</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">主程序使用</span><span lang="EN-US">“</span><span style="FONT-FAMILY: 宋体">其它仅含</span><span lang="EN-US"> 
awk</span><span style="FONT-FAMILY: 宋体">函数</span> <span style="FONT-FAMILY: 宋体">的文件中的函数</span><span lang="EN-US"> ”</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">其语法如下</span><span lang="EN-US">: 
</span></p>
<p class="a8"><span lang="EN-US">$ awk -f awk</span><span style="FONT-FAMILY: 宋体">主程序文件名</span><span lang="EN-US"> -f awk</span><span style="FONT-FAMILY: 宋体">函数文件名</span> <span style="FONT-FAMILY: 宋体">数据文件文件名</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">有关</span> <span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">中函数的声明与使用于</span> <span lang="EN-US">7.4 </span><span style="FONT-FAMILY: 宋体">中说明</span><span lang="EN-US">) </span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中也提供与</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言中类似用法的</span><span lang="EN-US"> printf() </span><span style="FONT-FAMILY: 宋体">函数</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">使用该函数可进一步控制数据的输出格式</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">编辑另一个</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序如下</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">并取名为</span><span lang="EN-US"> pay2.awk 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US">{ printf("%6s Work hours: %3d Pay: %5d\n", $2,$3, 
$3* $4) } </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行下列命令</span><span lang="EN-US"> 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US">$awk -f pay2.awk emp.dat </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行结果屏幕出现</span><span lang="EN-US">: </span></p>
<p class="a8"><span lang="EN-US">&nbsp;Jenny Work hours: 100 Pay: 21000 </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp; Dan Work hours: 110 Pay: 23650 
</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp; Max Work hours: 130 Pay: 27170 
</span></p>
<p class="a8"><span lang="EN-US">&nbsp; John Work hours: 125 Pay: 27500 </span></p>
<p class="a8"><span lang="EN-US">&nbsp;Linda Work hours:&nbsp; 95 Pay: 19950 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h1><span lang="EN-US">4.<span style="FONT: 7pt 'Times New Roman'"> 
</span></span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">选择符合指定条件的记录</span><span lang="EN-US"> </span></h1>
<p class="MsoNormal"><span lang="EN-US">Pattern { Action }</span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中最主要的语法</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">若某</span><span lang="EN-US">Pattern</span><span style="FONT-FAMILY: 宋体">之值为真则执行它后方的</span><span lang="EN-US"> Action. 
awk</span><span style="FONT-FAMILY: 宋体">中常使用</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">关系表达式</span><span lang="EN-US">" 
(Relational Expression)</span><span style="FONT-FAMILY: 宋体">来当成</span><span lang="EN-US"> Pattern. </span></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">中除了</span><span lang="EN-US">&gt;, &lt;, ==, != 
,...</span><span style="FONT-FAMILY: 宋体">等关系运算符</span><span lang="EN-US">( 
Relational Operators )</span><span style="FONT-FAMILY: 宋体">外</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">另外提供</span><span lang="EN-US"> 
~(match),!~(Not Match) </span><span style="FONT-FAMILY: 宋体">二个关系运算符</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">利用这两个运算符</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">可判断某字符串是否包含能匹配所指定正则表达式的子字符串</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">由于这些特性</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">很容易使用</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">来编写需要字符串比对</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">判断的程序</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> :] </span><span style="FONT-FAMILY: 宋体">承上例</span><span lang="EN-US">, </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">组装部门员工调薪</span><span lang="EN-US">5%,(</span><span style="FONT-FAMILY: 宋体">组装部门员工之</span><span lang="EN-US">ID</span><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US">"A"</span><span style="FONT-FAMILY: 宋体">开头</span><span lang="EN-US">) 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">所有员工最后之薪资率若仍低于</span><span lang="EN-US">100, </span><span style="FONT-FAMILY: 宋体">则以</span><span lang="EN-US">100</span><span style="FONT-FAMILY: 宋体">计</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">编写</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序打印新的员工薪资率报表</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">[</span><span style="FONT-FAMILY: 宋体">分析</span><span lang="EN-US"> ] : </span><span style="FONT-FAMILY: 宋体">这个程序须先判断所读入的数据行是否合于指定条件</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">再进行某些动作</span><span lang="EN-US">.awk</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US"> 
Pattern { Actions } </span><span style="FONT-FAMILY: 宋体">的语法已涵盖这种</span><span lang="EN-US"> " if ( </span><span style="FONT-FAMILY: 宋体">条件</span><span lang="EN-US">) { </span><span style="FONT-FAMILY: 宋体">动作</span><span lang="EN-US">} 
"</span><span style="FONT-FAMILY: 宋体">的架构</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">编写如下之程序</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并取名</span><span lang="EN-US"> adjust1.awk </span></p>
<p class="a8"><span lang="EN-US">$1 ~ /^A.*/ { $3 *= 1.05 } $3&lt;100 { $3 = 100 } 
</span></p>
<p class="a8"><span lang="EN-US">{ printf("%s %8s %d\n", $1, $2, $3)} </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行下列命令</span><span lang="EN-US"> 
: </span></p>
<p class="a8"><span lang="EN-US">$awk -f adjust1.awk emp.dat </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">结果如下</span><span lang="EN-US"> : 
</span><span style="FONT-FAMILY: 宋体">屏幕出现</span><span lang="EN-US"> : </span></p>
<p class="a8"><span lang="EN-US">A125&nbsp;&nbsp;&nbsp; Jenny 105 </span></p>
<p class="a8"><span lang="EN-US">A341&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dan 115 
</span></p>
<p class="a8"><span lang="EN-US">P158&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Max 130 
</span></p>
<p class="a8"><span lang="EN-US">P148&nbsp;&nbsp;&nbsp;&nbsp; John 125 </span></p>
<p class="a8"><span lang="EN-US">A123&nbsp;&nbsp;&nbsp; Linda 100 </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US"> : </span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的工作程序是</span><span lang="EN-US">: </span><span style="FONT-FAMILY: 宋体">从数据文件中每次读入一个数据行</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">依序执行完程序中所有的</span><span lang="EN-US"> Pattern{ Action 
}</span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">:</span></p>
<p class="MsoNormal"><span lang="EN-US">$1~/^A.*/ { $3 *= 1.05 } </span></p>
<p class="MsoNormal"><span lang="EN-US">$3 &lt; 100 { $3 = 100 } </span></p>
<p class="MsoNormal"><span lang="EN-US">{printf("%s %8s %d\n",$1,$2,$3)} </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">再从数据文件中读进下一笔记录继续进行处理</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">第一个</span><span lang="EN-US"> 
Pattern { Action }</span><span style="FONT-FAMILY: 宋体">是</span><span lang="EN-US">: $1 ~ /^A.*/ { $3 *= 1.05 } </span></p>
<p class="MsoNormal"><span lang="EN-US">$1 ~ /^A.*/ </span><span style="FONT-FAMILY: 宋体">是一个</span><span lang="EN-US">Pattern, </span><span style="FONT-FAMILY: 宋体">用来判断该笔数据行的第一栏是否包含以</span><span lang="EN-US">"A"</span><span style="FONT-FAMILY: 宋体">开头的子字符串</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">其中</span><span lang="EN-US"> 
/^A.*/ </span><span style="FONT-FAMILY: 宋体">是一个</span><span lang="EN-US">Regular 
Expression, </span><span style="FONT-FAMILY: 宋体">用以表示任何以</span><span lang="EN-US">"A"</span><span style="FONT-FAMILY: 宋体">开头的字符串</span><span lang="EN-US">. (</span><span style="FONT-FAMILY: 宋体">有关</span><span lang="EN-US"> 
Regular Expression </span><span style="FONT-FAMILY: 宋体">之用法</span> <span style="FONT-FAMILY: 宋体">参考</span> <span style="FONT-FAMILY: 宋体">附录</span><span lang="EN-US"> E ). </span></p>
<p class="MsoNormal"><span lang="EN-US">Actions </span><span style="FONT-FAMILY: 宋体">部分为</span><span lang="EN-US"> $3 *= 1.05 </span></p>
<p class="MsoNormal"><span lang="EN-US">$3 *= 1.05 </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> $3 = $3 * 1.05 </span><span style="FONT-FAMILY: 宋体">意义相同</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">运算子</span><span lang="EN-US">"*=" </span><span style="FONT-FAMILY: 宋体">之用法则与</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言中一样</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">此后与</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言中用法相同的运算子或语法将不予赘述</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">第二个</span><span lang="EN-US"> 
Pattern { Actions } </span><span style="FONT-FAMILY: 宋体">是</span><span lang="EN-US">: $3 &lt;100 {$3 = 100 } </span><span style="FONT-FAMILY: 宋体">若第三栏的数据内容</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">表薪资率</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">小于</span><span lang="EN-US">100, </span><span style="FONT-FAMILY: 宋体">则调整为</span><span lang="EN-US">100. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">第三个</span><span lang="EN-US"> 
Pattern { Actions } </span><span style="FONT-FAMILY: 宋体">是</span><span lang="EN-US">: {printf("%s %8s %d\n",$1, $2, $3 )} </span><span style="FONT-FAMILY: 宋体">省略了</span><span lang="EN-US">Pattern(</span><span style="FONT-FAMILY: 宋体">无条件执行</span><span lang="EN-US">Actions), </span><span style="FONT-FAMILY: 宋体">故所有数据行调整后的数据都将被印出</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h1><span lang="EN-US">5.<span style="FONT: 7pt 'Times New Roman'"> 
</span></span><span lang="EN-US">awk </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">中数组</span><span lang="EN-US"> </span></h1>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中允许使用字符串当做数组的下标</span><span lang="EN-US">(index). 
</span><span style="FONT-FAMILY: 宋体">利用这个特色十分有助于资料统计工作</span><span lang="EN-US">.(</span><span style="FONT-FAMILY: 宋体">使用字符串当下标的数组称为</span><span lang="EN-US">Associative Array) </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">首先建立一个数据文件</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并取名为</span><span lang="EN-US"> 
reg.dat. </span><span style="FONT-FAMILY: 宋体">此为一学生注册的资料文件</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">第一栏为学生姓名</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">其后为该生所修课程</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">Mary O.S. Arch. Discrete </span></p>
<p class="a8"><span lang="EN-US">Steve D.S. Algorithm Arch. </span></p>
<p class="a8"><span lang="EN-US">Wang Discrete Graphics O.S. </span></p>
<p class="a8"><span lang="EN-US">Lisa Graphics A.I. </span></p>
<p class="a8"><span lang="EN-US">Lily Discrete Algorithm </span></p>
<p class="MsoNormal"><b><span lang="EN-US">awk</span></b><b><span style="FONT-FAMILY: 宋体">中数组的特性</span><span lang="EN-US"> </span></b></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">使用字符串当数组的下标</span><span lang="EN-US">(index). </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">使用数组前不须宣告数组名及其大小</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
</span><span style="FONT-FAMILY: 宋体">希望用数组来记录</span><span lang="EN-US"> reg.dat 
</span><span style="FONT-FAMILY: 宋体">中各门课程的修课人数</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">这情况</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">有二项信息必须储存</span><span lang="EN-US">: </span></p>
<p class="MsoNormal"><span lang="EN-US">(a) </span><span style="FONT-FAMILY: 宋体">课程名称</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US">: "O.S.","Arch.".. 
,</span><span style="FONT-FAMILY: 宋体">共有哪些课程事先并不明确</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">(b)</span><span style="FONT-FAMILY: 宋体">各课程的修课人数</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US">: </span><span style="FONT-FAMILY: 宋体">有几个人修</span><span lang="EN-US">"O.S." </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">在</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中只要用一个数组就可同时记录上列信息</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">其方法如下</span><span lang="EN-US">: </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">使用一个数组</span><span lang="EN-US"> 
Number[ ] : </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">以课程名称当</span><span lang="EN-US"> 
Number[ ] </span><span style="FONT-FAMILY: 宋体">的下标</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US"> 
Number[ ] </span><span style="FONT-FAMILY: 宋体">中不同下标所对映的元素代表修课人数</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">有</span><span lang="EN-US">2</span><span style="FONT-FAMILY: 宋体">个学生修</span><span lang="EN-US"> 
"O.S.", </span><span style="FONT-FAMILY: 宋体">则以</span><span lang="EN-US"> 
Number["O.S."] = 2 </span><span style="FONT-FAMILY: 宋体">表之</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">若修</span><span lang="EN-US">"O.S."</span><span style="FONT-FAMILY: 宋体">的人数增加一人</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US"> 
Number["O.S."] = Number["O.S."] + 1 </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> Number["O.S."]++ . </span></p>
<p class="MsoNormal"><b><span style="FONT-FAMILY: 宋体">如何取出数组中储存的信息</span><span lang="EN-US"> </span></b></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US"> C 
</span><span style="FONT-FAMILY: 宋体">语言为例</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">声明</span><span lang="EN-US"> int Arr[100]; </span><span style="FONT-FAMILY: 宋体">之后</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若想得知</span><span lang="EN-US"> Arr[ ]</span><span style="FONT-FAMILY: 宋体">中所储存的数据</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">只须用一个循环</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US"> : </span></p>
<p class="MsoNormal"><span lang="EN-US">for(i=0; i&lt;100; i++) printf("%d\n", 
Arr[i]); </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">即可</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">上式中</span><span lang="EN-US">: </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">数组</span><span lang="EN-US"> Arr[ 
] </span><span style="FONT-FAMILY: 宋体">的下标</span><span lang="EN-US"> : 0, 1, 
2,..., 99 </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">数组</span><span lang="EN-US"> Arr[ 
] </span><span style="FONT-FAMILY: 宋体">中各下标所对应的值</span><span lang="EN-US"> : 
Arr[0], Arr[1],...Arr[99] </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">但</span><span lang="EN-US"> awk 
</span><span style="FONT-FAMILY: 宋体">中使用数组并不须事先宣告</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">以刚才使用的</span><span lang="EN-US"> Number[ ] 
</span><span style="FONT-FAMILY: 宋体">而言</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">程序执行前</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并不知将来有哪些课程名称可能被当成</span><span lang="EN-US"> Number[ ] 
</span><span style="FONT-FAMILY: 宋体">的下标</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">提供了一个指令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">藉由该指令</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">会自动找寻数组中使用过的所有下标</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US"> Number[ ] </span><span style="FONT-FAMILY: 宋体">为例</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">将会找到</span><span lang="EN-US"> "O.S.", "Arch.",... 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">使用该指令时</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">须指定所要找寻的数组</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">及一个变量</span><span lang="EN-US">. 
awk</span><span style="FONT-FAMILY: 宋体">会使用该的变量来记录从数组中找到的每一个下标</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">for(course in Number){....} </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">指定用</span><span lang="EN-US"> 
course </span><span style="FONT-FAMILY: 宋体">来记录</span><span lang="EN-US"> awk 
</span><span style="FONT-FAMILY: 宋体">从</span><span lang="EN-US">Number[ ] 
</span><span style="FONT-FAMILY: 宋体">中所找到的下标</span><span lang="EN-US">. 
awk</span><span style="FONT-FAMILY: 宋体">每找到一个下标时</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">就用</span><span lang="EN-US">course</span><span style="FONT-FAMILY: 宋体">记录该下标之值且执行</span><span lang="EN-US">{....}</span><span style="FONT-FAMILY: 宋体">中之指令</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">藉由这个方式便可取出数组中储存的信息</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">详见下例</span><span lang="EN-US">) </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> : ] </span><span style="FONT-FAMILY: 宋体">统计各科修课人数</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">并印出结果</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">建立如下程序</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">并取名为</span><span lang="EN-US"> 
course.awk: </span></p>
<p class="a8"><span lang="EN-US">{ for( i=2; i &lt;= NF; i++) Number[$i]++ } 
</span></p>
<p class="a8"><span lang="EN-US">END{for(course in Number) printf("%10s %d\n", 
course, Number[course] )} </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行下列命令</span><span lang="EN-US"> 
: </span></p>
<p class="a8"><span lang="EN-US">$awk -f course.awk reg.dat </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行结果如下</span><span lang="EN-US"> 
: </span></p>
<p class="a8"><span lang="EN-US">&nbsp; Graphics 2 </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; O.S. 2 </span></p>
<p class="a8"><span lang="EN-US">&nbsp; Discrete 3 </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A.I. 1 </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D.S. 1 </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp; Arch. 2 </span></p>
<p class="a8"><span lang="EN-US">&nbsp;Algorithm 2 </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US"> : ] </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">这程序包含二个</span><span lang="EN-US">Pattern { Actions }</span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">{ for( i=2; i &lt;= NF; i++) Number[$i]++ } 
</span></p>
<p class="a8"><span lang="EN-US">END{for(course in Number) printf("%10s %d\n", 
course, Number[course] )} </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">第一个</span><span lang="EN-US">Pattern { Actions }</span><span style="FONT-FAMILY: 宋体">指令中省略了</span><span lang="EN-US">Pattern </span><span style="FONT-FAMILY: 宋体">部分</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">故随着</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">每笔数据行的读入其</span><span lang="EN-US">Actions</span><span style="FONT-FAMILY: 宋体">部分将逐次无条件被执行</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">读入第一笔资料</span><span lang="EN-US"> " Mary O.S. Arch. Discrete" </span><span style="FONT-FAMILY: 宋体">为例</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">因为该笔数据</span><span lang="EN-US"> NF = 4(</span><span style="FONT-FAMILY: 宋体">有</span><span lang="EN-US">4</span><span style="FONT-FAMILY: 宋体">个字段</span><span lang="EN-US">), </span><span style="FONT-FAMILY: 宋体">故该</span><span lang="EN-US"> Action </span><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US">for Loop</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">i = 2,3,4. </span></p>
<p class="MsoNormal"><span lang="EN-US">i $i </span><span style="FONT-FAMILY: 宋体">最初</span><span lang="EN-US"> Number[$i] Number[$i]++ 
</span><span style="FONT-FAMILY: 宋体">之后</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">i=2</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US"> $i="O.S." 
Number["O.S."]</span><span style="FONT-FAMILY: 宋体">的值从默认的</span><span lang="EN-US">0,</span><span style="FONT-FAMILY: 宋体">变成了</span><span lang="EN-US">1 
;</span></p>
<p class="MsoNormal"><span lang="EN-US">i=3</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US"> $i="Arch." 
Number["Arch."]</span><span style="FONT-FAMILY: 宋体">的值从默认的</span><span lang="EN-US">0,</span><span style="FONT-FAMILY: 宋体">变成了</span><span lang="EN-US">1 
;</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">同理</span><span lang="EN-US">,i=4</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US"> 
$i="Discrete" Number["Discrete"]</span><span style="FONT-FAMILY: 宋体">的值从默认的</span><span lang="EN-US">0,</span><span style="FONT-FAMILY: 宋体">变成了</span><span lang="EN-US">1 ;</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">第二个</span><span lang="EN-US"> 
Pattern { Actions }</span><span style="FONT-FAMILY: 宋体">指令中</span><span lang="EN-US">END </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">之保留字</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> Pattern 
</span><span style="FONT-FAMILY: 宋体">的一种</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">END </span><span style="FONT-FAMILY: 宋体">成立</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">其值为</span><span lang="EN-US">true)</span><span style="FONT-FAMILY: 宋体">的条件是</span><span lang="EN-US">: "awk</span><span style="FONT-FAMILY: 宋体">处理完所有数据</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">即将离开程序时</span><span lang="EN-US">. "</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">平常读入数据行时</span><span lang="EN-US">, END</span><span style="FONT-FAMILY: 宋体">并不成立</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">故其后的</span><span lang="EN-US">Actions </span><span style="FONT-FAMILY: 宋体">并不被执行</span><span lang="EN-US">; </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">唯有当</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">读完所有数据时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">该</span><span lang="EN-US">Actions</span><span style="FONT-FAMILY: 宋体">才会被执行</span><span lang="EN-US"> ( </span><span style="FONT-FAMILY: 宋体">注意</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">不管数据行有多少笔</span><span lang="EN-US">, 
END</span><span style="FONT-FAMILY: 宋体">仅在最后才成立</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">故该</span><span lang="EN-US">Actions</span><span style="FONT-FAMILY: 宋体">仅被执行一次</span><span lang="EN-US">.) </span></p>
<p class="MsoNormal"><span lang="EN-US">BEGIN </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> END </span><span style="FONT-FAMILY: 宋体">有点类似</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">是</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中另一个保留的</span><span lang="EN-US">Pattern. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">唯一不同的是</span><span lang="EN-US">: 
"</span><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US"> BEGIN 
</span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> Pattern 
</span><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US"> Actions 
</span><span style="FONT-FAMILY: 宋体">于程序一开始执行时</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">被执行一次</span><span lang="EN-US">." </span></p>
<p class="MsoNormal"><span lang="EN-US">NF </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的内建变量</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">用以表示</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">正处理的数据行中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">所包含的字段个数</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中若含有以</span><span lang="EN-US"> $ </span><span style="FONT-FAMILY: 宋体">开头的自定变量</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">都将以如下方式解释</span><span lang="EN-US"> : </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US"> i= 2 
</span><span style="FONT-FAMILY: 宋体">为例</span><span lang="EN-US">, $i = $2 
</span><span style="FONT-FAMILY: 宋体">表第二个字段数据</span><span lang="EN-US">. ( 
</span><span style="FONT-FAMILY: 宋体">实际上</span><span lang="EN-US">, $ </span><span style="FONT-FAMILY: 宋体">在</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">中为一运算符</span><span lang="EN-US">(Operator), </span><span style="FONT-FAMILY: 宋体">用以取得字段数据</span><span lang="EN-US">.) </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h1><span lang="EN-US">6.<span style="FONT: 7pt 'Times New Roman'"> 
</span></span><span lang="EN-US">awk </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">程序中使用</span><span lang="EN-US"> Shell 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">命令</span><span lang="EN-US"> 
</span></h1>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中允许呼叫</span><span lang="EN-US">Shell</span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">并提供管道解决</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">与系统间数据传递的问题</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">所以</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">很容易使用系统资源</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">读者可利用这个特点来编写某些适用的系统工具</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> : ] </span><span style="FONT-FAMILY: 宋体">写一个</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序来打印出线上人数</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">将下列程序建文件</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">命名为</span><span lang="EN-US"> 
count.awk </span></p>
<p class="a8"><span lang="EN-US">BEGIN { </span></p>
<p class="a8"><span lang="EN-US">while ( "who" | getline ) n++ </span></p>
<p class="a8"><span lang="EN-US">print n </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">并执行下列命令</span><span lang="EN-US"> 
: </span></p>
<p class="a8"><span lang="EN-US">awk -f count.awk </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行结果将会印出目前在线人数</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US"> : ]</span></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">程序并不一定要处理数据文件</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">以本例而言</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">仅输入程序文件</span><span lang="EN-US">count.awk, </span><span style="FONT-FAMILY: 宋体">未输入任何数据文件</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">BEGIN </span><span style="FONT-FAMILY: 宋体">和</span><span lang="EN-US"> END </span><span style="FONT-FAMILY: 宋体">同为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中的一种</span><span lang="EN-US"> Pattern. </span><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US"> BEGIN </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> Pattern</span><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US">Actions ,</span><span style="FONT-FAMILY: 宋体">只有在</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">开始执行程序</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">尚未开启任何输入文件前</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">被执行一次</span><span lang="EN-US">.(</span><span style="FONT-FAMILY: 宋体">注意</span><span lang="EN-US">: </span><span style="FONT-FAMILY: 宋体">只被执行一次</span><span lang="EN-US">) </span></p>
<p class="MsoNormal"><span lang="EN-US">"|" </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">中表示管道的符号</span><span lang="EN-US">. awk </span><span style="FONT-FAMILY: 宋体">把</span><span lang="EN-US"> | </span><span style="FONT-FAMILY: 宋体">之前的字符串</span><span lang="EN-US">"who"</span><span style="FONT-FAMILY: 宋体">当成</span><span lang="EN-US">Shell</span><span style="FONT-FAMILY: 宋体">上的命令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并将该命令送往</span><span lang="EN-US">Shell</span><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">执行的结果</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">原先应于屏幕印出者</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">则藉由</span><span lang="EN-US">pipe</span><span style="FONT-FAMILY: 宋体">送进</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">getline</span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">所提供的输入指令</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">其语法如下</span><span lang="EN-US"> : 
</span></p>
<table class="MsoNormalTable" style="MARGIN-LEFT: 6pt; BORDER-COLLAPSE: collapse" border="0" cellpadding="0" cellspacing="0">
  <tbody>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: black 1pt solid; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 113.35pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="151">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">语法</span></p></td>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: black 1pt solid; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 110pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="147">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">由何处读取数据</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: black 1pt solid; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 250pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="333">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">数据读入后置于</span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 113.35pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="151">
      <p class="MsoNormal"><span lang="EN-US">getline var &lt; file</span></p></td>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 110pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="147">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">所指定的</span><span lang="EN-US"> file</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 250pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="333">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">变量</span><span lang="EN-US"> var(var</span><span style="FONT-FAMILY: 宋体">省略时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">表示置于</span><span lang="EN-US">$0)</span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 113.35pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="151">
      <p class="MsoNormal"><span lang="EN-US">getline var</span></p></td>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 110pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="147">
      <p class="MsoNormal"><span lang="EN-US">pipe </span><span style="FONT-FAMILY: 宋体">变量</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 250pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="333">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">变量</span><span lang="EN-US"> var(var</span><span style="FONT-FAMILY: 宋体">省略时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">表示置于</span><span lang="EN-US">$0) </span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 113.35pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="151">
      <p class="MsoNormal"><span lang="EN-US">getline var</span></p></td>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 110pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="147">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">见</span> <span style="FONT-FAMILY: 宋体">注一</span><span lang="EN-US"> </span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 250pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="333">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">变量</span><span lang="EN-US"> var(var</span><span style="FONT-FAMILY: 宋体">省略时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">表示置于</span><span lang="EN-US">$0) </span></p></td></tr></tbody></table>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">注一</span><span lang="EN-US"> : 
</span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> Pattern 
</span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> BEGIN 
</span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> END </span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, getline </span><span style="FONT-FAMILY: 宋体">将由</span><span lang="EN-US"> stdin </span><span style="FONT-FAMILY: 宋体">读取数据</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">否则由</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">正处理的数据文件上读取数据</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">getline </span><span style="FONT-FAMILY: 宋体">一次读取一行数据</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若读取成功则</span><span lang="EN-US">return 1, </span><span style="FONT-FAMILY: 宋体">若读取失败则</span><span lang="EN-US">return -1, </span><span style="FONT-FAMILY: 宋体">若遇到文件结束</span><span lang="EN-US">(EOF), </span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US">return 0; </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">本程序使用</span><span lang="EN-US"> 
getline </span><span style="FONT-FAMILY: 宋体">所</span><span lang="EN-US"> return 
</span><span style="FONT-FAMILY: 宋体">的数据来做为</span><span lang="EN-US"> while 
</span><span style="FONT-FAMILY: 宋体">判断循环停止的条件</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">某些</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">版本较旧</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">并不容许使用者改变</span><span lang="EN-US"> $0 </span><span style="FONT-FAMILY: 宋体">之值</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">这种版的</span><span lang="EN-US"> awk 
</span><span style="FONT-FAMILY: 宋体">执行本程序时会产生</span><span lang="EN-US"> Error, 
</span><span style="FONT-FAMILY: 宋体">读者可于</span><span lang="EN-US"> getline 
</span><span style="FONT-FAMILY: 宋体">之后置上一个变量</span><span lang="EN-US"> 
(</span><span style="FONT-FAMILY: 宋体">如此</span><span lang="EN-US">, getline 
</span><span style="FONT-FAMILY: 宋体">读进来的数据便不会被置于</span><span lang="EN-US"> $0 ), 
</span><span style="FONT-FAMILY: 宋体">或直接改用</span><span lang="EN-US">gawk</span><span style="FONT-FAMILY: 宋体">便可解决</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h1><span lang="EN-US">7.<span style="FONT: 7pt 'Times New Roman'"> 
</span></span><span lang="EN-US">awk </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">程序的应用实例</span><span lang="EN-US"> </span></h1>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">本节将示范一个统计上班到达时间及迟到次数的程序</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">这程序每日被执行时将读入二个文件</span><span lang="EN-US">: </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">员工当日到班时间的数据文件</span><span lang="EN-US"> ( </span><span style="FONT-FAMILY: 宋体">如下列之</span><span lang="EN-US"> 
arr.dat ) </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">存放员工当月迟到累计次数的文件</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">当程序执行执完毕后将更新第二个文件的数据</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">迟到次数</span><span lang="EN-US">), 
</span><span style="FONT-FAMILY: 宋体">并打印当日的报表</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">这程序将分成下列数小节逐步完成</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">其大纲如下</span><span lang="EN-US">: 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><b><span lang="EN-US">[7.1] </span></b><b><span style="FONT-FAMILY: 宋体">在到班资料文件</span> <span lang="EN-US">arr.dat 
</span></b><b><span style="FONT-FAMILY: 宋体">之前增加一行抬头</span><span lang="EN-US"> 
</span></b></p>
<p class="MsoNormal"><span lang="EN-US">"ID Number Arrvial Time", </span><span style="FONT-FAMILY: 宋体">并产生报表输出到文件</span><span lang="EN-US">today_rpt1 
</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">.</span></p>
<p class="MsoNormal"><span lang="EN-US">&lt; </span><span style="FONT-FAMILY: 宋体">思考</span><span lang="EN-US">: </span><span style="FONT-FAMILY: 宋体">在</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中如何将数据输出到文件</span><span lang="EN-US"> &gt; </span></p>
<p class="MsoNormal"><b><span lang="EN-US">[7.2]</span></b><b><span style="FONT-FAMILY: 宋体">将</span> <span lang="EN-US">today_rpt1 </span></b><b><span style="FONT-FAMILY: 宋体">上的数据按员工代号排序</span><span lang="EN-US">, </span></b><b><span style="FONT-FAMILY: 宋体">并加注执行当日日期</span><span lang="EN-US">; </span></b><b><span style="FONT-FAMILY: 宋体">产生文件</span> <span lang="EN-US">today_rpt2 </span></b></p>
<p class="MsoNormal"><span lang="EN-US">&lt;</span><span style="FONT-FAMILY: 宋体">思考</span><span lang="EN-US"> awk</span><span style="FONT-FAMILY: 宋体">中如何运用系统资源及</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">Pipe</span><span style="FONT-FAMILY: 宋体">之特性</span><span lang="EN-US"> &gt; </span></p>
<p class="MsoNormal"><b><span lang="EN-US">[7.3] </span></b><b><span style="FONT-FAMILY: 宋体">将</span><span lang="EN-US">awk</span></b><b><span style="FONT-FAMILY: 宋体">程序包含在一个</span><span lang="EN-US">shell 
script</span></b><b><span style="FONT-FAMILY: 宋体">文件中</span></b></p>
<p class="MsoNormal"><b><span lang="EN-US">[7.4] </span></b><b><span style="FONT-FAMILY: 宋体">于</span> <span lang="EN-US">today_rpt2 </span></b><b><span style="FONT-FAMILY: 宋体">每日报表上</span><span lang="EN-US">, </span></b><b><span style="FONT-FAMILY: 宋体">迟到者之前加上</span><span lang="EN-US">"*", </span></b><b><span style="FONT-FAMILY: 宋体">并加注当日平均到班时间</span><span lang="EN-US">;</span></b></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">产生文件</span><span lang="EN-US"> 
today_rpt3 </span></p>
<p class="MsoNormal"><b><span lang="EN-US">[7.5] </span></b><b><span style="FONT-FAMILY: 宋体">从文件中读取当月迟到次数</span><span lang="EN-US">, 
</span></b><b><span style="FONT-FAMILY: 宋体">并根据当日出勤状况更新迟到累计数</span><span lang="EN-US">. </span></b></p>
<p class="MsoNormal"><span lang="EN-US">&lt;</span><span style="FONT-FAMILY: 宋体">思考</span> <span style="FONT-FAMILY: 宋体">使用者在</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中如何读取文件数据</span><span lang="EN-US"> &gt; </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">某公司其员工到勤时间档如下</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">取名为</span><span lang="EN-US"> 
arr.dat. </span><span style="FONT-FAMILY: 宋体">文件中第一栏为员工代号</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">第二栏为到达时间</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">本范例中</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">将使用该文件为数据文件</span><span lang="EN-US">. 
</span></p>
<p class="a8"><span lang="EN-US">1034 7:26 </span></p>
<p class="a8"><span lang="EN-US">1025 7:27 </span></p>
<p class="a8"><span lang="EN-US">1101 7:32 </span></p>
<p class="a8"><span lang="EN-US">1006 7:45 </span></p>
<p class="a8"><span lang="EN-US">1012 7:46 </span></p>
<p class="a8"><span lang="EN-US">1028 7:49 </span></p>
<p class="a8"><span lang="EN-US">1051 7:51 </span></p>
<p class="a8"><span lang="EN-US">1029 7:57 </span></p>
<p class="a8"><span lang="EN-US">1042 7:59 </span></p>
<p class="a8"><span lang="EN-US">1008 8:01 </span></p>
<p class="a8"><span lang="EN-US">1052 8:05 </span></p>
<p class="a8"><span lang="EN-US">1005 8:12 </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">重定向输出到文件</span><span lang="EN-US"> </span></h2>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中并未提供如</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言中之</span><span lang="EN-US">fopen() </span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">也未有</span><span lang="EN-US">fprintf() </span><span style="FONT-FAMILY: 宋体">文件输出这样的指令</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">但</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中任何输出函数之后皆可借助使用与</span><span lang="EN-US">UNIX 
</span><span style="FONT-FAMILY: 宋体">中类似的</span><span lang="EN-US"> I/O 
</span><span style="FONT-FAMILY: 宋体">重定向符</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">将输出的数据重定向到指定的文件</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">其符号仍为</span><span lang="EN-US"> &gt; (</span><span style="FONT-FAMILY: 宋体">输出到一个新产生的文件</span><span lang="EN-US">) </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> &gt;&gt; ( </span><span style="FONT-FAMILY: 宋体">添加输出的数据到文件末尾</span><span lang="EN-US"> ). </span></p>
<p class="MsoNormal"><span lang="EN-US">[</span><span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US"> :]</span><span style="FONT-FAMILY: 宋体">在到班数据文件</span><span lang="EN-US"> arr.dat </span><span style="FONT-FAMILY: 宋体">之前增加一行抬头如下</span><span lang="EN-US">: </span></p>
<p class="MsoNormal"><span lang="EN-US">"ID Number Arrival Time", </span><span style="FONT-FAMILY: 宋体">并产生报表输出到文件</span><span lang="EN-US"> 
today_rpt1</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US"> 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">建立如下文件并取名为</span><span lang="EN-US">reformat1.awk </span></p>
<p class="a8"><span lang="EN-US">BEGIN { print " ID Number Arrival Time" &gt; 
"today_rpt1" </span></p>
<p class="a8"><span lang="EN-US">print "===========================" &gt; 
"today_rpt1" </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">{ printf(" %s %s\n", $1,$2 ) &gt; "today_rpt1" } 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US">: 
</span></p>
<p class="a8"><span lang="EN-US">$awk -f reformat1.awk arr.dat </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行后将产生文件</span><span lang="EN-US"> today_rpt1, </span><span style="FONT-FAMILY: 宋体">其内容如下</span><span lang="EN-US"> : </span></p>
<p class="a8"><span lang="EN-US">ID Number Arrival Time </span></p>
<p class="a8"><span lang="EN-US">============================ </span></p>
<p class="a8"><span lang="EN-US">1034 7:26 </span></p>
<p class="a8"><span lang="EN-US">1025 7:27 </span></p>
<p class="a8"><span lang="EN-US">1101 7:32 </span></p>
<p class="a8"><span lang="EN-US">1006 7:45 </span></p>
<p class="a8"><span lang="EN-US">1012 7:46 </span></p>
<p class="a8"><span lang="EN-US">1028 7:49 </span></p>
<p class="a8"><span lang="EN-US">1051 7:51 </span></p>
<p class="a8"><span lang="EN-US">1029 7:57 </span></p>
<p class="a8"><span lang="EN-US">1042 7:59 </span></p>
<p class="a8"><span lang="EN-US">1008 8:01 </span></p>
<p class="a8"><span lang="EN-US">1052 8:05 </span></p>
<p class="a8"><span lang="EN-US">1005 8:12 </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US"> :&nbsp; ]</span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">文件名称</span><span lang="EN-US"> today_rpt1 </span><span style="FONT-FAMILY: 宋体">的前后须以</span><span lang="EN-US">" (</span><span style="FONT-FAMILY: 宋体">双引号</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">括住</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">表示</span><span lang="EN-US"> today_rpt1 </span><span style="FONT-FAMILY: 宋体">为一字符串常量</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">若未以</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">括住</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US"> today_rpt1 </span><span style="FONT-FAMILY: 宋体">将被</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">解释为一个变量名称</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">在</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中任何变量使用之前</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并不须事先声明</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">其初始值为空字符串</span><span lang="EN-US">(Null string) </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> 0.</span><span style="FONT-FAMILY: 宋体">因此程序中若未以</span><span lang="EN-US"> " </span><span style="FONT-FAMILY: 宋体">将</span><span lang="EN-US"> 
today_rpt1 </span><span style="FONT-FAMILY: 宋体">括住</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US"> today_rpt1 
</span><span style="FONT-FAMILY: 宋体">将是一变量</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">其值将是空字符串</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">这会在执行时造成错误</span><span lang="EN-US">(Unix </span><span style="FONT-FAMILY: 宋体">无法帮您开启一个以空字符串为文件名的文件</span><span lang="EN-US">). 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">因此在编辑</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序时</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">须格外留心</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">因为若敲错变量名称</span><span lang="EN-US">,awk</span><span style="FONT-FAMILY: 宋体">在编译程序时会认为是一新的变量</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并不会察觉</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">因此往往会造成运行时错误</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">BEGIN </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的保留字</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">是</span><span lang="EN-US"> Pattern </span><span style="FONT-FAMILY: 宋体">的一种</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US"> BEGIN 
</span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> Pattern 
</span><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US"> Actions 
</span><span style="FONT-FAMILY: 宋体">于</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序刚被执行尚未读取数据文件时被执行一次</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">此后便不再被执行</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">读者或许觉得本程序中的</span><span lang="EN-US">I/O</span><span style="FONT-FAMILY: 宋体">重定向符号应使用</span><span lang="EN-US"> " &gt;&gt;" (append)</span><span style="FONT-FAMILY: 宋体">而非</span><span lang="EN-US"> " &gt;". </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">本程序中若使用</span><span lang="EN-US"> 
"&gt;" </span><span style="FONT-FAMILY: 宋体">将数据重导到</span><span lang="EN-US"> 
today_rpt1, awk </span><span style="FONT-FAMILY: 宋体">第一次执行该指令时会产生一个新档</span><span lang="EN-US"> today_rpt1, 
</span><span style="FONT-FAMILY: 宋体">其后再执行该指令时则把数据追加到</span><span lang="EN-US">today_rpt1</span><span style="FONT-FAMILY: 宋体">文件末</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并非每执行一次就重开一个新文件</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">若采用</span><span lang="EN-US">"&gt;&gt;"</span><span style="FONT-FAMILY: 宋体">其差异仅在第一次执行该指令时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若已存在</span><span lang="EN-US">today_rpt1</span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">将直接把数据</span><span lang="EN-US">append</span><span style="FONT-FAMILY: 宋体">在原文件之末尾</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">这一点</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US">UNIX</span><span style="FONT-FAMILY: 宋体">中的用法不同</span><span lang="EN-US">. </span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">awk 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">中如何利用系统资源</span><span lang="EN-US"> 
</span></h2>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中很容易使用系统资源</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">这包括在程序中途调用</span><span lang="EN-US"> Shell </span><span style="FONT-FAMILY: 宋体">命令来处理程序中的部分数据</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">或在调用</span><span lang="EN-US"> Shell </span><span style="FONT-FAMILY: 宋体">命令后将其产生的结果交回</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">不需将结果暂存于某个文件</span><span lang="EN-US">). </span><span style="FONT-FAMILY: 宋体">这一过程是借助</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">所提供的管道</span><span lang="EN-US"> (</span><span style="FONT-FAMILY: 宋体">虽然有些类似</span><span lang="EN-US"> Unix </span><span style="FONT-FAMILY: 宋体">中的管道</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">但特性有些不同</span><span lang="EN-US">),</span><span style="FONT-FAMILY: 宋体">及一个从</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">中呼叫</span><span lang="EN-US"> Unix </span><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US"> Shell </span><span style="FONT-FAMILY: 宋体">命令的语法来达成的</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">[</span><span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US"> :] </span><span style="FONT-FAMILY: 宋体">承上题</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">将数据按员工</span><span lang="EN-US">ID</span><span style="FONT-FAMILY: 宋体">排序后再输出到文件</span><span lang="EN-US"> today_rpt2 , 
</span><span style="FONT-FAMILY: 宋体">并于表头附加执行时的日期</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">分</span> <span style="FONT-FAMILY: 宋体">析</span><span lang="EN-US"> : ]</span></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">提供与</span><span lang="EN-US"> UNIX </span><span style="FONT-FAMILY: 宋体">用法近似的</span><span lang="EN-US"> pipe, </span><span style="FONT-FAMILY: 宋体">其记号亦为</span><span lang="EN-US"> "|". </span><span style="FONT-FAMILY: 宋体">其用法及含意如下</span><span lang="EN-US"> : </span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中可接受下列两种语法</span><span lang="EN-US">: </span></p>
<p class="MsoNormal"><span lang="EN-US">[a. </span><span style="FONT-FAMILY: 宋体">语法</span><span lang="EN-US">] awk output </span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US"> | "Shell </span><span style="FONT-FAMILY: 宋体">接受的命令</span><span lang="EN-US">" </span></p>
<p class="MsoNormal"><span lang="EN-US">( </span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US"> : print $1,$2 | "sort -k 1" ) 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">[b. </span><span style="FONT-FAMILY: 宋体">语法</span><span lang="EN-US">] "Shell </span><span style="FONT-FAMILY: 宋体">接受的命令</span><span lang="EN-US">" | awk input </span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">( </span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US"> : "ls " | getline) </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">注</span><span lang="EN-US"> : awk 
input </span><span style="FONT-FAMILY: 宋体">指令只有</span><span lang="EN-US"> getline 
</span><span style="FONT-FAMILY: 宋体">一个</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">awk output </span><span style="FONT-FAMILY: 宋体">指令有</span><span lang="EN-US"> print, printf() </span><span style="FONT-FAMILY: 宋体">二个</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">在</span><span lang="EN-US">a 
</span><span style="FONT-FAMILY: 宋体">语法中</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">所输出的数据将转送往</span><span lang="EN-US"> Shell 
, </span><span style="FONT-FAMILY: 宋体">由</span><span lang="EN-US"> Shell 
</span><span style="FONT-FAMILY: 宋体">的命令进行处理</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">以上例而言</span><span lang="EN-US">, 
print </span><span style="FONT-FAMILY: 宋体">所输出的数据将经由</span><span lang="EN-US"> 
Shell </span><span style="FONT-FAMILY: 宋体">命令</span><span lang="EN-US"> "sort -k 
1" </span><span style="FONT-FAMILY: 宋体">排序后再送往屏幕</span><span lang="EN-US">(stdout). </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">上列</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中</span><span lang="EN-US">, 
"print$1, $2" </span><span style="FONT-FAMILY: 宋体">可能反复执行很多次</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">其输出的结果将先暂存于</span><span lang="EN-US"> pipe </span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">等到该程序结束时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">才会一并进行</span><span lang="EN-US"> 
"sort -k 1". </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">须注意二点</span><span lang="EN-US"> : 
</span><span style="FONT-FAMILY: 宋体">不论</span><span lang="EN-US"> print $1, $2 
</span><span style="FONT-FAMILY: 宋体">被执行几次</span><span lang="EN-US">, "sort -k 1" 
</span><span style="FONT-FAMILY: 宋体">的执行时间是</span><span lang="EN-US"> 
"awk</span><span style="FONT-FAMILY: 宋体">程序结束时</span><span lang="EN-US">", 
</span></p>
<p class="MsoNormal"><span lang="EN-US">"sort -k 1" </span><span style="FONT-FAMILY: 宋体">的执行次数是</span><span lang="EN-US"> "</span><span style="FONT-FAMILY: 宋体">一次</span><span lang="EN-US">". </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">在</span><span lang="EN-US"> b 
</span><span style="FONT-FAMILY: 宋体">语法中</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">将先调用</span><span lang="EN-US"> Shell 
</span><span style="FONT-FAMILY: 宋体">命令</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">其执行结果将通过</span><span lang="EN-US"> pipe </span><span style="FONT-FAMILY: 宋体">送入</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">以上例而言</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">先让</span><span lang="EN-US"> Shell </span><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US"> "ls",Shell </span><span style="FONT-FAMILY: 宋体">执行后将结果存于</span><span lang="EN-US"> pipe, awk</span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US"> getline</span><span style="FONT-FAMILY: 宋体">再从</span><span lang="EN-US"> pipe </span><span style="FONT-FAMILY: 宋体">中读取数据</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">使用本语法时应留心</span><span lang="EN-US">: </span><span style="FONT-FAMILY: 宋体">以上例而言</span><span lang="EN-US">,awk "</span><span style="FONT-FAMILY: 宋体">立刻</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">调用</span><span lang="EN-US"> 
Shell </span><span style="FONT-FAMILY: 宋体">来执行</span><span lang="EN-US"> "ls", 
</span><span style="FONT-FAMILY: 宋体">执行次数是一次</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">getline </span><span style="FONT-FAMILY: 宋体">则可能执行多次</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">若</span><span lang="EN-US">pipe</span><span style="FONT-FAMILY: 宋体">中存在多行数据</span><span lang="EN-US">). </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">除上列</span><span lang="EN-US"> a, 
b </span><span style="FONT-FAMILY: 宋体">二中语法外</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">程序中其它地方如出现像</span><span lang="EN-US"> 
"date", "cls", "ls"... </span><span style="FONT-FAMILY: 宋体">这样的字符串</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">只把它当成一般字符串处理</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">建立如下文件并取名为</span><span lang="EN-US"> reformat2.awk </span></p>
<p class="a8"><span lang="EN-US"># </span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US"> reformat2.awk </span></p>
<p class="a8"><span lang="EN-US"># </span><span style="FONT-FAMILY: 宋体">这程序用以练习</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中的</span><span lang="EN-US">pipe </span></p>
<p class="a8"><span lang="EN-US">BEGIN { </span></p>
<p class="a8"><span lang="EN-US">"date" | getline # Shell </span><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US"> "date". getline </span><span style="FONT-FAMILY: 宋体">取得结果并以</span><span lang="EN-US">$0</span><span style="FONT-FAMILY: 宋体">记录</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">print " Today is " , $2, $3 &gt;"today_rpt2" 
</span></p>
<p class="a8"><span lang="EN-US">print "=========================" &gt; "today_rpt2" 
</span></p>
<p class="a8"><span lang="EN-US">print " ID Number Arrival Time" &gt;"today_rpt2" 
</span></p>
<p class="a8"><span lang="EN-US">close( "today_rpt2" ) </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">{printf( "%s %s\n", $1 ,$2 ) | "sort -k 1 
&gt;&gt;today_rpt2"} </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行如下命令</span><span lang="EN-US">: 
</span></p>
<p class="MsoNormal"><span lang="EN-US">awk -f reformat2.awk arr.dat </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行后</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">系统会自动将</span><span lang="EN-US"> sort 
</span><span style="FONT-FAMILY: 宋体">后的数据追加</span><span lang="EN-US">( Append; 
</span><span style="FONT-FAMILY: 宋体">因为使用</span><span lang="EN-US"> " &gt;&gt;") 
</span><span style="FONT-FAMILY: 宋体">到文件</span><span lang="EN-US"> 
today_rpt2</span><span style="FONT-FAMILY: 宋体">末端</span><span lang="EN-US">. 
today_rpt2 </span><span style="FONT-FAMILY: 宋体">内容如下</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">&nbsp;Today is&nbsp; 09<span style="FONT-FAMILY: 宋体">月</span> 21</span><span style="FONT-FAMILY: 宋体">日</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">========================= </span></p>
<p class="a8"><span lang="EN-US">&nbsp;ID Number Arrival Time </span></p>
<p class="a8"><span lang="EN-US">1005 8:12 </span></p>
<p class="a8"><span lang="EN-US">1006 7:45 </span></p>
<p class="a8"><span lang="EN-US">1008 8:01 </span></p>
<p class="a8"><span lang="EN-US">1012 7:46 </span></p>
<p class="a8"><span lang="EN-US">1025 7:27 </span></p>
<p class="a8"><span lang="EN-US">1028 7:49 </span></p>
<p class="a8"><span lang="EN-US">1029 7:57 </span></p>
<p class="a8"><span lang="EN-US">1034 7:26 </span></p>
<p class="a8"><span lang="EN-US">1042 7:59 </span></p>
<p class="a8"><span lang="EN-US">1051 7:51 </span></p>
<p class="a8"><span lang="EN-US">1052 8:05 </span></p>
<p class="a8"><span lang="EN-US">1101 7:32 </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US"> : ]</span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序由三个主要部分构成</span><span lang="EN-US"> : </span></p>
<p class="MsoNormal"><span lang="EN-US">[ i.] Pattern { Action} </span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">[ ii.] </span><span style="FONT-FAMILY: 宋体">函数主体</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : function double( x ){ 
return 2*x } (</span><span style="FONT-FAMILY: 宋体">参考第</span><span lang="EN-US">11</span><span style="FONT-FAMILY: 宋体">节</span><span lang="EN-US"> 
Recursive Program ) </span></p>
<p class="MsoNormal"><span lang="EN-US">[ iii.] Comment ( </span><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US"> # </span><span style="FONT-FAMILY: 宋体">开头识别之</span><span lang="EN-US"> ) </span></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">的输入指令</span><span lang="EN-US"> getline, </span><span style="FONT-FAMILY: 宋体">每次读取一列数据</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">若</span><span lang="EN-US">getline</span><span style="FONT-FAMILY: 宋体">之后</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">未接任何变量</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">则所读入之资料将以</span><span lang="EN-US">$0 
</span><span style="FONT-FAMILY: 宋体">记录</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">否则以所指定的变量储存之</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">以本例而言</span><span lang="EN-US">] : </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US"> 
"date" | getline </span><span style="FONT-FAMILY: 宋体">后</span><span lang="EN-US">, 
$0 </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> "2007<span style="FONT-FAMILY: 宋体">年</span> 09<span style="FONT-FAMILY: 宋体">月</span> 
21</span><span style="FONT-FAMILY: 宋体">日</span> <span style="FONT-FAMILY: 宋体">星期五</span><span lang="EN-US"> 14:28:02 CST",</span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> $0 </span><span style="FONT-FAMILY: 宋体">之值被更新时</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">将自动更新相关的内建变量</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US">: $1,$2,..,NF.</span><span style="FONT-FAMILY: 宋体">故</span><span lang="EN-US"> $2 </span><span style="FONT-FAMILY: 宋体">之值将为</span><span lang="EN-US">"09</span><span style="FONT-FAMILY: 宋体">月</span><span lang="EN-US">", $3</span><span style="FONT-FAMILY: 宋体">之值将为</span><span lang="EN-US">"21</span><span style="FONT-FAMILY: 宋体">日</span><span lang="EN-US">". </span></p>
<p class="MsoNormal"><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">有少数旧版的</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">不允许即使用者自行更新</span><span lang="EN-US">(update)$0</span><span style="FONT-FAMILY: 宋体">的值</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">或者更新</span><span lang="EN-US">$0</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">它不会自动更新</span><span lang="EN-US"> 
$1,$2,..NF. </span><span style="FONT-FAMILY: 宋体">这情况下</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">可改用</span><span lang="EN-US">gawk</span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US">nawk. </span><span style="FONT-FAMILY: 宋体">否则使用者也可自行以</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">字符串函数</span><span lang="EN-US">split()</span><span style="FONT-FAMILY: 宋体">来分隔</span><span lang="EN-US">$0</span><span style="FONT-FAMILY: 宋体">上的数据</span><span lang="EN-US">) </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">本程序中</span><span lang="EN-US"> 
printf() </span><span style="FONT-FAMILY: 宋体">指令会被执行</span><span lang="EN-US">12</span><span style="FONT-FAMILY: 宋体">次</span><span lang="EN-US">( 
</span><span style="FONT-FAMILY: 宋体">因为有</span><span lang="EN-US">arr.dat</span><span style="FONT-FAMILY: 宋体">中有</span><span lang="EN-US">12</span><span style="FONT-FAMILY: 宋体">行数据</span><span lang="EN-US">), 
</span><span style="FONT-FAMILY: 宋体">但读者不用担心数据被重复</span><span lang="EN-US">sort</span><span style="FONT-FAMILY: 宋体">了</span><span lang="EN-US">12</span><span style="FONT-FAMILY: 宋体">次</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">结束该程序时才会</span><span lang="EN-US"> close </span><span style="FONT-FAMILY: 宋体">这个</span><span lang="EN-US"> pipe , </span><span style="FONT-FAMILY: 宋体">此时才将这</span><span lang="EN-US">12</span><span style="FONT-FAMILY: 宋体">行数据一次送往系统</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">并呼叫</span><span lang="EN-US"> "sort -k 1 &gt;&gt; 
today_rpt2" </span><span style="FONT-FAMILY: 宋体">处理之</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">提供另一个调用</span><span lang="EN-US">Shell</span><span style="FONT-FAMILY: 宋体">命令的方法</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">即使用</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">函数</span><span lang="EN-US">system("shell</span><span style="FONT-FAMILY: 宋体">命令</span><span lang="EN-US">") </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
</span></p>
<p class="a8"><span lang="EN-US">$ awk ' </span></p>
<p class="a8"><span lang="EN-US">BEGIN{ </span></p>
<p class="a8"><span lang="EN-US">system("date &gt; date.dat") </span></p>
<p class="a8"><span lang="EN-US">getline &lt; "date.dat"</span></p>
<p class="a8"><span lang="EN-US">print "Today is ", $2, $3 </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">' </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">但使用</span><span lang="EN-US"> 
system( "shell </span><span style="FONT-FAMILY: 宋体">命令</span><span lang="EN-US">" 
) </span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">无法直接将执行中的部分数据输出给</span><span lang="EN-US">Shell </span><span style="FONT-FAMILY: 宋体">命令</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">且</span><span lang="EN-US"> 
Shell </span><span style="FONT-FAMILY: 宋体">命令执行的结果也无法直接输入到</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">执行</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">程序的几种方式</span><span lang="EN-US"> </span></h2>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">本小节中描述如何将</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序直接写在</span><span lang="EN-US"> shell script </span><span style="FONT-FAMILY: 宋体">之中</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">此后使用者执行</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">程序时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">就不需要每次都键入</span><span lang="EN-US"> " awk -f program datafile" .</span></p>
<p class="MsoNormal"><span lang="EN-US">script </span><span style="FONT-FAMILY: 宋体">中还可包含其它</span><span lang="EN-US"> Shell </span><span style="FONT-FAMILY: 宋体">命令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">如此更可增加执行过程的自动化</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">建立一个简单的</span><span lang="EN-US"> 
awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US"> mydump.awk, 
</span><span style="FONT-FAMILY: 宋体">如下</span><span lang="EN-US">: </span></p>
<p class="a8"><span lang="EN-US">{print} </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">这个程序执行时会把数据文件的内容</span><span lang="EN-US"> print </span><span style="FONT-FAMILY: 宋体">到屏幕上</span><span lang="EN-US">( </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US">cat</span><span style="FONT-FAMILY: 宋体">功用类似</span><span lang="EN-US"> 
). </span></p>
<p class="MsoNormal"><span lang="EN-US">print </span><span style="FONT-FAMILY: 宋体">之后未接任何参数时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">表示</span><span lang="EN-US"> "print $0". </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">若欲执行该</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">来印出文件</span><span lang="EN-US"> today_rpt1 
</span><span style="FONT-FAMILY: 宋体">及</span><span lang="EN-US"> today_rpt2 
</span><span style="FONT-FAMILY: 宋体">的内容时</span><span lang="EN-US">, </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">必须于</span><span lang="EN-US"> 
UNIX </span><span style="FONT-FAMILY: 宋体">的命令行上执行下列命令</span><span lang="EN-US"> : 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">方式一</span><span lang="EN-US"> awk 
-f mydump.awk today_rpt1 today_rpt2 </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">方式二</span><span lang="EN-US"> awk 
'{print}' today_rpt1 today_rpt2</span><span style="FONT-FAMILY: 宋体">第二种方式系将</span><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">程序直接写在</span><span lang="EN-US"> Shell </span><span style="FONT-FAMILY: 宋体">的命令行上</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">这种方式仅适合较短的</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">方式三</span> <span style="FONT-FAMILY: 宋体">建立如下之</span><span lang="EN-US"> shell script, </span><span style="FONT-FAMILY: 宋体">并取名为</span><span lang="EN-US"> mydisplay, </span></p>
<p class="a8"><span lang="EN-US">#!/bin/sh </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US"># </span><span style="FONT-FAMILY: 宋体">注意以下的</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> ' </span><span style="FONT-FAMILY: 宋体">之间须有空白隔开</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">awk ' </span></p>
<p class="a8"><span lang="EN-US">{print} </span></p>
<p class="a8"><span lang="EN-US">' $* </span></p>
<p class="a8"><span lang="EN-US"># </span><span style="FONT-FAMILY: 宋体">注意以上的</span><span lang="EN-US"> ' </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> $* </span><span style="FONT-FAMILY: 宋体">之间须有空白隔开</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US"> 
mydisplay </span><span style="FONT-FAMILY: 宋体">之前</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">须先将它改成可执行的文件</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">此步骤往后不再赘述</span><span lang="EN-US">). </span><span style="FONT-FAMILY: 宋体">请执行如下命令</span><span lang="EN-US">: </span></p>
<p class="a8"><span lang="EN-US">$ chmod +x mydisplay </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">往后使用者就可直接把</span><span lang="EN-US"> mydisplay </span><span style="FONT-FAMILY: 宋体">当成指令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">来</span><span lang="EN-US">display</span><span style="FONT-FAMILY: 宋体">任何文件</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">$ ./mydisplay today_rpt1 today_rpt2 </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US"> : ]</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">在</span><span lang="EN-US">script</span><span style="FONT-FAMILY: 宋体">文件</span><span lang="EN-US"> 
mydisplay </span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">"awk"</span><span style="FONT-FAMILY: 宋体">与第一个</span><span lang="EN-US"> '&nbsp; </span><span style="FONT-FAMILY: 宋体">之间须有空格</span><span lang="EN-US">(Shell</span><span style="FONT-FAMILY: 宋体">中并无</span><span lang="EN-US">" awk' "</span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">). </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">第一个</span><span lang="EN-US"> ' 
</span><span style="FONT-FAMILY: 宋体">用以通知</span><span lang="EN-US"> Shell 
</span><span style="FONT-FAMILY: 宋体">其后为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">第二个</span><span lang="EN-US"> ' 
</span><span style="FONT-FAMILY: 宋体">则表示</span><span lang="EN-US"> awk 
</span><span style="FONT-FAMILY: 宋体">程序结束</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">故</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中一律以</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">括住字符串或字符</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">而不使用</span><span lang="EN-US"> ' 
, </span><span style="FONT-FAMILY: 宋体">以免</span><span lang="EN-US">Shell</span><span style="FONT-FAMILY: 宋体">混淆</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">$* </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> shell script</span><span style="FONT-FAMILY: 宋体">中的用法</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">它可用来代表命令行上</span><span lang="EN-US"> 
"mydisplay</span><span style="FONT-FAMILY: 宋体">之后的所有参数</span><span lang="EN-US">". 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如执行</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">$ mydisplay today_rpt1 today_rpt2 </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">事实上</span><span lang="EN-US"> 
Shell </span><span style="FONT-FAMILY: 宋体">已先把该指令转换成</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">awk ' </span></p>
<p class="a8"><span lang="EN-US">{ print} </span></p>
<p class="a8"><span lang="EN-US">' today_rpt1 today_rpt2 </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">本例中</span><span lang="EN-US">, $* 
</span><span style="FONT-FAMILY: 宋体">用以代表</span><span lang="EN-US"> "today_rpt1 
today_rpt2". </span><span style="FONT-FAMILY: 宋体">在</span><span lang="EN-US">Shell</span><span style="FONT-FAMILY: 宋体">的语法中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">可用</span><span lang="EN-US"> $1 
</span><span style="FONT-FAMILY: 宋体">代表第一个参数</span><span lang="EN-US">, $2 
</span><span style="FONT-FAMILY: 宋体">代表第二个参数</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">当不确定命令行上的参数个数时</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">可使用</span><span lang="EN-US"> $* </span><span style="FONT-FAMILY: 宋体">表之</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">命令行上可同时指定多个数据文件</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US">awk -f 
dump.awk today_rpt1 today_rpt2hf </span><span style="FONT-FAMILY: 宋体">为例</span><span lang="EN-US">,awk</span><span style="FONT-FAMILY: 宋体">会先处理</span><span lang="EN-US">today_rpt1, </span><span style="FONT-FAMILY: 宋体">再处理</span><span lang="EN-US"> today_rpt2. </span><span style="FONT-FAMILY: 宋体">此时若文件无法打开</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">将造成错误</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
</span><span style="FONT-FAMILY: 宋体">不存在文件</span><span lang="EN-US">"file_no_exist", </span><span style="FONT-FAMILY: 宋体">则执行</span><span lang="EN-US"> : </span></p>
<p class="a8"><span lang="EN-US">$ awk -f dump.awk file_no_exit </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">将产生运行时错误</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">无法打开文件</span><span lang="EN-US">). </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">但某些</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US"> 
"</span><span style="FONT-FAMILY: 宋体">仅</span><span lang="EN-US">" </span><span style="FONT-FAMILY: 宋体">包含以</span><span lang="EN-US"> BEGIN </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">Pattern</span><span style="FONT-FAMILY: 宋体">的指令</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">执行这种</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序时</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">并不须开启任何数据文件</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">此时命令行上若指定一个不存在的数据文件</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">并不会产生</span><span lang="EN-US"> "</span><span style="FONT-FAMILY: 宋体">无法打开文件</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">的错误</span><span lang="EN-US">.(</span><span style="FONT-FAMILY: 宋体">事实上</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">并未打开该文件</span><span lang="EN-US">) </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如执行</span><span lang="EN-US">: 
</span></p>
<p class="a8"><span lang="EN-US">$ awk 'BEGIN {print "Hello,World!!"} ' 
file_no_exist </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">该程序中仅包含以</span><span lang="EN-US"> BEGIN </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> 
Pattern </span><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US"> Pattern 
{actions}, awk </span><span style="FONT-FAMILY: 宋体">执行时并不会开启任何数据文件</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">所以不会因不存在文件</span><span lang="EN-US">file_no_exit</span><span style="FONT-FAMILY: 宋体">而产生</span><span lang="EN-US"> " </span><span style="FONT-FAMILY: 宋体">无法打开文件</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">的错误</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">会将</span><span lang="EN-US"> Shell </span><span style="FONT-FAMILY: 宋体">命令行上</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> -f </span><span style="FONT-FAMILY: 宋体">程序文件名</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">之后的所有字符串</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">视为将输入</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">进行处理的数据文件文件名</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">若执行</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的命令行上</span><span lang="EN-US"> 
"</span><span style="FONT-FAMILY: 宋体">未指定任何数据文件文件名</span><span lang="EN-US">", 
</span><span style="FONT-FAMILY: 宋体">则将</span><span lang="EN-US">stdin</span><span style="FONT-FAMILY: 宋体">视为输入之数据来源</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">直到输入</span><span lang="EN-US">end of file( Ctrl-D 
)</span><span style="FONT-FAMILY: 宋体">为止</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">读者可以用下列程序自行测试</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">执行如下命令</span><span lang="EN-US"> 
: </span></p>
<p class="a8"><span lang="EN-US">$ awk -f mydump.awk&nbsp; #(</span><span style="FONT-FAMILY: 宋体">未接任何数据文件文件名</span><span lang="EN-US">) </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">$ ./mydisplay&nbsp; #(</span><span style="FONT-FAMILY: 宋体">未接任何数据文件文件名</span><span lang="EN-US">) </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">将会发现</span><span lang="EN-US">: 
</span><span style="FONT-FAMILY: 宋体">此后键入的任何数据将逐行复印一份于屏幕上</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">这情况不是机器当机</span><span lang="EN-US"> ! </span><span style="FONT-FAMILY: 宋体">是因为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序正处于执行中</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">它正按程序指示</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">将读取数据并重新</span><span lang="EN-US">dump</span><span style="FONT-FAMILY: 宋体">一次</span><span lang="EN-US">; 
</span><span style="FONT-FAMILY: 宋体">只因执行时未指定数据文件文件名</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">故</span><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">便以</span><span lang="EN-US">stdin(</span><span style="FONT-FAMILY: 宋体">键盘上的输入</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">为数据来源</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">读者可利用这个特点</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">设计可与</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">即时聊天的程序</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">改变</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">切割字段的方式</span><span lang="EN-US"> &amp; 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">自定义函数</span><span lang="EN-US"> 
</span></h2>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">不仅能自动分割字段</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">也允许使用者改变其字段切割方式以适应各种格式之需要</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">使用者也可自定义函数</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">若有需要可将该函数单独写成一个文件</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">以供其它</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序调用</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> : ] </span><span style="FONT-FAMILY: 宋体">承接</span><span lang="EN-US"> 6.2 </span><span style="FONT-FAMILY: 宋体">的例子</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若八点为上班时间</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">请加注</span><span lang="EN-US"> "*"</span><span style="FONT-FAMILY: 宋体">于迟到记录之前</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并计算平均上班时间</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">分</span> <span style="FONT-FAMILY: 宋体">析</span><span lang="EN-US">: ]</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">因八点整到达者</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">不为迟到</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">故仅以到达的小时数做判断是不够的</span><span lang="EN-US">; 
</span><span style="FONT-FAMILY: 宋体">仍应参考到达时的分钟数</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">若</span><span lang="EN-US"> "</span><span style="FONT-FAMILY: 宋体">将到达时间转换成以分钟为单位</span><span lang="EN-US">", </span><span style="FONT-FAMILY: 宋体">不仅易于判断是否迟到</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">同时也易于计算到达平均时间</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">到达时间</span><span lang="EN-US">($2)</span><span style="FONT-FAMILY: 宋体">的格式为</span><span lang="EN-US"> 
dd:dd </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> d:dd; 
</span><span style="FONT-FAMILY: 宋体">数字当中含有一个</span><span lang="EN-US"> 
":".</span><span style="FONT-FAMILY: 宋体">但文本数字交杂的数据</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">无法直接做数学运算</span><span lang="EN-US">. (</span><span style="FONT-FAMILY: 宋体">注</span><span lang="EN-US">: 
awk</span><span style="FONT-FAMILY: 宋体">中字符串</span><span lang="EN-US">"26"</span><span style="FONT-FAMILY: 宋体">与数字</span><span lang="EN-US">26, </span><span style="FONT-FAMILY: 宋体">并无差异</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">可直接做字符串或数学运算</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">这是</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">重要特色之一</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">但</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">对文本数字交杂的字符串无法正确进行数学运算</span><span lang="EN-US">). 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">解决之方法</span><span lang="EN-US"> : 
</span></p>
<p class="MsoNormal"><span lang="EN-US">[</span><span style="FONT-FAMILY: 宋体">方法一</span><span lang="EN-US">]</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">对到达时间</span><span lang="EN-US">($2) d:dd </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> dd:dd </span><span style="FONT-FAMILY: 宋体">进行字符串运算</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">分别取出到达的小时数及分钟数</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">首先判断到达小时数为一位或两位字符</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">再调用函数分别截取分钟数及小时数</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">此解法需使用下列</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">字符串函数</span><span lang="EN-US">: </span></p>
<p class="MsoNormal"><span lang="EN-US">length( </span><span style="FONT-FAMILY: 宋体">字符串</span><span lang="EN-US"> ) : </span><span style="FONT-FAMILY: 宋体">返回该字符串的长度</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">substr( </span><span style="FONT-FAMILY: 宋体">字符串</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">起始位置</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">长度</span><span lang="EN-US">) :</span><span style="FONT-FAMILY: 宋体">返回从起始位置起</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">指定长度之子字符串</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">若未指定长度</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">则返回从起始位置到字符串末尾的子字符串</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">所以</span><span lang="EN-US">: 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">小时数</span><span lang="EN-US"> = 
substr( $2, 1, length($2) - 3 ) </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">分钟数</span><span lang="EN-US"> = 
substr( $2, length($2) - 2 ) </span></p>
<p class="MsoNormal"><span lang="EN-US">[</span><span style="FONT-FAMILY: 宋体">方法二</span><span lang="EN-US">] </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">改变输入列字段的切割方式</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">使</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">切割字段后分别将小时数及分钟数隔开于二个不同的字段</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">字段分隔字符</span><span lang="EN-US"> 
FS (field seperator) </span><span style="FONT-FAMILY: 宋体">是</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的内建变量</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">其默认值是空白及</span><span lang="EN-US">tab. awk</span><span style="FONT-FAMILY: 宋体">每次切割字段时都会先参考</span><span lang="EN-US">FS </span><span style="FONT-FAMILY: 宋体">的内容</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">若把</span><span lang="EN-US">":"</span><span style="FONT-FAMILY: 宋体">也当成分隔字符</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">便能自动把小时数及分钟数分隔成不同的字段</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">故令</span><span lang="EN-US">FS = 
"[ \t:]+" (</span><span style="FONT-FAMILY: 宋体">注</span><span lang="EN-US">: [ 
\t:]+ </span><span style="FONT-FAMILY: 宋体">为一</span><span lang="EN-US">Regular 
Expression ) </span></p>
<p class="MsoNormal"><span lang="EN-US">Regular Expression </span><span style="FONT-FAMILY: 宋体">中使用中括号</span><span lang="EN-US"> [ ... ] </span><span style="FONT-FAMILY: 宋体">表示一个字符集合</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">用以表示任意一个位于两中括号间的字符</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">故可用</span><span lang="EN-US">"[ \t:]"</span><span style="FONT-FAMILY: 宋体">表示</span> <span style="FONT-FAMILY: 宋体">一个</span> <span style="FONT-FAMILY: 宋体">空白</span><span lang="EN-US"> , tab </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> ":" </span></p>
<p class="MsoNormal"><span lang="EN-US">Regular Expression</span><span style="FONT-FAMILY: 宋体">中使用</span><span lang="EN-US"> "+" </span><span style="FONT-FAMILY: 宋体">形容其前方的字符可出现一次</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">或一次以上</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">故</span><span lang="EN-US"> "[ 
\t:]+" </span><span style="FONT-FAMILY: 宋体">表示由一个或多个</span><span lang="EN-US"> 
"</span><span style="FONT-FAMILY: 宋体">空白</span><span lang="EN-US">, tab 
</span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> : " </span><span style="FONT-FAMILY: 宋体">所组成的字符串</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">设定</span><span lang="EN-US"> FS 
="[ \t:]+" </span><span style="FONT-FAMILY: 宋体">后</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">数据行如</span><span lang="EN-US">: "1034 7:26" 
</span><span style="FONT-FAMILY: 宋体">将被分割成</span><span lang="EN-US">3</span><span style="FONT-FAMILY: 宋体">个字段</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">第一栏</span> <span style="FONT-FAMILY: 宋体">第二栏</span> <span style="FONT-FAMILY: 宋体">第三栏</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">$1 $2 $3 </span></p>
<p class="MsoNormal"><span lang="EN-US">1034 7 26 </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">明显地</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">程序中使用方法二比方法一更简洁方便</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">本例子中采用方法二</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">也借此示范改变字段切割方式的用途</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">编写</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US"> 
reformat3, </span><span style="FONT-FAMILY: 宋体">如下</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">#!/bin/sh </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US">awk ' </span></p>
<p class="a8"><span lang="EN-US">BEGIN { </span></p>
<p class="a8"><span lang="EN-US">FS= "[ \t:]+" #</span><span style="FONT-FAMILY: 宋体">改变字段切割的方式</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">"date" | getline # Shell </span><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US"> "date". getline </span><span style="FONT-FAMILY: 宋体">取得结果以</span><span lang="EN-US">$0</span><span style="FONT-FAMILY: 宋体">记录</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">print " Today is " ,$2, $3 &gt; "today_rpt3" 
</span></p>
<p class="a8"><span lang="EN-US">print "========================="&gt;"today_rpt3" 
</span></p>
<p class="a8"><span lang="EN-US">print " ID Number Arrival Time" &gt; "today_rpt3" 
</span></p>
<p class="a8"><span lang="EN-US">close( "today_rpt3" ) </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">{ </span></p>
<p class="a8"><span lang="EN-US">#</span><span style="FONT-FAMILY: 宋体">已更改字段切割方式</span><span lang="EN-US">, $2</span><span style="FONT-FAMILY: 宋体">表到达小时数</span><span lang="EN-US">, $3</span><span style="FONT-FAMILY: 宋体">表分钟数</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">arrival = HM_to_M($2, $3) </span></p>
<p class="a8"><span lang="EN-US">printf(" %s %s:%s %s\n", $1, $2, $3, arrival &gt; 
480 ? "*": " " ) | "sort -k 1 &gt;&gt; today_rpt3" </span></p>
<p class="a8"><span lang="EN-US">total += arrival </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">END { </span></p>
<p class="a8"><span lang="EN-US">close("today_rpt3") </span></p>
<p class="a8"><span lang="EN-US">close("sort -k 1 &gt;&gt; today_rpt3") </span></p>
<p class="a8"><span lang="EN-US">printf(" Average arrival time : 
%d:%d\n",total/NR/60, (total/NR)%60 ) &gt;&gt; "today_rpt3" </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">function HM_to_M( hour, min ){ </span></p>
<p class="a8"><span lang="EN-US">return hour*60 + min </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">' $* </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">并执行如下指令</span><span lang="EN-US"> 
: </span></p>
<p class="a8"><span lang="EN-US">$ ./reformat3 arr.dat</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行后</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">文件</span><span lang="EN-US"> 
today_rpt3 </span><span style="FONT-FAMILY: 宋体">的内容如下</span><span lang="EN-US">: 
</span></p>
<p class="a8"><span lang="EN-US">&nbsp;Today is&nbsp; 09<span style="FONT-FAMILY: 宋体">月</span> 21</span><span style="FONT-FAMILY: 宋体">日</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">========================= </span></p>
<p class="a8"><span lang="EN-US">&nbsp;ID Number Arrival Time </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1005 8:12 * </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1006 7:45&nbsp; </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1008 8:01 * </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1012 7:46&nbsp; </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1025 7:27&nbsp; </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1028 7:49&nbsp; </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1029 7:57&nbsp; </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1034 7:26&nbsp; </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1042 7:59&nbsp; </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1051 7:51&nbsp; </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1052 8:05 * </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1101 7:32&nbsp; </span></p>
<p class="a8"><span lang="EN-US">&nbsp;Average arrival time : 7:49 </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US"> : ]</span></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">中亦允许使用者自定函数</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">函数定义方式请参考本程序</span><span lang="EN-US">, function 
</span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">的保留字</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">HM_to_M( ) </span><span style="FONT-FAMILY: 宋体">这函数负责将所传入之小时及分钟数转换成以分钟为单位</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">使用者自定函数时</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">还有许多细节须留心</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US">data scope,.. ( 
</span><span style="FONT-FAMILY: 宋体">请参考</span> <span style="FONT-FAMILY: 宋体">第十节</span><span lang="EN-US"> Recursive Program) 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中亦提供与</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言中相同的</span><span lang="EN-US"> Conditional Operator. 
</span><span style="FONT-FAMILY: 宋体">上式</span><span lang="EN-US">printf()</span><span style="FONT-FAMILY: 宋体">中使用</span><span lang="EN-US">arrival &gt;480 ? "*" : " " </span><span style="FONT-FAMILY: 宋体">即为一例若</span><span lang="EN-US"> arrival </span><span style="FONT-FAMILY: 宋体">大于</span><span lang="EN-US"> 480 </span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US">return "*" , </span><span style="FONT-FAMILY: 宋体">否则</span><span lang="EN-US">return " ". </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">% </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的运算符</span><span lang="EN-US">(operator), </span><span style="FONT-FAMILY: 宋体">其作用与</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言中之</span><span lang="EN-US"> % </span><span style="FONT-FAMILY: 宋体">相同</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">取余数</span><span lang="EN-US">). </span></p>
<p class="MsoNormal"><span lang="EN-US">NR(Number of Record) </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的内建变量</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">表示</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">执行该程序后所读入的记录笔数</span><span lang="EN-US">.</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">中提供的</span><span lang="EN-US"> close( )</span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">语法如下</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">有二种</span><span lang="EN-US">) : </span></p>
<p class="MsoNormal"><span lang="EN-US">close( filename ) </span></p>
<p class="MsoNormal"><span lang="EN-US">close( </span><span style="FONT-FAMILY: 宋体">置于</span><span lang="EN-US">pipe</span><span style="FONT-FAMILY: 宋体">之前的</span><span lang="EN-US">command ) </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">为何本程序使用了两个</span><span lang="EN-US"> close( ) </span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US"> : </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US"> 
close( "sort -k 1 &gt;&gt; today_rpt3" ), </span><span style="FONT-FAMILY: 宋体">其意思为</span><span lang="EN-US"> close </span><span style="FONT-FAMILY: 宋体">程序中置于</span><span lang="EN-US"> "sort -k 1 &gt;&gt; 
today_rpt3 " </span><span style="FONT-FAMILY: 宋体">之前的</span><span lang="EN-US"> 
Pipe , </span><span style="FONT-FAMILY: 宋体">并立刻调用</span><span lang="EN-US"> Shell 
</span><span style="FONT-FAMILY: 宋体">来执行</span><span lang="EN-US">"sort -k 1 
&gt;&gt; today_rpt3". (</span><span style="FONT-FAMILY: 宋体">若未执行这指令</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">必须于结束该程序时才会进行上述动作</span><span lang="EN-US">;</span><span style="FONT-FAMILY: 宋体">则这</span><span lang="EN-US">12</span><span style="FONT-FAMILY: 宋体">笔</span><span lang="EN-US">sort</span><span style="FONT-FAMILY: 宋体">后的数据将被</span><span lang="EN-US"> append </span><span style="FONT-FAMILY: 宋体">到文件</span><span lang="EN-US"> today_rpt3 </span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">"Average arrival time : ..." </span><span style="FONT-FAMILY: 宋体">的后方</span><span lang="EN-US">) </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">因为</span><span lang="EN-US"> 
Shell </span><span style="FONT-FAMILY: 宋体">排序后的数据也要写到</span><span lang="EN-US"> 
today_rpt3, </span><span style="FONT-FAMILY: 宋体">所以</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">必须先关闭使用中的</span><span lang="EN-US">today_rpt3 </span><span style="FONT-FAMILY: 宋体">以使</span><span lang="EN-US"> Shell </span><span style="FONT-FAMILY: 宋体">正确将排序后的数据追加到</span><span lang="EN-US">today_rpt3</span><span style="FONT-FAMILY: 宋体">否则</span><span lang="EN-US">2</span><span style="FONT-FAMILY: 宋体">个不同的</span><span lang="EN-US"> 
process </span><span style="FONT-FAMILY: 宋体">同时打开一个文件进行输出将会产生不可预期的结果</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">读者应留心上述两点</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">才可正确控制数据输出到文件中的顺序</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US"> 
close("sort -k 1 &gt;&gt; today_rpt3")</span><span style="FONT-FAMILY: 宋体">中字符串</span><span lang="EN-US"> "sort +0n &gt;&gt; 
today_rpt3" </span><span style="FONT-FAMILY: 宋体">必须与</span><span lang="EN-US"> 
pipe | </span><span style="FONT-FAMILY: 宋体">后方的</span><span lang="EN-US"> Shell 
Command </span><span style="FONT-FAMILY: 宋体">名称一字不差</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">否则</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">将视为二个不同的</span><span lang="EN-US"> pipe. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">读者可于</span><span lang="EN-US">BEGIN{}</span><span style="FONT-FAMILY: 宋体">中先令变量</span><span lang="EN-US"> Sys_call = "sort +0n &gt;&gt; today_rpt3", </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">程序中再一律以</span><span lang="EN-US"> 
Sys_call </span><span style="FONT-FAMILY: 宋体">代替该字符串</span><span lang="EN-US">. 
</span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">使用</span><span lang="EN-US"> getline </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">来读取数据</span> </h2>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">范</span> <span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US"> : ] </span><span style="FONT-FAMILY: 宋体">承上题</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">从文件中读取当月迟到次数</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并根据当日出勤状况更新迟到累计数</span><span lang="EN-US">.(</span><span style="FONT-FAMILY: 宋体">按不同的月份累计于不同的文件</span><span lang="EN-US">) </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">分</span> <span style="FONT-FAMILY: 宋体">析</span><span lang="EN-US"> : ]</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">程序中自动抓取系统日期的月份名称</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">连接上</span><span lang="EN-US">"late.dat", </span><span style="FONT-FAMILY: 宋体">形成累计迟到次数的文件名称</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US"> : 09</span><span style="FONT-FAMILY: 宋体">月</span><span lang="EN-US">late.dat,...), </span><span style="FONT-FAMILY: 宋体">并以变量</span><span lang="EN-US">late_file</span><span style="FONT-FAMILY: 宋体">记录该文件名</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">累计迟到次数的文件中的数据格式为</span><span lang="EN-US">: </span><span style="FONT-FAMILY: 宋体">员工代号</span><span lang="EN-US">(ID) </span><span style="FONT-FAMILY: 宋体">迟到次数</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">执行本程序前文件</span><span lang="EN-US"> 
09</span><span style="FONT-FAMILY: 宋体">月</span><span lang="EN-US">late.dat 
</span><span style="FONT-FAMILY: 宋体">的内容为</span><span lang="EN-US"> : </span></p>
<p class="a8"><span lang="EN-US">1012 0 </span></p>
<p class="a8"><span lang="EN-US">1006 1 </span></p>
<p class="a8"><span lang="EN-US">1052 2 </span></p>
<p class="a8"><span lang="EN-US">1034 0 </span></p>
<p class="a8"><span lang="EN-US">1005 0 </span></p>
<p class="a8"><span lang="EN-US">1029 2 </span></p>
<p class="a8"><span lang="EN-US">1042 0 </span></p>
<p class="a8"><span lang="EN-US">1051 0 </span></p>
<p class="a8"><span lang="EN-US">1008 0 </span></p>
<p class="a8"><span lang="EN-US">1101 0 </span></p>
<p class="a8"><span lang="EN-US">1025 1 </span></p>
<p class="a8"><span lang="EN-US">1028 0 </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">编写程序</span><span lang="EN-US"> 
reformat4 </span><span style="FONT-FAMILY: 宋体">如下</span><span lang="EN-US">: 
</span></p>
<p class="a8"><span lang="EN-US">#!/bin/sh </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US">awk ' </span></p>
<p class="a8"><span lang="EN-US">BEGIN { </span></p>
<p class="a8"><span lang="EN-US">Sys_Sort = "sort -k 1 &gt;&gt; today_rpt4" 
</span></p>
<p class="a8"><span lang="EN-US">Result = "today_rpt4" </span></p>
<p class="a8"><span lang="EN-US"># </span><span style="FONT-FAMILY: 宋体">改变字段切割的方式</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">FS = "[ \t:]+" </span></p>
<p class="a8"><span lang="EN-US"># </span><span style="FONT-FAMILY: 宋体">令</span><span lang="EN-US"> Shell</span><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US">"date"; getline </span><span style="FONT-FAMILY: 宋体">读取结果</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">并以</span><span lang="EN-US">$0</span><span style="FONT-FAMILY: 宋体">记录</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">"date" | getline </span></p>
<p class="a8"><span lang="EN-US">print " Today is " , $2, $3 &gt;Result </span></p>
<p class="a8"><span lang="EN-US">print "=========================" &gt; Result 
</span></p>
<p class="a8"><span lang="EN-US">print " ID Number Arrival Time" &gt; Result 
</span></p>
<p class="a8"><span lang="EN-US">close( Result ) </span></p>
<p class="a8"><span lang="EN-US"># </span><span style="FONT-FAMILY: 宋体">从文件按中读取迟到数据</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并用数组</span><span lang="EN-US">cnt[ ]</span><span style="FONT-FAMILY: 宋体">记录</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">数组</span><span lang="EN-US">cnt[ ]</span><span style="FONT-FAMILY: 宋体">中以</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US"># </span><span style="FONT-FAMILY: 宋体">员工代号为下标</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">所对应的值为该员工之迟到次数</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">late_file = $2"late.dat" </span></p>
<p class="a8"><span lang="EN-US">while( getline &lt; late_file &gt;0 ) cnt[$1] = $2 
</span></p>
<p class="a8"><span lang="EN-US">close( late_file ) </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">{ </span></p>
<p class="a8"><span lang="EN-US"># </span><span style="FONT-FAMILY: 宋体">已更改字段切割方式</span><span lang="EN-US">, $2</span><span style="FONT-FAMILY: 宋体">表小时数</span><span lang="EN-US">,$3</span><span style="FONT-FAMILY: 宋体">表分钟数</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">arrival = HM_to_M($2, $3) </span></p>
<p class="a8"><span lang="EN-US">if( arrival &gt; 480 ){ </span></p>
<p class="a8"><span lang="EN-US">mark = "*" # </span><span style="FONT-FAMILY: 宋体">若当天迟到</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">应再增加其迟到次数</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">且令</span><span lang="EN-US">mark </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">"*". </span></p>
<p class="a8"><span lang="EN-US">cnt[$1]++ } </span></p>
<p class="a8"><span lang="EN-US">else mark = " " </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US"># message </span><span style="FONT-FAMILY: 宋体">用以显示该员工的迟到累计数</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若未曾迟到</span><span lang="EN-US">message</span><span style="FONT-FAMILY: 宋体">为空字符串</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">message = cnt[$1] ? cnt[$1] " times" : "" 
</span></p>
<p class="a8"><span lang="EN-US">printf("%s %2d:%2d %5s %s\n", $1, $2, $3, mark, 
message ) | Sys_Sort </span></p>
<p class="a8"><span lang="EN-US">total += arrival </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">END { </span></p>
<p class="a8"><span lang="EN-US">close( Result ) </span></p>
<p class="a8"><span lang="EN-US">close( Sys_Sort ) </span></p>
<p class="a8"><span lang="EN-US">printf(" Average arrival time : %d:%d\n", 
total/NR/60, (total/NR)%60 ) &gt;&gt; Result </span></p>
<p class="a8"><span lang="EN-US">#</span><span style="FONT-FAMILY: 宋体">将数组</span><span lang="EN-US">cnt[ ]</span><span style="FONT-FAMILY: 宋体">中新的迟到数据写回文件中</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">for( any in cnt ) </span></p>
<p class="a8"><span lang="EN-US">print any, cnt[any] &gt; late_file </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">function HM_to_M( hour, min ){ </span></p>
<p class="a8"><span lang="EN-US">return hour*60 + min </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">' $* </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行后</span><span lang="EN-US">, 
today_rpt4 </span><span style="FONT-FAMILY: 宋体">之内容如下</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">&nbsp;Today is&nbsp; 09<span style="FONT-FAMILY: 宋体">月</span> 21</span><span style="FONT-FAMILY: 宋体">日</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">========================= </span></p>
<p class="a8"><span lang="EN-US">&nbsp;ID Number Arrival Time </span></p>
<p class="a8"><span lang="EN-US">1005&nbsp; 8:12 &nbsp;&nbsp;&nbsp;&nbsp;* 1 times 
</span></p>
<p class="a8"><span lang="EN-US">1006&nbsp; 7:45&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1 times </span></p>
<p class="a8"><span lang="EN-US">1008&nbsp; 8: 1&nbsp;&nbsp;&nbsp;&nbsp; * 1 times 
</span></p>
<p class="a8"><span lang="EN-US">1012&nbsp; 7:46&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></p>
<p class="a8"><span lang="EN-US">1025&nbsp; 7:27&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1 times </span></p>
<p class="a8"><span lang="EN-US">1028&nbsp; 7:49&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></p>
<p class="a8"><span lang="EN-US">1029&nbsp; 7:57&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
2 times </span></p>
<p class="a8"><span lang="EN-US">1034&nbsp; 7:26&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></p>
<p class="a8"><span lang="EN-US">1042&nbsp; 7:59&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></p>
<p class="a8"><span lang="EN-US">1051&nbsp; 7:51&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></p>
<p class="a8"><span lang="EN-US">1052&nbsp; 8: 5&nbsp;&nbsp;&nbsp;&nbsp; * 3 times 
</span></p>
<p class="a8"><span lang="EN-US">1101&nbsp; 7:32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></p>
<p class="a8"><span lang="EN-US">&nbsp;Average arrival time : 7:49 </span></p>
<p class="MsoNormal"><span lang="EN-US">09</span><span style="FONT-FAMILY: 宋体">月</span><span lang="EN-US">late.dat </span><span style="FONT-FAMILY: 宋体">文件被修改为如下</span><span lang="EN-US">:</span></p>
<p class="a8"><span lang="EN-US">1005 1 </span></p>
<p class="a8"><span lang="EN-US">1012 0 </span></p>
<p class="a8"><span lang="EN-US">1006 1 </span></p>
<p class="a8"><span lang="EN-US">1008 1 </span></p>
<p class="a8"><span lang="EN-US">1101 0 </span></p>
<p class="a8"><span lang="EN-US">1025 1 </span></p>
<p class="a8"><span lang="EN-US">1034 0 </span></p>
<p class="a8"><span lang="EN-US">1042 0 </span></p>
<p class="a8"><span lang="EN-US">1028 0 </span></p>
<p class="a8"><span lang="EN-US">1029 2 </span></p>
<p class="a8"><span lang="EN-US">1051 0 </span></p>
<p class="a8"><span lang="EN-US">1052 3 </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US"> : </span></p>
<p class="MsoNormal"><span lang="EN-US">late_file </span><span style="FONT-FAMILY: 宋体">是一变量</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">用以记录迟到次数的文件的文件名</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">late_file</span><span style="FONT-FAMILY: 宋体">之值由两部分构成</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">前半部是当月月份名称</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">由调用</span><span lang="EN-US">"date"</span><span style="FONT-FAMILY: 宋体">取得</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">后半部固定为</span><span lang="EN-US">"late.dat" </span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US">: 09</span><span style="FONT-FAMILY: 宋体">月</span><span lang="EN-US">late.dat. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US"> 
getline &lt; late_file </span><span style="FONT-FAMILY: 宋体">表示从</span><span lang="EN-US">late_file</span><span style="FONT-FAMILY: 宋体">所代表的文件中读取一笔记录</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并存放于</span><span lang="EN-US">$0. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">若使用者可自行把数据放入</span><span lang="EN-US">$0, awk</span><span style="FONT-FAMILY: 宋体">会自动对这新置入</span><span lang="EN-US"> $0 </span><span style="FONT-FAMILY: 宋体">的数据进行字段分割</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">之后程序中可用</span><span lang="EN-US">$1, $2,..</span><span style="FONT-FAMILY: 宋体">来表示该笔资料的第一栏</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">第二栏</span><span lang="EN-US">,.., 
</span></p>
<p class="MsoNormal"><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">注</span><span lang="EN-US">: </span><span style="FONT-FAMILY: 宋体">有少数</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">版本不容许使用者自行将数据置于</span><span lang="EN-US"> $0, </span><span style="FONT-FAMILY: 宋体">遇此情况可改用</span><span lang="EN-US">gawk</span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US">nawk) </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US">getline</span><span style="FONT-FAMILY: 宋体">指令时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若成功读取记录</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">它会返回</span><span lang="EN-US">1. 
</span><span style="FONT-FAMILY: 宋体">若遇到文件结束</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">它返回</span><span lang="EN-US">0; </span><span style="FONT-FAMILY: 宋体">无法打开文件则返回</span><span lang="EN-US">-1. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">利用</span><span lang="EN-US"> 
while( getline &lt; filename &gt;0 ) {....}</span><span style="FONT-FAMILY: 宋体">可读入文件中的每一笔数据并予处理</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">这是</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中用户自行读取数据文件的一个重要模式</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">数组</span><span lang="EN-US"> cnt[ 
] </span><span style="FONT-FAMILY: 宋体">以员工</span><span lang="EN-US">ID. 
</span><span style="FONT-FAMILY: 宋体">当下标</span><span lang="EN-US">(index), 
</span><span style="FONT-FAMILY: 宋体">其对应值表示其迟到的次数</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行结束后</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">利用</span><span lang="EN-US"> for(Variable in 
array ){...}</span><span style="FONT-FAMILY: 宋体">的语法</span></p>
<p class="MsoNormal"><span lang="EN-US">for( any in cnt ) print any, cnt[any] &gt; 
late_file </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">将更新过的迟到数据重新写回记录迟到次数的文件</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">该语法在前面曾有说明</span><span lang="EN-US">. 
</span></p>
<h1><span lang="EN-US">8.<span style="FONT: 7pt 'Times New Roman'"> 
</span></span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">处理多行的数据</span><span lang="EN-US"> </span></h1>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">每次从数据文件中只读取一数据进行处理</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">是依照其内建变量</span><span lang="EN-US"> RS(Record Separator) 
</span><span style="FONT-FAMILY: 宋体">的定义将文件中的数据分隔成一行一行的</span><span lang="EN-US">Record. RS </span><span style="FONT-FAMILY: 宋体">的默认值是</span><span lang="EN-US"> "\n"(</span><span style="FONT-FAMILY: 宋体">跳行符号</span><span lang="EN-US">), </span><span style="FONT-FAMILY: 宋体">故平常</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">中一行数据就是一笔</span><span lang="EN-US"> Record. </span><span style="FONT-FAMILY: 宋体">但有些文件中一笔</span><span lang="EN-US">Record</span><span style="FONT-FAMILY: 宋体">涵盖了多行数据</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">这种情况下不能再以</span><span lang="EN-US"> "\n" </span><span style="FONT-FAMILY: 宋体">来分隔</span><span lang="EN-US">Records. </span><span style="FONT-FAMILY: 宋体">最常使用的方法是相邻的</span><span lang="EN-US">Records</span><span style="FONT-FAMILY: 宋体">之间改以</span> <span style="FONT-FAMILY: 宋体">一个空白行</span> <span style="FONT-FAMILY: 宋体">来隔开</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">在</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">令</span><span lang="EN-US"> RS = ""(</span><span style="FONT-FAMILY: 宋体">空字符串</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">后</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">把会空白行当成来文件中</span><span lang="EN-US">Record</span><span style="FONT-FAMILY: 宋体">的分隔符</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">显然</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">对</span><span lang="EN-US"> RS = "" </span><span style="FONT-FAMILY: 宋体">另有解释方式</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">简略描述如下</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> RS = "" </span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">:</span><span style="FONT-FAMILY: 宋体">数个并邻的空白行</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">仅视成一个单一的</span><span lang="EN-US">Record Saparator. 
(awk</span><span style="FONT-FAMILY: 宋体">不会于两个紧并的空白行之间读取一笔空的</span><span lang="EN-US">Record) </span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">会略过</span><span lang="EN-US">(skip)</span><span style="FONT-FAMILY: 宋体">文件头或文件尾的空白行</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">故不会因为这样的空白行</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">造成</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">多读入了二笔空的数据</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">请观察下例</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">首先建立一个数据文件</span><span lang="EN-US"> week.rpt</span><span style="FONT-FAMILY: 宋体">如下</span><span lang="EN-US">: </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span style="FONT-FAMILY: 宋体">张长弓</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">GNUPLOT </span><span style="FONT-FAMILY: 宋体">入门</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span style="FONT-FAMILY: 宋体">吴国强</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">Latex </span><span style="FONT-FAMILY: 宋体">简介</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">VAST-2 </span><span style="FONT-FAMILY: 宋体">使用手册</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">mathematic </span><span style="FONT-FAMILY: 宋体">入门</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span style="FONT-FAMILY: 宋体">李小华</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">awk Tutorial Guide</span></p>
<p class="a8"><span lang="EN-US">Regular Expression </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">该文件的开头有数行空白行</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">各笔</span><span lang="EN-US">Record</span><span style="FONT-FAMILY: 宋体">之间使用一个或数个空白行隔开</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">读者请细心观察</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> RS = 
"" </span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">读取该数据文件之方式</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">编辑一个</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序文件</span><span lang="EN-US"> 
make_report</span><span style="FONT-FAMILY: 宋体">如下</span><span lang="EN-US">: 
</span></p>
<p class="a8"><span lang="EN-US">#!/bin/sh </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US">awk ' </span></p>
<p class="a8"><span lang="EN-US">BEGIN { </span></p>
<p class="a8"><span lang="EN-US">FS = "\n" </span></p>
<p class="a8"><span lang="EN-US">RS = "" </span></p>
<p class="a8"><span lang="EN-US">split( "</span><span style="FONT-FAMILY: 宋体">一</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">二</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">三</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">四</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">五</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">六</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">七</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">八</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">九</span><span lang="EN-US">.", C_Number, " " ) </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">{ </span></p>
<p class="a8"><span lang="EN-US">printf("\n%s </span><span style="FONT-FAMILY: 宋体">报告人</span><span lang="EN-US"> : %s \n",C_Number[NR],$1) 
</span></p>
<p class="a8"><span lang="EN-US">for( i=2; i &lt;= NF; i++) printf(" %d. %s\n", i-1, 
$i) </span></p>
<p class="a8"><span lang="EN-US">} ' $* </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">$ make_report week.rpt </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">屏幕产生结果如下</span><span lang="EN-US">: </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span style="FONT-FAMILY: 宋体">一</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">报告人</span><span lang="EN-US"> : </span><span style="FONT-FAMILY: 宋体">张长弓</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1. GNUPLOT </span><span style="FONT-FAMILY: 宋体">入门</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span style="FONT-FAMILY: 宋体">二</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">报告人</span><span lang="EN-US"> : </span><span style="FONT-FAMILY: 宋体">吴国强</span><span lang="EN-US">&nbsp; </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1. Latex </span><span style="FONT-FAMILY: 宋体">简介</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">&nbsp;2. VAST-2 </span><span style="FONT-FAMILY: 宋体">使用手册</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">&nbsp;3. mathematic </span><span style="FONT-FAMILY: 宋体">入门</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span style="FONT-FAMILY: 宋体">三</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">报告人</span><span lang="EN-US"> : </span><span style="FONT-FAMILY: 宋体">李小华</span><span lang="EN-US">&nbsp; </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1. awk Tutorial Guide </span></p>
<p class="a8"><span lang="EN-US">&nbsp;2. Regular Expression </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US">: ]</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">本程序同时也改变字段分隔字符</span><span lang="EN-US">( FS= "\n" ), </span><span style="FONT-FAMILY: 宋体">如此一笔数据中的每一行都是一个</span><span lang="EN-US">field. 
</span><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: awk</span><span style="FONT-FAMILY: 宋体">读入的第一笔</span><span lang="EN-US"> Record </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> </span></p>
<p class="a8"><span style="FONT-FAMILY: 宋体">张长弓</span></p>
<p class="a8"><span lang="EN-US">GNUPLOT </span><span style="FONT-FAMILY: 宋体">入门</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">其中</span><span lang="EN-US"> $1 
</span><span style="FONT-FAMILY: 宋体">指的是</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">张长弓</span><span lang="EN-US">", $2 </span><span style="FONT-FAMILY: 宋体">指的是</span><span lang="EN-US">"GNUPLOT </span><span style="FONT-FAMILY: 宋体">入门</span><span lang="EN-US">" </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">上式中的</span><span lang="EN-US">C_Number[ ]</span><span style="FONT-FAMILY: 宋体">是一个数组</span><span lang="EN-US">(array), </span><span style="FONT-FAMILY: 宋体">用以记录中文数字</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
C_Number[1] = "</span><span style="FONT-FAMILY: 宋体">一</span><span lang="EN-US">.", 
C_Number[2] = "</span><span style="FONT-FAMILY: 宋体">二</span><span lang="EN-US">." 
</span><span style="FONT-FAMILY: 宋体">这过程使用</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">字符串函数</span><span lang="EN-US"> 
split( ) </span><span style="FONT-FAMILY: 宋体">来把中文数字放进数组</span><span lang="EN-US"> 
C_Number[ ]</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">函数</span><span lang="EN-US"> 
split( )</span><span style="FONT-FAMILY: 宋体">用法如下</span><span lang="EN-US">: 
</span></p>
<p class="MsoNormal"><span lang="EN-US">split( </span><span style="FONT-FAMILY: 宋体">原字符串</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">数组名</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">分隔字符</span><span lang="EN-US">(field separator) ) : 
awk</span><span style="FONT-FAMILY: 宋体">将依所指定的分隔字符</span><span lang="EN-US">(field 
separator)</span><span style="FONT-FAMILY: 宋体">分隔原字符串成一个个的字段</span><span lang="EN-US">(field), </span><span style="FONT-FAMILY: 宋体">并以指定的</span> <span style="FONT-FAMILY: 宋体">数组</span> <span style="FONT-FAMILY: 宋体">记录各个被分隔的字段</span></p>
<h1><span lang="EN-US">9.<span style="FONT: 7pt 'Times New Roman'"> 
</span></span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">如何读取命令行上的参数</span><span lang="EN-US"> </span></h1>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">大部分的应用程序都允许使用者在命令之后增加一些选择性的参数</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">时这些参数大部分用于指定数据文件文件名</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">有时希望在程序中能从命令行上得到一些其它用途的数据</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">本小节中将叙述如何在</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序中取用这些参数</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">建立文件如下</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">命名为</span><span lang="EN-US"> see_arg : 
</span></p>
<p class="a8"><span lang="EN-US">#!/bin/sh </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US">awk ' </span></p>
<p class="a8"><span lang="EN-US">BEGIN { </span></p>
<p class="a8"><span lang="EN-US">for( i=0; i&lt;ARGC ; i++) </span></p>
<p class="a8"><span lang="EN-US">print ARGV[i] # </span><span style="FONT-FAMILY: 宋体">依次印出</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">所记录的参数</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">' $* </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行如下命令</span><span lang="EN-US"> 
: </span></p>
<p class="a8"><span lang="EN-US">$ ./see_arg first-arg second-arg </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">结果屏幕出现</span><span lang="EN-US"> 
: </span></p>
<p class="a8"><span lang="EN-US">awk </span></p>
<p class="a8"><span lang="EN-US">first-arg </span></p>
<p class="a8"><span lang="EN-US">second-arg </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">说明</span><span lang="EN-US"> : ]</span></p>
<p class="MsoNormal"><span lang="EN-US">ARGC, ARGV[ ] </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">所提供的内建变量</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">ARGC : </span><span style="FONT-FAMILY: 宋体">为一整数</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">代表命令行上</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">除了选项</span><span lang="EN-US">-v, -f </span><span style="FONT-FAMILY: 宋体">及其对应的参数之外所有参数的数目</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">ARGV[ ] : </span><span style="FONT-FAMILY: 宋体">为一字符串数组</span><span lang="EN-US">. 
ARGV[0],ARGV[1],...ARGV[ARGC-1]. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">分别代表命令行上相对应的参数</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">当命令行为</span><span lang="EN-US"> : </span></p>
<p class="a8"><span lang="EN-US">$ awk -vx=36 -f program1 data1 data2 </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">$ awk '{ print $1 ,$2 }' data1 data2 </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">其</span><span lang="EN-US"> ARGC 
</span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> 3 </span></p>
<p class="MsoNormal"><span lang="EN-US">ARGV[0] </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> "awk" </span></p>
<p class="MsoNormal"><span lang="EN-US">ARGV[1] </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> "data1" </span></p>
<p class="MsoNormal"><span lang="EN-US">ARGV[2] </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> "data2" </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">命令行上的</span><span lang="EN-US"> 
"-f program1", " -vx=36", </span><span style="FONT-FAMILY: 宋体">或程序部分</span><span lang="EN-US"> '{ print $1, $2}' </span><span style="FONT-FAMILY: 宋体">都不会列入</span><span lang="EN-US"> ARGC </span><span style="FONT-FAMILY: 宋体">及</span><span lang="EN-US"> ARGV[ ] </span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">利用</span><span lang="EN-US"> ARGC </span><span style="FONT-FAMILY: 宋体">来判断应开启的数据文件个数</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">但使用者可强行改变</span><span lang="EN-US"> ARGC; </span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> 
ARGC </span><span style="FONT-FAMILY: 宋体">之值被使用者设为</span><span lang="EN-US"> 1 
</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">; </span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">将被蒙骗</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">误以为命令行上并无数据文件文件名</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">故不会以</span><span lang="EN-US"> ARGV[1], 
ARGV[2],..</span><span style="FONT-FAMILY: 宋体">为文件名来打开文件读取数据</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">但在程序中仍可通过</span><span lang="EN-US"> ARGV[1], ARGV[2],..</span><span style="FONT-FAMILY: 宋体">来取得命令行上的数据</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">某一程序</span><span lang="EN-US"> 
test1.awk </span><span style="FONT-FAMILY: 宋体">如下</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">BEGIN{ </span></p>
<p class="a8"><span lang="EN-US">number = ARGC #</span><span style="FONT-FAMILY: 宋体">先用</span><span lang="EN-US">number </span><span style="FONT-FAMILY: 宋体">记住实际的参数个数</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">ARGC = 2 # </span><span style="FONT-FAMILY: 宋体">自行更改</span><span lang="EN-US"> ARGC=2, awk</span><span style="FONT-FAMILY: 宋体">将以为只有一个资料文件</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US"># </span><span style="FONT-FAMILY: 宋体">仍可藉由</span><span lang="EN-US">ARGV[ ]</span><span style="FONT-FAMILY: 宋体">取得命令行上的资料</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">for( i=2; i&lt;number; i++) data[i] = ARGV[i] 
</span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">........ </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">于命令行上键入</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">$ awk -f test1.awk data_file apple orange 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行时</span><span lang="EN-US"> awk 
</span><span style="FONT-FAMILY: 宋体">会打开数据文件</span><span lang="EN-US"> data_file 
</span><span style="FONT-FAMILY: 宋体">以进行处理</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">但不会打开以</span><span lang="EN-US">apple,orange </span><span style="FONT-FAMILY: 宋体">为档名的文件</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">因为</span><span lang="EN-US"> ARGC </span><span style="FONT-FAMILY: 宋体">被改成</span><span lang="EN-US">2). </span><span style="FONT-FAMILY: 宋体">但仍可通过</span><span lang="EN-US">ARGV[2], 
ARGV[3]</span><span style="FONT-FAMILY: 宋体">取得命令行上的参数</span><span lang="EN-US"> 
apple, orange </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">也可以用下列命令来达成上例的效果</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">$awk -f test2.awk -v data[2]="apple" -v 
data[3]="orange" data_file </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h1><span lang="EN-US">10.<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">编写可与用户交互的</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">程序</span><span lang="EN-US"> </span></h1>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序时</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">会自动从文件中读取数据来进行处理</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">直到文件结束</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">只要将</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">读取数据的来源改成键盘输入</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">便可设计与</span><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">交互的程序了</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">本节将提供一个该类程序的范例</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> :] </span><span style="FONT-FAMILY: 宋体">本节将编写一个英语生字测验的程序</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">它将印出中文字意</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">再由使用者回答其英语生字</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">首先编辑一个数据挡</span><span lang="EN-US"> test.dat (</span><span style="FONT-FAMILY: 宋体">内容不限</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">格式如下</span><span lang="EN-US">) 
</span></p>
<p class="a8"><span lang="EN-US">apple </span><span style="FONT-FAMILY: 宋体">苹果</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">orange </span><span style="FONT-FAMILY: 宋体">柳橙</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">banana </span><span style="FONT-FAMILY: 宋体">香蕉</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">pear </span><span style="FONT-FAMILY: 宋体">梨子</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">starfruit </span><span style="FONT-FAMILY: 宋体">杨桃</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">bellfruit </span><span style="FONT-FAMILY: 宋体">莲雾</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">kiwi </span><span style="FONT-FAMILY: 宋体">奇异果</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">pineapple </span><span style="FONT-FAMILY: 宋体">菠萝</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">watermelon </span><span style="FONT-FAMILY: 宋体">西瓜</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">编辑</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US">"c2e"</span><span style="FONT-FAMILY: 宋体">如下</span><span lang="EN-US">: 
</span></p>
<p class="a8"><span lang="EN-US">#!/bin/sh </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US">awk ' </span></p>
<p class="a8"><span lang="EN-US">BEGIN { </span></p>
<p class="a8"><span lang="EN-US">while( getline &lt; ARGV[1] ){ #</span><span style="FONT-FAMILY: 宋体">由指定的文件中读取测验数据</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">English[++n] = $1 # </span><span style="FONT-FAMILY: 宋体">最后</span><span lang="EN-US">, n </span><span style="FONT-FAMILY: 宋体">将表示题目之题数</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">Chinese[n] = $2 </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">ARGV[1] = "-" # "-"</span><span style="FONT-FAMILY: 宋体">表示由</span><span lang="EN-US">stdin(</span><span style="FONT-FAMILY: 宋体">键盘输入</span><span lang="EN-US">) </span></p>
<p class="a8"><span lang="EN-US">srand() # </span><span style="FONT-FAMILY: 宋体">以系统时间为随机数启始的种子</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">question() #</span><span style="FONT-FAMILY: 宋体">产生考题</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US">{# awk</span><span style="FONT-FAMILY: 宋体">自动读入由键盘上输入的数据</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">使用者回答的答案</span><span lang="EN-US">) </span></p>
<p class="a8"><span lang="EN-US">if($1 != English[ind] ) </span></p>
<p class="a8"><span lang="EN-US">print "Try again!" </span></p>
<p class="a8"><span lang="EN-US">else{ </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print 
"\nYou are right !! Press Enter to Continue --- " </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getline 
</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
question()#</span><span style="FONT-FAMILY: 宋体">产生考题</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">function question(){ </span></p>
<p class="a8"><span lang="EN-US">ind = int(rand()* n) + 1 #</span><span style="FONT-FAMILY: 宋体">以随机数选取考题</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">system("clear") </span></p>
<p class="a8"><span lang="EN-US">print " Press \"ctrl-d\" to exit" </span></p>
<p class="a8"><span lang="EN-US">printf("\n%s ", Chinese[ind] " </span><span style="FONT-FAMILY: 宋体">的英文生字是</span><span lang="EN-US">: ") </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">' $* </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行时键入如下指令</span><span lang="EN-US"> : </span></p>
<p class="a8"><span lang="EN-US">$./c2e test.dat </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">屏幕将产生如下的画面</span><span lang="EN-US">: </span></p>
<p class="a8"><span lang="EN-US">&nbsp;Press "ctrl-d " to exit </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span style="FONT-FAMILY: 宋体">莲雾</span> <span style="FONT-FAMILY: 宋体">的英文生字是</span><span lang="EN-US">: </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">若输入</span><span lang="EN-US"> 
bellfruit </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">程序将产生</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">You are right !! Press Enter to Continue --- 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US"> : ]</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">参数</span><span lang="EN-US"> 
test.dat (ARGV[1]) </span><span style="FONT-FAMILY: 宋体">表示储存考题的数据文件文件名</span><span lang="EN-US">. awk </span><span style="FONT-FAMILY: 宋体">由该文件上取得考题资料后</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">将</span><span lang="EN-US"> ARGV[1] </span><span style="FONT-FAMILY: 宋体">改成</span><span lang="EN-US"> "-". </span></p>
<p class="MsoNormal"><span lang="EN-US">"-" </span><span style="FONT-FAMILY: 宋体">表示由</span><span lang="EN-US"> stdin(</span><span style="FONT-FAMILY: 宋体">键盘输入</span><span lang="EN-US">) </span><span style="FONT-FAMILY: 宋体">数据</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">键盘输入数据的结束符号</span><span lang="EN-US"> (End of 
file)</span><span style="FONT-FAMILY: 宋体">是</span><span lang="EN-US"> ctrl-d. 
</span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">读到</span><span lang="EN-US"> ctrl-d </span><span style="FONT-FAMILY: 宋体">时就停止由</span><span lang="EN-US"> stdin </span><span style="FONT-FAMILY: 宋体">读取数据</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的数学函数中提供两个与随机数有关的函数</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">srand( ) :&nbsp; </span><span style="FONT-FAMILY: 宋体">以当前的系统时间作为随机数的种子</span></p>
<p class="MsoNormal"><span lang="EN-US">rand( ) : </span><span style="FONT-FAMILY: 宋体">返回介于</span><span lang="EN-US"> 0</span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US">1</span><span style="FONT-FAMILY: 宋体">之间的</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">近似</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">随机数值</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h1><span lang="EN-US">11.<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">使用</span><span lang="EN-US"> 
awk </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">编写递归程序</span><span lang="EN-US"> 
</span></h1>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">中除了函数的参数列</span><span lang="EN-US">(Argument 
List)</span><span style="FONT-FAMILY: 宋体">上的参数</span><span lang="EN-US">(Arguments)</span><span style="FONT-FAMILY: 宋体">外</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">所有变量不管于何处出现</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">全被视为全局变量</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">其生命持续至程序结束</span><span lang="EN-US"> --- </span><span style="FONT-FAMILY: 宋体">该变量不论在</span><span lang="EN-US">function</span><span style="FONT-FAMILY: 宋体">外或</span><span lang="EN-US"> function</span><span style="FONT-FAMILY: 宋体">内皆可使用</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">只要变量名称相同所使用的就是同一个变量</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">直到程序结束</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">因递归函数内部的变量</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">会因它调用子函数</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">本身</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">而重复使用</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">故编写该类函数时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">应特别留心</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : ]</span><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">awk ' </span></p>
<p class="a8"><span lang="EN-US">BEGIN { </span></p>
<p class="a8"><span lang="EN-US">x = 35 </span></p>
<p class="a8"><span lang="EN-US">y = 45 </span></p>
<p class="a8"><span lang="EN-US">test_variable( x ) </span></p>
<p class="a8"><span lang="EN-US">printf("Return to main : arg1= %d, x= %d, y= %d, z= 
%d\n", arg1, x, y, z) </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">function test_variable( arg1 ) </span></p>
<p class="a8"><span lang="EN-US">{ </span></p>
<p class="a8"><span lang="EN-US">arg1++ # arg1 </span><span style="FONT-FAMILY: 宋体">为参数列上的参数</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">是</span><span lang="EN-US">local variable. </span><span style="FONT-FAMILY: 宋体">离开此函数后将消失</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">y ++ # </span><span style="FONT-FAMILY: 宋体">会改变主式中的变量</span><span lang="EN-US"> y </span></p>
<p class="a8"><span lang="EN-US">z = 55 # z </span><span style="FONT-FAMILY: 宋体">为该函数中新使用的变量</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">主程序中变量</span><span lang="EN-US"> z </span><span style="FONT-FAMILY: 宋体">仍可被使用</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">printf("Inside the function: arg1=%d,x=%d, y=%d, 
z=%d\n", arg1, x, y, z) </span></p>
<p class="a8"><span lang="EN-US">} ' </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">结果屏幕印出</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">Inside the function: arg1=36,x=35, y=46, z=55 
</span></p>
<p class="a8"><span lang="EN-US">Return to main : arg1= 0, x= 35, y= 46, z= 55 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">由上可知</span><span lang="EN-US"> : 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">函数内可任意使用主程序中的任何变量</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">函数内所启用的任何变量</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">除参数外</span><span lang="EN-US">), 
</span><span style="FONT-FAMILY: 宋体">于该函数之外依然可以使用</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">此特性优劣参半</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">最大的坏处是式中的变量不易被保护</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">特别是递归调用本身</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">执行子函数时会破坏父函数内的变量</span><span lang="EN-US">.</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">一个变通的方法是</span><span lang="EN-US">: </span><span style="FONT-FAMILY: 宋体">在函数的参数列中虚列一些参数</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">函数执行中使用这些虚列的参数来记录不想被破坏的数据</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">如此执行子函数时就不会破坏到这些数据</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">此外</span><span lang="EN-US">awk 
</span><span style="FONT-FAMILY: 宋体">并不会检查调用函数时所传递的参数个数是否一致</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span><span style="FONT-FAMILY: 宋体">定义递归函数如下</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">function demo( arg1 ) { # </span><span style="FONT-FAMILY: 宋体">最常见的错误例子</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">........ </span></p>
<p class="a8"><span lang="EN-US">for(i=1; i&lt; 20 ; i++){ </span></p>
<p class="a8"><span lang="EN-US">demo(x) </span></p>
<p class="a8"><span lang="EN-US"># </span><span style="FONT-FAMILY: 宋体">又呼叫本身</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">因为</span><span lang="EN-US"> i </span><span style="FONT-FAMILY: 宋体">是</span><span lang="EN-US"> global variable, </span><span style="FONT-FAMILY: 宋体">故执行完该子函数后</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US"># </span><span style="FONT-FAMILY: 宋体">原函数中的</span><span lang="EN-US"> i </span><span style="FONT-FAMILY: 宋体">已经被坏</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">故本函数无法正确执行</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">....... </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">.......... </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">可将上列函数中的</span><span lang="EN-US"> i </span><span style="FONT-FAMILY: 宋体">虚列在该函数的参数列上</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">如此</span><span lang="EN-US"> i 
</span><span style="FONT-FAMILY: 宋体">便是一个局部变量</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">不会因执行子函数而被破坏</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">将上列函数修改如下</span><span lang="EN-US">: </span></p>
<p class="a8"><span lang="EN-US">function demo( arg1, i ) </span></p>
<p class="a8"><span lang="EN-US">{ </span></p>
<p class="a8"><span lang="EN-US">...... </span></p>
<p class="a8"><span lang="EN-US">for(i=1; i&lt; 20; i++) </span></p>
<p class="a8"><span lang="EN-US">{ </span></p>
<p class="a8"><span lang="EN-US">demo(x)#awk</span><span style="FONT-FAMILY: 宋体">不会检查呼叫函数时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">所传递的参数个数是否一致</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">..... </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="MsoNormal"><span lang="EN-US">$0, $1,.., NF, NR,..</span><span style="FONT-FAMILY: 宋体">也都是</span><span lang="EN-US"> global variable, 
</span><span style="FONT-FAMILY: 宋体">读者于递归函数中若有使用这些内建变量</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">也应另外设立一些局部变量来保存</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">以免被破坏</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> :]</span><span style="FONT-FAMILY: 宋体">以下是一个常见的递归调用范例</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">它要求使用者输入一串元素</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">各元素间用空白隔开</span><span lang="EN-US">) </span><span style="FONT-FAMILY: 宋体">然后印出这些元素所有可能的排列</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">编辑如下的</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">式</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">取名为</span><span lang="EN-US"> permu 
</span></p>
<p class="a8"><span lang="EN-US">#!/bin/sh </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span lang="EN-US">awk ' </span></p>
<p class="a8"><span lang="EN-US">BEGIN { </span></p>
<p class="a8"><span lang="EN-US">print "</span><span style="FONT-FAMILY: 宋体">请输入排列的元素</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">各元素间请用空白隔开</span><span lang="EN-US">" </span></p>
<p class="a8"><span lang="EN-US">getline </span></p>
<p class="a8"><span lang="EN-US">permutation($0, "") </span></p>
<p class="a8"><span lang="EN-US">printf("\n</span><span style="FONT-FAMILY: 宋体">共</span><span lang="EN-US"> %d </span><span style="FONT-FAMILY: 宋体">种排列方式</span><span lang="EN-US">\n", counter) </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">function permutation( main_lst, 
buffer,&nbsp;&nbsp;&nbsp;&nbsp; new_main_lst, nf, i, j ) </span></p>
<p class="a8"><span lang="EN-US">{ </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $0 = 
main_lst # </span><span style="FONT-FAMILY: 宋体">把</span><span lang="EN-US">main_lst</span><span style="FONT-FAMILY: 宋体">指定给</span><span lang="EN-US">$0</span><span style="FONT-FAMILY: 宋体">之后</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">将自动进行字段分割</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nf = NF 
# </span><span style="FONT-FAMILY: 宋体">故可用</span><span lang="EN-US"> NF 
</span><span style="FONT-FAMILY: 宋体">表示</span><span lang="EN-US"> main_lst 
</span><span style="FONT-FAMILY: 宋体">上存在的元素个数</span><span lang="EN-US">. 
</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # BASE 
CASE : </span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US">main_lst</span><span style="FONT-FAMILY: 宋体">只有一个元素时</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( nf 
== 1){ </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
print buffer main_lst #buffer</span><span style="FONT-FAMILY: 宋体">的内容再加上</span><span lang="EN-US">main_lst</span><span style="FONT-FAMILY: 宋体">就是完成一次排列的结果</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
counter++ </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
return </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } 
</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 
General Case : </span><span style="FONT-FAMILY: 宋体">每次从</span><span lang="EN-US"> 
main_lst </span><span style="FONT-FAMILY: 宋体">中取出一个元素放到</span><span lang="EN-US">buffer</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 
</span><span style="FONT-FAMILY: 宋体">再用</span><span lang="EN-US"> main_lst 
</span><span style="FONT-FAMILY: 宋体">中剩下的元素</span><span lang="EN-US"> 
(new_main_lst) </span><span style="FONT-FAMILY: 宋体">往下进行排列</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else 
for( i=1; i&lt;=nf ;i++) </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { 
</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
$0 = main_lst # $0</span><span style="FONT-FAMILY: 宋体">为全局变量已被破坏</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">故重新把</span><span lang="EN-US">main_lst</span><span style="FONT-FAMILY: 宋体">赋给</span><span lang="EN-US">$0,</span><span style="FONT-FAMILY: 宋体">令</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">再做一次字段分割</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
new_main_lst = "" </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
for(j=1; j&lt;=nf; j++) # </span><span style="FONT-FAMILY: 宋体">连接</span><span lang="EN-US"> new_main_lst </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
if( j != i ) new_main_lst = new_main_lst " " $j </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
permutation( new_main_lst, buffer " " $i ) </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } 
</span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">' $* </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">$ ./permu </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">屏幕上出现</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span style="FONT-FAMILY: 宋体">请输入排列的元素</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">各元素间请用空白隔开</span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">若输入</span><span lang="EN-US"> 1 2 
3 </span><span style="FONT-FAMILY: 宋体">回车</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">结果印出</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1 2 3 </span></p>
<p class="a8"><span lang="EN-US">&nbsp;1 3 2 </span></p>
<p class="a8"><span lang="EN-US">&nbsp;2 1 3 </span></p>
<p class="a8"><span lang="EN-US">&nbsp;2 3 1 </span></p>
<p class="a8"><span lang="EN-US">&nbsp;3 1 2 </span></p>
<p class="a8"><span lang="EN-US">&nbsp;3 2 1 </span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="a8"><span style="FONT-FAMILY: 宋体">共</span><span lang="EN-US"> 6 
</span><span style="FONT-FAMILY: 宋体">种排列方式</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US"> : ]</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">有些较旧版的</span><span lang="EN-US">awk,</span><span style="FONT-FAMILY: 宋体">并不容许使用者指定</span><span lang="EN-US">$0</span><span style="FONT-FAMILY: 宋体">之值</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">此时可改用</span><span lang="EN-US">gawk, 
</span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> nawk.</span><span style="FONT-FAMILY: 宋体">否则也可自行使用</span><span lang="EN-US"> split() </span><span style="FONT-FAMILY: 宋体">函数来分割</span><span lang="EN-US"> main_lst. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">为避免执行子函数时破坏</span><span lang="EN-US"> new_main_lst, nf, i, j </span><span style="FONT-FAMILY: 宋体">故把这些变量也列于参数列上</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">如此</span><span lang="EN-US">,new_main_lst, nf, i, j 
</span><span style="FONT-FAMILY: 宋体">将被当成局部变量</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">而不会受到子函数中同名的变量影响</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">读者声明函数时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">参数列上不妨将这些</span><span lang="EN-US"> "</span><span style="FONT-FAMILY: 宋体">虚列的参数</span><span lang="EN-US">" 
</span><span style="FONT-FAMILY: 宋体">与真正用于传递信息的参数间以较长的空白隔开</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">以便于区别</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">中欲将字符串</span><span lang="EN-US">concatenation(</span><span style="FONT-FAMILY: 宋体">连接</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">直接将两字符串并置即可</span><span lang="EN-US">(Implicit Operator). 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">awk ' </span></p>
<p class="a8"><span lang="EN-US">BEGIN{ </span></p>
<p class="a8"><span lang="EN-US">A = "This " </span></p>
<p class="a8"><span lang="EN-US">B = "is a " </span></p>
<p class="a8"><span lang="EN-US">C = A B "key." # </span><span style="FONT-FAMILY: 宋体">变量</span><span lang="EN-US">A</span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US">B</span><span style="FONT-FAMILY: 宋体">之间应留空白</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">否则</span><span lang="EN-US">"AB"</span><span style="FONT-FAMILY: 宋体">将代表另一新变量</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">print C </span></p>
<p class="a8"><span lang="EN-US">} '</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">结果将印出</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">This is a key. </span></p>
<p class="MsoNormal"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">使用者所编写的函数可再重用</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并不需要每个</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">式中都重新编写</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">将函数部分单独编写于一文件中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">当需要用到该函数时再以下列方式</span><span lang="EN-US">include</span><span style="FONT-FAMILY: 宋体">进来</span><span lang="EN-US">. </span></p>
<p class="a8"><span lang="EN-US">$ awk -f </span><span style="FONT-FAMILY: 宋体">函数文件名</span><span lang="EN-US"> -f awk</span><span style="FONT-FAMILY: 宋体">主程序文件名</span> <span style="FONT-FAMILY: 宋体">数据文件文件名</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h1><span lang="EN-US">12.<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">附录</span><span lang="EN-US"> 
A ──&nbsp; Pattern</span></h1>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">通过判断</span><span lang="EN-US"> Pattern </span><span style="FONT-FAMILY: 宋体">之值来决定是否执行其后所对应的</span><span lang="EN-US">Actions.</span><span style="FONT-FAMILY: 宋体">这里列出几种常见的</span><span lang="EN-US">Pattern : </span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">BEGIN </span></h2>
<p class="MsoNormal"><span lang="EN-US">BEGIN </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">的保留字</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">是一种特殊的</span><span lang="EN-US"> Pattern. </span></p>
<p class="MsoNormal"><span lang="EN-US">BEGIN </span><span style="FONT-FAMILY: 宋体">成立</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">其值为</span><span lang="EN-US">true)</span><span style="FONT-FAMILY: 宋体">的时机是</span><span lang="EN-US">: "awk </span><span style="FONT-FAMILY: 宋体">程序一开始执行</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">尚未读取任何数据之前</span><span lang="EN-US">." </span><span style="FONT-FAMILY: 宋体">所以在</span><span lang="EN-US"> BEGIN { Actions } 
</span><span style="FONT-FAMILY: 宋体">语法中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">其</span><span lang="EN-US"> Actions </span><span style="FONT-FAMILY: 宋体">部份仅于程序一开始执行时被执行一次</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">从数据文件读入数据行后</span><span lang="EN-US">, BEGIN </span><span style="FONT-FAMILY: 宋体">便不再成立</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">故不论有多少数据行</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">该</span><span lang="EN-US"> Actions </span><span style="FONT-FAMILY: 宋体">部份仅被执行</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">一次</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">一般常把</span><span lang="EN-US"> 
"</span><span style="FONT-FAMILY: 宋体">与数据文件内容无关</span><span lang="EN-US">" 
</span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> "</span><span style="FONT-FAMILY: 宋体">只需执行ㄧ次</span><span lang="EN-US">" </span><span style="FONT-FAMILY: 宋体">的部分置于该</span><span lang="EN-US">Actions(</span><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US"> BEGIN </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> Pattern)</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
</span></p>
<p class="a8"><span lang="EN-US">BEGIN { </span></p>
<p class="a8"><span lang="EN-US">FS = "[ \t:]" # </span><span style="FONT-FAMILY: 宋体">于程序一开始时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">改变</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">切割字段的方式</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">RS = "" # </span><span style="FONT-FAMILY: 宋体">于程序一开始时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">改变</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">分隔数据行的方式</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">count = 100 # </span><span style="FONT-FAMILY: 宋体">设定变量</span><span lang="EN-US"> count </span><span style="FONT-FAMILY: 宋体">的起始值</span><span lang="EN-US"> </span></p>
<p class="a8"><span lang="EN-US">print " This is a title line " # </span><span style="FONT-FAMILY: 宋体">印出一行</span><span lang="EN-US"> title </span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">....... # </span><span style="FONT-FAMILY: 宋体">其它</span><span lang="EN-US"> Pattern { Actions } ..... 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">有些</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序甚至</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">不需要读入任何数据行</span><span lang="EN-US">". </span><span style="FONT-FAMILY: 宋体">遇到这情况可把整个程序置于以</span><span lang="EN-US"> BEGIN </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> 
Pattern</span><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US"> Actions 
</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">BEGIN { print " Hello ! the Word ! " } </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">注意</span><span lang="EN-US"> 
:</span><span style="FONT-FAMILY: 宋体">执行该类仅含</span><span lang="EN-US"> BEGIN { 
Actions } </span><span style="FONT-FAMILY: 宋体">的程序时</span><span lang="EN-US">, awk 
</span><span style="FONT-FAMILY: 宋体">并不会开启任何数据文件进行处理</span><span lang="EN-US">.</span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">END 
</span></h2>
<p class="MsoNormal"><span lang="EN-US">END </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">的保留字</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">是另一种特殊的</span><span lang="EN-US"> Pattern. </span></p>
<p class="MsoNormal"><span lang="EN-US">END </span><span style="FONT-FAMILY: 宋体">成立</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">其值为</span><span lang="EN-US">true)</span><span style="FONT-FAMILY: 宋体">的时机与</span><span lang="EN-US"> BEGIN </span><span style="FONT-FAMILY: 宋体">恰好相反</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">:"awk </span><span style="FONT-FAMILY: 宋体">处理完所有数据</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">即将离开程序时</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">平常读入数据行时</span><span lang="EN-US">, END</span><span style="FONT-FAMILY: 宋体">并不成立</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">故其对应的</span><span lang="EN-US"> Actions </span><span style="FONT-FAMILY: 宋体">并不被执行</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">唯有当</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">读完所有数据时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">该</span><span lang="EN-US"> Actions </span><span style="FONT-FAMILY: 宋体">才会被执行</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">注意</span><span lang="EN-US"> : 
</span><span style="FONT-FAMILY: 宋体">不管数据行有多少笔</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">该</span><span lang="EN-US"> Actions 
</span><span style="FONT-FAMILY: 宋体">仅被执行一次</span><span lang="EN-US">. </span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">关系表达式</span><span lang="EN-US"> </span></h2>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">使用像</span><span lang="EN-US"> " A 
</span><span style="FONT-FAMILY: 宋体">关系运算符</span><span lang="EN-US"> B" 
</span><span style="FONT-FAMILY: 宋体">的表达式当成</span><span lang="EN-US"> Pattern. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> A 
</span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> B </span><span style="FONT-FAMILY: 宋体">存在所指定的关系</span><span lang="EN-US">(Relation)</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">该</span><span lang="EN-US"> Pattern </span><span style="FONT-FAMILY: 宋体">就算成立</span><span lang="EN-US">(true). </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">length($0) &lt;= 80 { print $0 } </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">上式中</span><span lang="EN-US"> 
length($0)&lt;= 80 </span><span style="FONT-FAMILY: 宋体">是一个</span><span lang="EN-US"> Pattern, </span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> $0(</span><span style="FONT-FAMILY: 宋体">数据行</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">之长度小于等于</span><span lang="EN-US">80</span><span style="FONT-FAMILY: 宋体">时该</span><span lang="EN-US"> 
Pattern </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US">true, 
</span><span style="FONT-FAMILY: 宋体">将执行其后的</span><span lang="EN-US"> Action 
(</span><span style="FONT-FAMILY: 宋体">打印该数据行</span><span lang="EN-US">). 
</span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">中提供下列</span> <span style="FONT-FAMILY: 宋体">关系运算符</span><span lang="EN-US">(Relation Operator) 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">运算符</span> <span style="FONT-FAMILY: 宋体">含意</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">&gt; </span><span style="FONT-FAMILY: 宋体">大于</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">&lt; </span><span style="FONT-FAMILY: 宋体">小于</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">&gt;= </span><span style="FONT-FAMILY: 宋体">大于或等于</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">&lt;= </span><span style="FONT-FAMILY: 宋体">小于或等于</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">== </span><span style="FONT-FAMILY: 宋体">等于</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">!= </span><span style="FONT-FAMILY: 宋体">不等于</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span lang="EN-US">~ match </span></p>
<p class="MsoNormal"><span lang="EN-US">!~ not match </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">上列关系运算符除</span><span lang="EN-US">~(match)</span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US">!~(not match)</span><span style="FONT-FAMILY: 宋体">外与</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言中之含意一致</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">~(match) </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US">!~(match) </span><span style="FONT-FAMILY: 宋体">在</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">之含意简述如下</span><span lang="EN-US"> : </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">若</span><span lang="EN-US"> A 
</span><span style="FONT-FAMILY: 宋体">为一字符串</span><span lang="EN-US">, B 
</span><span style="FONT-FAMILY: 宋体">为一正则表达式</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span lang="EN-US">A ~B </span><span style="FONT-FAMILY: 宋体">判断</span> <span style="FONT-FAMILY: 宋体">字符串</span><span lang="EN-US">A </span><span style="FONT-FAMILY: 宋体">中是否</span> <span style="FONT-FAMILY: 宋体">包含</span> <span style="FONT-FAMILY: 宋体">能匹配</span><span lang="EN-US">(match)B</span><span style="FONT-FAMILY: 宋体">式样的子字符串</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">A !~B </span><span style="FONT-FAMILY: 宋体">判断</span> <span style="FONT-FAMILY: 宋体">字符串</span><span lang="EN-US">A </span><span style="FONT-FAMILY: 宋体">中是否</span> <span style="FONT-FAMILY: 宋体">未包含</span> <span style="FONT-FAMILY: 宋体">能匹配</span><span lang="EN-US">(match)B</span><span style="FONT-FAMILY: 宋体">式样的子字符串</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">$0 ~ /program[0-9]+\.c/ { print $0 } </span></p>
<p class="MsoNormal"><span lang="EN-US">$0 ~ /program[0-9]+\.c/ </span><span style="FONT-FAMILY: 宋体">整个是一个</span><span lang="EN-US"> Pattern, </span><span style="FONT-FAMILY: 宋体">用来判断</span><span lang="EN-US">$0(</span><span style="FONT-FAMILY: 宋体">数据行</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">中是否含有可</span><span lang="EN-US"> match /program[0-9]+\.c/ 
</span><span style="FONT-FAMILY: 宋体">的子字符串</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若</span><span lang="EN-US">$0 </span><span style="FONT-FAMILY: 宋体">中含有该类字符串</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">则执行</span><span lang="EN-US"> print (</span><span style="FONT-FAMILY: 宋体">打印该行数据</span><span lang="EN-US">). </span></p>
<p class="MsoNormal"><span lang="EN-US">Pattern </span><span style="FONT-FAMILY: 宋体">中被用来比对的字符串为</span><span lang="EN-US">$0 </span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">如本例</span><span lang="EN-US">), </span><span style="FONT-FAMILY: 宋体">可仅以正则表达式部分表示整个</span><span lang="EN-US">Pattern. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">故本例的</span><span lang="EN-US"> 
Pattern </span><span style="FONT-FAMILY: 宋体">部分</span><span lang="EN-US">$0 
~/program[0-9]+\.c/ </span><span style="FONT-FAMILY: 宋体">可仅用</span><span lang="EN-US">/program[0-9]+\.c/</span><span style="FONT-FAMILY: 宋体">表之</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">有关匹配及正则表达式请参考</span> <span style="FONT-FAMILY: 宋体">附录</span><span lang="EN-US"> E ) </span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">正则表达式</span></h2>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">直接使用正则表达式当成</span><span lang="EN-US"> Pattern; </span><span style="FONT-FAMILY: 宋体">此为</span><span lang="EN-US"> $0 ~ </span><span style="FONT-FAMILY: 宋体">正则表达式</span> <span style="FONT-FAMILY: 宋体">的简写</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">该</span><span lang="EN-US"> 
Pattern </span><span style="FONT-FAMILY: 宋体">用以判断</span><span lang="EN-US"> 
$0(</span><span style="FONT-FAMILY: 宋体">数据行</span><span lang="EN-US">) 
</span><span style="FONT-FAMILY: 宋体">中是否含有匹配该正则表达式的子字符串</span><span lang="EN-US">; 
</span><span style="FONT-FAMILY: 宋体">若含有该成立</span><span lang="EN-US">(true) 
</span><span style="FONT-FAMILY: 宋体">则执行其对应的</span><span lang="EN-US"> Actions. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">/^[0-9]*$/ { print "This line is a integer !" 
}</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> $0 
~/^[0-9]*$/ { print "This line is a integer !" } </span><span style="FONT-FAMILY: 宋体">相同</span><span lang="EN-US"> </span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">混合</span><span lang="EN-US"> Pattern </span></h2>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">之前所介绍的各种</span><span lang="EN-US"> Patterns, </span><span style="FONT-FAMILY: 宋体">其计算后结果为一逻辑值</span><span lang="EN-US">(True or False).awk 
</span><span style="FONT-FAMILY: 宋体">中逻辑值彼此间可通过</span><span lang="EN-US">&amp;&amp;(and), ||(or),&nbsp; !(not) </span><span style="FONT-FAMILY: 宋体">结合成一个新的逻辑值</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">故不同</span><span lang="EN-US"> Patterns </span><span style="FONT-FAMILY: 宋体">彼此可通过上述结合符号来结合成一个新的</span><span lang="EN-US"> Pattern. 
</span><span style="FONT-FAMILY: 宋体">如此可进行复杂的条件判断</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例</span> <span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US"> : </span></p>
<p class="a8"><span lang="EN-US">FNR &gt;= 23 &amp;&amp; FNR &lt;= 28 { print 
"&nbsp;&nbsp;&nbsp;&nbsp; " $0 } </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">上式利用</span><span lang="EN-US">&amp;&amp; (and) </span><span style="FONT-FAMILY: 宋体">将两个</span><span lang="EN-US"> Pattern </span><span style="FONT-FAMILY: 宋体">求值的结果合并成一个逻辑值</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">该式将数据文件中</span> <span style="FONT-FAMILY: 宋体">第</span><span lang="EN-US">23</span><span style="FONT-FAMILY: 宋体">行</span> <span style="FONT-FAMILY: 宋体">到</span><span lang="EN-US"> 28</span><span style="FONT-FAMILY: 宋体">行</span> <span style="FONT-FAMILY: 宋体">向右移</span><span lang="EN-US">5</span><span style="FONT-FAMILY: 宋体">格</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">先输出</span><span lang="EN-US">5</span><span style="FONT-FAMILY: 宋体">个空白字符</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">后输出</span><span lang="EN-US">. </span></p>
<p class="MsoNormal"><span lang="EN-US">( FNR </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的内建变量</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">请参考</span> <span style="FONT-FAMILY: 宋体">附录</span><span lang="EN-US"> D ) </span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">Pattern1 , Pattern2 </span></h2>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">遇到这种</span><span lang="EN-US"> 
Pattern, awk </span><span style="FONT-FAMILY: 宋体">会帮您设立一个</span><span lang="EN-US"> switch(</span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US">flag). </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">读入的数据行使得</span><span lang="EN-US"> Pattern1 </span><span style="FONT-FAMILY: 宋体">成立时</span><span lang="EN-US">, awk </span><span style="FONT-FAMILY: 宋体">会打开</span><span lang="EN-US">(turn on)</span><span style="FONT-FAMILY: 宋体">这</span><span lang="EN-US"> switch. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">读入的数据行使得</span><span lang="EN-US"> Pattern2 </span><span style="FONT-FAMILY: 宋体">成立时</span><span lang="EN-US">, awk </span><span style="FONT-FAMILY: 宋体">会关上</span><span lang="EN-US">(turn off)</span><span style="FONT-FAMILY: 宋体">这个</span><span lang="EN-US"> switch. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">该</span><span lang="EN-US"> 
Pattern </span><span style="FONT-FAMILY: 宋体">成立的条件是</span><span lang="EN-US"> : 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">当这个</span><span lang="EN-US"> 
switch </span><span style="FONT-FAMILY: 宋体">被打开</span><span lang="EN-US">(turn 
on)</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US"> (</span><span style="FONT-FAMILY: 宋体">包括</span><span lang="EN-US"> Pattern1, </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> Pattern2 </span><span style="FONT-FAMILY: 宋体">成立的情况</span><span lang="EN-US">)</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">例</span> <span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US"> : </span></p>
<p class="a8"><span lang="EN-US">FNR &gt;= 23 &amp;&amp; FNR &lt;= 28 { print 
"&nbsp;&nbsp;&nbsp;&nbsp; " $0 }</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">可改写为</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">FNR == 23 , FNR == 28 { print 
"&nbsp;&nbsp;&nbsp;&nbsp; " $0 } </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US"> : </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> FNR 
&gt;= 23 </span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, awk 
</span><span style="FONT-FAMILY: 宋体">就</span><span lang="EN-US"> turn on 
</span><span style="FONT-FAMILY: 宋体">这个</span><span lang="EN-US"> switch; 
</span><span style="FONT-FAMILY: 宋体">因为随着数据行的读入</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">不停的累加</span><span lang="EN-US"> FNR. 
</span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> FNR = 28 
</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, Pattern2 (FNR == 
28) </span><span style="FONT-FAMILY: 宋体">便成立</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">这时</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">会关上这个</span><span lang="EN-US"> switch. </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> 
switch </span><span style="FONT-FAMILY: 宋体">打开的期间</span><span lang="EN-US">, awk 
</span><span style="FONT-FAMILY: 宋体">会执行</span><span lang="EN-US">&nbsp; print 
"&nbsp;&nbsp;&nbsp;&nbsp; " $0</span></p>
<p class="MsoNormal"><span lang="EN-US">( FNR </span><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">的内建变量</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">请参考</span> <span style="FONT-FAMILY: 宋体">附录</span><span lang="EN-US"> D ) </span></p>
<p class="MsoNormal"><span lang="EN-US"></span>&nbsp;</p>
<h1><span lang="EN-US">13.<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">附录</span><span lang="EN-US"> 
B ── Actions </span></h1>
<p class="MsoNormal"><span lang="EN-US">Actions </span><span style="FONT-FAMILY: 宋体">是由下列指令</span><span lang="EN-US">(statement)</span><span style="FONT-FAMILY: 宋体">所组成</span><span lang="EN-US"> : </span></p>
<ul style="MARGIN-TOP: 0cm" type="disc">
  <li class="MsoNormal"><span style="FONT-FAMILY: 宋体">表达式</span><span lang="EN-US"> 
  ( function calls, assignments..) </span>
  </li><li class="MsoNormal"><span lang="EN-US">print </span><span style="FONT-FAMILY: 宋体">表达式列表</span><span lang="EN-US"> </span>
  </li><li class="MsoNormal"><span lang="EN-US">printf( </span><span style="FONT-FAMILY: 宋体">格式化字符串</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">表达式列表</span><span lang="EN-US">) </span>
  </li><li class="MsoNormal"><span lang="EN-US">if( </span><span style="FONT-FAMILY: 宋体">表达式</span><span lang="EN-US"> ) </span><span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US"> [else </span><span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US">] </span>
  </li><li class="MsoNormal"><span lang="EN-US">while( </span><span style="FONT-FAMILY: 宋体">表达式</span><span lang="EN-US"> ) </span><span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US"> </span>
  </li><li class="MsoNormal"><span lang="EN-US">do </span><span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US"> while( </span><span style="FONT-FAMILY: 宋体">表达式</span><span lang="EN-US">) </span>
  </li><li class="MsoNormal"><span lang="EN-US">for( </span><span style="FONT-FAMILY: 宋体">表达式</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">表达式</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">表达式</span><span lang="EN-US">) </span><span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US"> </span>
  </li><li class="MsoNormal"><span lang="EN-US">for( variable in array) </span><span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US"> </span>
  </li><li class="MsoNormal"><span lang="EN-US">delete </span>
  </li><li class="MsoNormal"><span lang="EN-US">break </span>
  </li><li class="MsoNormal"><span lang="EN-US">continue </span>
  </li><li class="MsoNormal"><span lang="EN-US">next </span>
  </li><li class="MsoNormal"><span lang="EN-US">exit [</span><span style="FONT-FAMILY: 宋体">表达式</span><span lang="EN-US">] </span>
  </li><li class="MsoNormal"><span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US"> 
  </span></li></ul>
<p class="MsoNormal"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">中大部分指令与</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言中的用法一致</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">此处仅介绍较为常用或容易混淆的指令的用法</span><span lang="EN-US">. 
</span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">流程控制指令</span><span lang="EN-US"> </span></h2>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">if </span></b><b><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US"> </span></b></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">语法</span><span lang="EN-US"> 
</span></p>
<p class="MsoNormal"><span lang="EN-US">if (</span><span style="FONT-FAMILY: 宋体">表达式</span><span lang="EN-US">) </span><span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US">1 [else </span><span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US">2 ] </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">if( $1 &gt; 25 ) </span></p>
<p class="a8"><span lang="EN-US">print "The 1st field is larger than 25" </span></p>
<p class="a8"><span lang="EN-US">else print "The 1st field is not larger than 25" 
</span></p>
<p class="MsoNormal"><span lang="EN-US">(a)</span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言中相同</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若</span> <span style="FONT-FAMILY: 宋体">表达式</span> <span style="FONT-FAMILY: 宋体">计算</span><span lang="EN-US">(evaluate)</span><span style="FONT-FAMILY: 宋体">后之值不为</span><span lang="EN-US"> 0 </span><span style="FONT-FAMILY: 宋体">或空字符串</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">则执行</span> <span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US">1; </span><span style="FONT-FAMILY: 宋体">否则执行</span> <span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US">2. </span></p>
<p class="MsoNormal"><span lang="EN-US">(b)</span><span style="FONT-FAMILY: 宋体">进行逻辑判断的表达式所返回的值有两种</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若最后的逻辑值为</span><span lang="EN-US">true, </span><span style="FONT-FAMILY: 宋体">则返回</span><span lang="EN-US">1, </span><span style="FONT-FAMILY: 宋体">否则返回</span><span lang="EN-US">0. </span></p>
<p class="MsoNormal"><span lang="EN-US">(c)</span><span style="FONT-FAMILY: 宋体">语法中</span><span lang="EN-US">else </span><span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US">2 </span><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US">[ ] </span><span style="FONT-FAMILY: 宋体">前后括住表示该部分可视需要而予加入或省略</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">while </span></b><b><span style="FONT-FAMILY: 宋体">指令</span></b><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">语法</span><span lang="EN-US"> : 
</span></p>
<p class="MsoNormal"><span lang="EN-US">while( </span><span style="FONT-FAMILY: 宋体">表达式</span><span lang="EN-US"> ) </span><span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US"> </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">while( match(buffer,/[0-9]+\.c/ ) ){ </span></p>
<p class="a8"><span lang="EN-US">print "Find :" substr( buffer,RSTART, RLENGTH) 
</span></p>
<p class="a8"><span lang="EN-US">buff = substr( buffer, RSTART + RLENGTH) 
</span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">上列范例找出</span><span lang="EN-US"> 
buffer </span><span style="FONT-FAMILY: 宋体">中所有能匹配</span><span lang="EN-US"> 
/[0-9]+.c/(</span><span style="FONT-FAMILY: 宋体">数字之后接上</span><span lang="EN-US"> 
".c"</span><span style="FONT-FAMILY: 宋体">的所有子字符串</span><span lang="EN-US">). 
</span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">范例中</span><span lang="EN-US"> 
while </span><span style="FONT-FAMILY: 宋体">以函数</span><span lang="EN-US"> match( 
)</span><span style="FONT-FAMILY: 宋体">所返回的值做为判断条件</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">若</span><span lang="EN-US">buffer 
</span><span style="FONT-FAMILY: 宋体">中还含有匹配指定条件的子字符串</span><span lang="EN-US">(match</span><span style="FONT-FAMILY: 宋体">成功</span><span lang="EN-US">), </span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US"> 
match()</span><span style="FONT-FAMILY: 宋体">函数返回</span><span lang="EN-US">1,while 
</span><span style="FONT-FAMILY: 宋体">将持续进行其后的语句</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">do-while </span></b><b><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US"> </span></b></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">语法</span><span lang="EN-US"> : 
</span></p>
<p class="MsoNormal"><span lang="EN-US">do </span><span style="FONT-FAMILY: 宋体">语句</span><span lang="EN-US"> while(</span><span style="FONT-FAMILY: 宋体">表达式</span><span lang="EN-US">) </span></p>
<p class="MsoNormal"><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">do{ </span></p>
<p class="a8"><span lang="EN-US">print "Enter y or n ! " </span></p>
<p class="a8"><span lang="EN-US">getline data</span></p>
<p class="a8"><span lang="EN-US">} while( data !~ /^[YyNn]$/)</span></p>
<p class="a8"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoBodyText"><span lang="EN-US">(a) </span><span style="FONT-FAMILY: 宋体">上例要求用户从键盘上输入一个字符</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若该字符不是</span><span lang="EN-US">Y, y, N, </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> n</span><span style="FONT-FAMILY: 宋体">则会不停执行该循环</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">直到读取正确字符为止</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">(b)do-while </span><span style="FONT-FAMILY: 宋体">指令与</span><span lang="EN-US"> while </span><span style="FONT-FAMILY: 宋体">指令</span> <span style="FONT-FAMILY: 宋体">最大的差异是</span><span lang="EN-US"> : do-while </span><span style="FONT-FAMILY: 宋体">指令会先执行</span><span lang="EN-US">statement</span><span style="FONT-FAMILY: 宋体">而后再判断是否应继续执行</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">所以</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">无论如何其</span><span lang="EN-US"> statement </span><span style="FONT-FAMILY: 宋体">部分至少会执行一次</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">for Statement </span></b><b><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">(</span></b><b><span style="FONT-FAMILY: 宋体">一</span><span lang="EN-US">) </span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">语法</span><span lang="EN-US"> 
:</span></p>
<p class="MsoBodyText"><span lang="EN-US">for(variable in&nbsp; array ) 
statement</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> : 
</span><span style="FONT-FAMILY: 宋体">执行下列命令</span></p>
<p class="a8"><span lang="EN-US">awk '</span></p>
<p class="a8"><span lang="EN-US">BEGIN{</span></p>
<p class="a8"><span lang="EN-US">X[1]= 50; X[2]= 60; X["last"]= 70</span></p>
<p class="a8"><span lang="EN-US">for( any in X )</span></p>
<p class="a8"><span lang="EN-US">printf("X[%s] = %d\n", any, X[any] )</span></p>
<p class="a8"><span lang="EN-US">}'</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">结果输出</span><span lang="EN-US"> 
:</span></p>
<p class="a8"><span lang="EN-US">X[last] = 70 </span></p>
<p class="a8"><span lang="EN-US">X[1] = 50 </span></p>
<p class="a8"><span lang="EN-US">X[2] = 60 </span></p>
<p class="MsoBodyText"><span lang="EN-US">(a)</span><span style="FONT-FAMILY: 宋体">这个</span><span lang="EN-US"> for </span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">专用以查找数组中所有的下标值</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并依次使用所指定的变量予以记录</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">以本例而言</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">变量</span><span lang="EN-US"> any </span><span style="FONT-FAMILY: 宋体">将逐次代表</span><span lang="EN-US"> "last", 1 </span><span style="FONT-FAMILY: 宋体">及</span><span lang="EN-US">2 .</span></p>
<p class="MsoBodyText"><span lang="EN-US">(b)</span><span style="FONT-FAMILY: 宋体">以这个</span><span lang="EN-US"> for </span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">所查找出的下标之值彼此间并无任何次续关系</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">(c)</span><span style="FONT-FAMILY: 宋体">第</span><span lang="EN-US">5</span><span style="FONT-FAMILY: 宋体">节中有该指令的使用范例</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">及解说</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">for Statement </span></b><b><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">(</span></b><b><span style="FONT-FAMILY: 宋体">二</span><span lang="EN-US">)</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">语法</span><span lang="EN-US"> 
:</span></p>
<p class="MsoBodyText"><span lang="EN-US">for(expression1; expression2; expression3) 
statement&nbsp; </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> 
:</span></p>
<p class="a8"><span lang="EN-US">for(</span><span style="FONT-FAMILY: 宋体">ｉ</span><span lang="EN-US">=1; i&lt; =10; i++)&nbsp; sum = 
sum + i</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">说明</span><span lang="EN-US"> 
:</span></p>
<p class="MsoBodyText"><span lang="EN-US">(a)</span><span style="FONT-FAMILY: 宋体">上列范例用以计算</span><span lang="EN-US"> 1 </span><span style="FONT-FAMILY: 宋体">加到</span><span lang="EN-US"> 10 </span><span style="FONT-FAMILY: 宋体">的总和</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">(b)expression1&nbsp; </span><span style="FONT-FAMILY: 宋体">常用于设定该</span><span lang="EN-US"> for </span><span style="FONT-FAMILY: 宋体">循环的起始条件</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">如上例中的</span><span lang="EN-US"> i=1</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp; expression2 </span><span style="FONT-FAMILY: 宋体">用于设定该循环的停止条件</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">如上例中的</span><span lang="EN-US"> i &lt;= 10</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp; expression3 </span><span style="FONT-FAMILY: 宋体">常用于改变</span><span lang="EN-US"> counter </span><span style="FONT-FAMILY: 宋体">之值</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">如上例中的</span><span lang="EN-US"> i++</span></p>
<p class="MsoBodyText"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">break </span></b><b><span style="FONT-FAMILY: 宋体">指令</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">break </span><span style="FONT-FAMILY: 宋体">指令用以强迫中断</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">跳离</span><span lang="EN-US">) for, while, do-while 
</span><span style="FONT-FAMILY: 宋体">等循环</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> 
:</span></p>
<p class="a8"><span lang="EN-US">while(&nbsp; getline &lt; "datafile" &gt; 0 
)</span></p>
<p class="a8"><span lang="EN-US">{</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; if( $1 == 0 )</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
break</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; else</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print $2 
/ $1</span></p>
<p class="a8"><span lang="EN-US">}</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">上例中</span><span lang="EN-US">, 
awk </span><span style="FONT-FAMILY: 宋体">不断地从文件</span><span lang="EN-US"> datafile 
</span><span style="FONT-FAMILY: 宋体">中读取资料</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US">$1</span><span style="FONT-FAMILY: 宋体">等于</span><span lang="EN-US">0</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">就停止该执行循环</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">continue </span></b><b><span style="FONT-FAMILY: 宋体">指令</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">循环中的</span><span lang="EN-US"> 
statement </span><span style="FONT-FAMILY: 宋体">进行到一半时</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US"> continue 
</span><span style="FONT-FAMILY: 宋体">指令来略过循环中尚未执行的</span><span lang="EN-US">statement.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> 
:</span></p>
<p class="a8"><span lang="EN-US">for( index in X_array)</span></p>
<p class="a8"><span lang="EN-US">{</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; if( index !~ /[0-9]+/ )&nbsp; 
continue</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; print "There is a digital 
index", index</span></p>
<p class="a8"><span lang="EN-US">}</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">上例中若</span><span lang="EN-US"> 
index </span><span style="FONT-FAMILY: 宋体">不为数字则执行</span><span lang="EN-US"> 
continue, </span><span style="FONT-FAMILY: 宋体">故将略过</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">不执行</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">其后的指令</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">需留心</span><span lang="EN-US"> 
continue </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> break 
</span><span style="FONT-FAMILY: 宋体">的差异</span><span lang="EN-US"> : </span><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US"> continue </span><span style="FONT-FAMILY: 宋体">只是掠过其后未执行的</span><span lang="EN-US">statement, 
</span><span style="FONT-FAMILY: 宋体">但并未跳离开该循环</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">next </span></b><b><span style="FONT-FAMILY: 宋体">指令</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US"> 
next </span><span style="FONT-FAMILY: 宋体">指令时</span><span lang="EN-US">, awk 
</span><span style="FONT-FAMILY: 宋体">将掠过位于该指令</span><span lang="EN-US">(next)</span><span style="FONT-FAMILY: 宋体">之后的所有指令</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">包括其后的所有</span><span lang="EN-US">Pattern { Actions }), </span><span style="FONT-FAMILY: 宋体">接著读取下一笔数据行</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">继续从第一个</span><span lang="EN-US"> Pattern {Actions} 
</span><span style="FONT-FAMILY: 宋体">执行起</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">范例</span><span lang="EN-US"> 
:</span></p>
<p class="a8"><span lang="EN-US">/^[ \t]*$/&nbsp; {&nbsp; print "This is a blank 
line! Do nothing here !"</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; next</span></p>
<p class="a8"><span lang="EN-US">}</span></p>
<p class="a8"><span lang="EN-US">$2 != 0 { print $1, $1/$2 }</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">上例中</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">读入的数据行为空白行时</span><span lang="EN-US">( match /^[ \]*$/ 
),</span><span style="FONT-FAMILY: 宋体">除打印消息外只执行</span><span lang="EN-US"> next, 
</span><span style="FONT-FAMILY: 宋体">故</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">将略过其后的指令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">继续读取下一笔资料</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">从头</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">第一个</span><span lang="EN-US"> Pattern { Actions 
})</span><span style="FONT-FAMILY: 宋体">执行起</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">exit </span></b><b><span style="FONT-FAMILY: 宋体">指令</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">执行</span><span lang="EN-US"> 
exit </span><span style="FONT-FAMILY: 宋体">指令时</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">将立刻跳离</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">停止执行</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">该</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程序</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US"></span>&nbsp;</p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">awk 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">中的</span> <span lang="EN-US">I/O 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">指令</span><span lang="EN-US"> 
</span></h2>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">printf </span></b><b><span style="FONT-FAMILY: 宋体">指令</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">该指令与</span><span lang="EN-US"> 
C </span><span style="FONT-FAMILY: 宋体">语言中的用法相同</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">可借由该指令控制资料输出时的格式</span><span lang="EN-US">. 
</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">语法</span><span lang="EN-US"> : 
</span></p>
<p class="MsoBodyText"><span lang="EN-US">printf("format", item1, item2,.. 
)</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">范</span> <span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US"> :</span></p>
<p class="a8"><span lang="EN-US">id = "BE-2647";&nbsp; ave = 89</span></p>
<p class="a8"><span lang="EN-US">printf("ID# : %s&nbsp;&nbsp; Ave Score : %d\n", id, 
ave) </span></p>
<p class="MsoBodyText"><span lang="EN-US">(a)</span><span style="FONT-FAMILY: 宋体">结果印出</span><span lang="EN-US"> :</span></p>
<p class="a8"><span lang="EN-US">ID# : BE-2647&nbsp;&nbsp; Ave Score : 89</span></p>
<p class="MsoBodyText"><span lang="EN-US">(b)format </span><span style="FONT-FAMILY: 宋体">部分是由</span> <span style="FONT-FAMILY: 宋体">一般的字串</span><span lang="EN-US">(String Constant) 
</span><span style="FONT-FAMILY: 宋体">及</span> <span style="FONT-FAMILY: 宋体">格式控制字符</span><span lang="EN-US">(Formatcontrol letter, 
</span><span style="FONT-FAMILY: 宋体">其前会加上一个</span><span lang="EN-US">%</span><span style="FONT-FAMILY: 宋体">字符</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">所构成</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">以上式为例</span><span lang="EN-US">"ID# : " 
</span><span style="FONT-FAMILY: 宋体">及</span><span lang="EN-US"> "&nbsp; Ave Score 
: " </span><span style="FONT-FAMILY: 宋体">为一般字串</span><span lang="EN-US">. %s 
</span><span style="FONT-FAMILY: 宋体">及</span><span lang="EN-US"> %d </span><span style="FONT-FAMILY: 宋体">为格式控制字符</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">(c)</span><span style="FONT-FAMILY: 宋体">打印时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">一般字串将被原封不动地打印出来</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">遇到格式控制字符时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">则依序把</span><span lang="EN-US"> format</span><span style="FONT-FAMILY: 宋体">后方之</span><span lang="EN-US"> item </span><span style="FONT-FAMILY: 宋体">转换成所指定的格式后进行打印</span><span lang="EN-US">. </span></p>
<p class="MsoBodyText"><span lang="EN-US">(d)</span><span style="FONT-FAMILY: 宋体">有关的细节</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">读者可从介绍</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言的书籍上得到较完整的介绍</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">(e)print </span><span style="FONT-FAMILY: 宋体">及</span><span lang="EN-US"> printf </span><span style="FONT-FAMILY: 宋体">两个指令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">其后可使用</span><span lang="EN-US"> &gt; </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> &gt;&gt; </span><span style="FONT-FAMILY: 宋体">将输出到</span><span lang="EN-US">stdout </span><span style="FONT-FAMILY: 宋体">的数据重定向到其它文件</span><span lang="EN-US">, 7.1 </span><span style="FONT-FAMILY: 宋体">节中有完整的</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">print </span></b><b><span style="FONT-FAMILY: 宋体">指令</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">范</span> <span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US"> :</span></p>
<p class="a8"><span lang="EN-US">id = "BE-267";&nbsp; ave = 89</span></p>
<p class="a8"><span lang="EN-US">print "ID# :", id, "Ave Score :"ave</span></p>
<p class="MsoBodyText"><span lang="EN-US">(a)</span><span style="FONT-FAMILY: 宋体">结果印出</span><span lang="EN-US"> : </span></p>
<p class="a8"><span lang="EN-US">ID# : BE-267 Ave Score :89</span></p>
<p class="MsoBodyText"><span lang="EN-US">(b)print </span><span style="FONT-FAMILY: 宋体">之后可接上字串常数</span><span lang="EN-US">(Constant 
String)</span><span style="FONT-FAMILY: 宋体">或变量</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">它们彼此间可用</span><span lang="EN-US">"," 
</span><span style="FONT-FAMILY: 宋体">隔开</span><span lang="EN-US">. </span></p>
<p class="MsoBodyText"><span lang="EN-US">(c)</span><span style="FONT-FAMILY: 宋体">上式中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">字串</span><span lang="EN-US"> "ID# :" </span><span style="FONT-FAMILY: 宋体">与变量</span><span lang="EN-US"> id </span><span style="FONT-FAMILY: 宋体">之间使用</span><span lang="EN-US">","</span><span style="FONT-FAMILY: 宋体">隔开</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">打印时两者之间会以自动</span><span lang="EN-US"> OFS(</span><span style="FONT-FAMILY: 宋体">请参考</span> <span style="FONT-FAMILY: 宋体">附录</span><span lang="EN-US">D </span><span style="FONT-FAMILY: 宋体">内建变量</span><span lang="EN-US"> 
OFS) </span><span style="FONT-FAMILY: 宋体">隔开</span><span lang="EN-US">. OFS 
</span><span style="FONT-FAMILY: 宋体">之值一般内定为</span><span lang="EN-US"> 
"</span><span style="FONT-FAMILY: 宋体">一个空格</span><span lang="EN-US">"</span></p>
<p class="MsoBodyText"><span lang="EN-US">(d)</span><span style="FONT-FAMILY: 宋体">上式中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">字串</span><span lang="EN-US"> "Ave Score :" </span><span style="FONT-FAMILY: 宋体">与变量</span><span lang="EN-US">ave</span><span style="FONT-FAMILY: 宋体">之间并未以</span><span lang="EN-US">","</span><span style="FONT-FAMILY: 宋体">隔开</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">会将这两者先当成字串</span><span lang="EN-US">concate</span><span style="FONT-FAMILY: 宋体">在一起</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">变成</span><span lang="EN-US">"Ave Score :89")</span><span style="FONT-FAMILY: 宋体">后</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">再予打印</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">getline </span></b><b><span style="FONT-FAMILY: 宋体">指令</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">语法</span></p>
<table class="MsoNormalTable" style="MARGIN-LEFT: 6pt; BORDER-COLLAPSE: collapse" border="0" cellpadding="0" cellspacing="0">
  <tbody>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: black 1pt solid; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 113.35pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="151">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">语法</span></p></td>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: black 1pt solid; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 110pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="147">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">由何处读取数据</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: black 1pt solid; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 250pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="333">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">数据读入后置于</span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 113.35pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="151">
      <p class="MsoNormal"><span lang="EN-US">getline var &lt; file</span></p></td>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 110pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="147">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">所指定的</span><span lang="EN-US"> file</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 250pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="333">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">变量</span><span lang="EN-US"> var(var</span><span style="FONT-FAMILY: 宋体">省略时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">表示置于</span><span lang="EN-US">$0)</span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 113.35pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="151">
      <p class="MsoNormal"><span lang="EN-US">getline var</span></p></td>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 110pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="147">
      <p class="MsoNormal"><span lang="EN-US">pipe </span><span style="FONT-FAMILY: 宋体">变量</span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 250pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="333">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">变量</span><span lang="EN-US"> var(var</span><span style="FONT-FAMILY: 宋体">省略时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">表示置于</span><span lang="EN-US">$0) </span></p></td></tr>
  <tr>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 113.35pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="151">
      <p class="MsoNormal"><span lang="EN-US">getline var</span></p></td>
    <td style="BORDER-RIGHT: medium none; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 110pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="147">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">见</span> <span style="FONT-FAMILY: 宋体">注一</span><span lang="EN-US"> </span></p></td>
    <td style="BORDER-RIGHT: black 1pt solid; PADDING-RIGHT: 2.75pt; BORDER-TOP: medium none; PADDING-LEFT: 2.75pt; PADDING-BOTTOM: 2.75pt; BORDER-LEFT: black 1pt solid; WIDTH: 250pt; PADDING-TOP: 2.75pt; BORDER-BOTTOM: black 1pt solid" valign="top" width="333">
      <p class="MsoNormal"><span style="FONT-FAMILY: 宋体">变量</span><span lang="EN-US"> var(var</span><span style="FONT-FAMILY: 宋体">省略时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">表示置于</span><span lang="EN-US">$0) </span></p></td></tr></tbody></table>
<p class="MsoBodyText"><span lang="EN-US">getline </span><span style="FONT-FAMILY: 宋体">一次读取一行资料</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若读取成功则</span><span lang="EN-US">return 1,</span><span style="FONT-FAMILY: 宋体">若读取失败则</span><span lang="EN-US">return -1, </span><span style="FONT-FAMILY: 宋体">若遇到文件结束</span><span lang="EN-US">(EOF), </span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US">return 0</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">close&nbsp; </span></b><b><span style="FONT-FAMILY: 宋体">指令</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">该指令用以关闭一个打开的文件</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> pipe 
(</span><span style="FONT-FAMILY: 宋体">见下例</span><span lang="EN-US">) </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">范</span> <span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US"> :</span></p>
<p class="a8"><span lang="EN-US">BEGIN {&nbsp; print "ID #&nbsp;&nbsp; Salary" &gt; 
"data.rpt" }&nbsp;&nbsp; </span></p>
<p class="a8"><span lang="EN-US">{&nbsp; print $1 , $2 * $3&nbsp; | "sort -k 1 &gt; 
data.rpt" }&nbsp;&nbsp;&nbsp; </span></p>
<p class="a8"><span lang="EN-US">END{&nbsp; close( "data.rpt" )</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; close( "sort -k 1 &gt; data.rpt" 
)</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; print " There are", NR, "records 
processed."</span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">说</span> <span style="FONT-FAMILY: 宋体">明</span><span lang="EN-US"> : </span></p>
<p class="MsoBodyText"><span lang="EN-US">(a)</span><span style="FONT-FAMILY: 宋体">上例中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">一开始执行</span><span lang="EN-US"> print "ID #&nbsp;&nbsp; 
Salary" &gt; "data.rpt" </span><span style="FONT-FAMILY: 宋体">指令来输出一行抬头</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">它使用</span><span lang="EN-US"> I/O Redirection ( &gt; 
)</span><span style="FONT-FAMILY: 宋体">将数据转输出到</span><span lang="EN-US">data.rpt,</span><span style="FONT-FAMILY: 宋体">故此时文件</span><span lang="EN-US"> data.rpt </span><span style="FONT-FAMILY: 宋体">是处於</span><span lang="EN-US"> Open </span><span style="FONT-FAMILY: 宋体">状态</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">(b)</span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US"> print $1, $2 * $3 
</span><span style="FONT-FAMILY: 宋体">不停的将输出的资料送往</span><span lang="EN-US"> 
pipe(|), awk</span><span style="FONT-FAMILY: 宋体">在程序将结束时才会呼叫</span><span lang="EN-US"> shell </span><span style="FONT-FAMILY: 宋体">使用指令</span><span lang="EN-US"> "sort -k 1 &gt; data.rpt" </span><span style="FONT-FAMILY: 宋体">来处理</span><span lang="EN-US"> pipe </span><span style="FONT-FAMILY: 宋体">中的数据</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">并未立即执行</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">这点与</span><span lang="EN-US"> Unix </span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">pipe</span><span style="FONT-FAMILY: 宋体">的用法不尽相同</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">(c)</span><span style="FONT-FAMILY: 宋体">最后希望於文件</span><span lang="EN-US"> data.rpt </span><span style="FONT-FAMILY: 宋体">的末尾处加上一行</span><span lang="EN-US"> "There 
are.....".</span><span style="FONT-FAMILY: 宋体">但此时</span><span lang="EN-US">, 
Shell</span><span style="FONT-FAMILY: 宋体">尚未执行</span><span lang="EN-US"> "sort -k 
1 &gt; data.rpt" </span><span style="FONT-FAMILY: 宋体">故各数据行排序后的</span><span lang="EN-US"> ID </span><span style="FONT-FAMILY: 宋体">及</span><span lang="EN-US"> 
Salary </span><span style="FONT-FAMILY: 宋体">等数据尚未写入</span><span lang="EN-US">data.rpt. </span><span style="FONT-FAMILY: 宋体">所以得命令</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">提前先通知</span><span lang="EN-US"> Shell </span><span style="FONT-FAMILY: 宋体">执行命令</span><span lang="EN-US"> "sort -k 1 &gt; data.rpt" </span><span style="FONT-FAMILY: 宋体">来处理</span><span lang="EN-US"> pipe </span><span style="FONT-FAMILY: 宋体">中的资料</span><span lang="EN-US">. awk</span><span style="FONT-FAMILY: 宋体">中这个动作称为</span><span lang="EN-US"> close pipe. </span><span style="FONT-FAMILY: 宋体">是由执行</span><span lang="EN-US"> close ( "shell command" 
)</span><span style="FONT-FAMILY: 宋体">来完成</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">需留心</span><span lang="EN-US"> close( )</span><span style="FONT-FAMILY: 宋体">指令中的</span><span lang="EN-US"> shell command </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">需与</span><span lang="EN-US">"|"</span><span style="FONT-FAMILY: 宋体">后方的</span><span lang="EN-US"> 
shell command </span><span style="FONT-FAMILY: 宋体">完全相同</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">一字不差</span><span lang="EN-US">), 
</span><span style="FONT-FAMILY: 宋体">较佳的方法是先以该字串定义一个简短的变量</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">程序中再以此变量代替该</span><span lang="EN-US">shell command&nbsp;&nbsp; </span></p>
<p class="MsoBodyText"><span lang="EN-US">(d)</span><span style="FONT-FAMILY: 宋体">为什么执行</span><span lang="EN-US"> close("data.rpt") ?&nbsp; 
</span><span style="FONT-FAMILY: 宋体">因为</span><span lang="EN-US"> sort 
</span><span style="FONT-FAMILY: 宋体">完后的资料也将写到</span><span lang="EN-US">data.rpt,</span><span style="FONT-FAMILY: 宋体">而该文件正为</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">所打开使用</span><span lang="EN-US">(write)</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">故</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程式中应先关闭</span><span lang="EN-US">data.rpt. </span><span style="FONT-FAMILY: 宋体">以免造成因二个</span><span lang="EN-US"> processes </span><span style="FONT-FAMILY: 宋体">同时打开一个文件进行输出</span><span lang="EN-US">(write)</span><span style="FONT-FAMILY: 宋体">所产生的错误</span><span lang="EN-US">. </span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">system </span></b><b><span style="FONT-FAMILY: 宋体">指令</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">该指令用以执行</span><span lang="EN-US"> Shell</span><span style="FONT-FAMILY: 宋体">上的</span><span lang="EN-US"> 
command.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">范</span> <span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US"> :</span></p>
<p class="a8"><span lang="EN-US">DataFile = "invent.rpt"</span></p>
<p class="a8"><span lang="EN-US">system( "rm " DataFile )&nbsp; </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">说明</span><span lang="EN-US"> : 
</span></p>
<p class="MsoBodyText"><span lang="EN-US">(a)system("</span><span style="FONT-FAMILY: 宋体">字符串</span><span lang="EN-US">")</span><span style="FONT-FAMILY: 宋体">指令接受一个字符串当成</span><span lang="EN-US">Shell</span><span style="FONT-FAMILY: 宋体">的命令</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">上例中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">使用一个字串常数</span><span lang="EN-US">"rm " </span><span style="FONT-FAMILY: 宋体">连接</span><span lang="EN-US">(concate)</span><span style="FONT-FAMILY: 宋体">一个变量</span><span lang="EN-US"> DataFile </span><span style="FONT-FAMILY: 宋体">形成要求</span><span lang="EN-US"> Shell </span><span style="FONT-FAMILY: 宋体">执行的命令</span><span lang="EN-US">.Shell </span><span style="FONT-FAMILY: 宋体">实际执行的命令为</span><span lang="EN-US"> "rm invent.rpt".&nbsp; 
</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">"|" pipe</span></b><b><span style="FONT-FAMILY: 宋体">指令</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">"|" </span><span style="FONT-FAMILY: 宋体">配合</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">输出指令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">可把</span><span lang="EN-US"> output </span><span style="FONT-FAMILY: 宋体">到</span><span lang="EN-US"> stdout </span><span style="FONT-FAMILY: 宋体">的资料继续转送给</span><span lang="EN-US">Shell </span><span style="FONT-FAMILY: 宋体">上的某一命令当成</span><span lang="EN-US">input</span><span style="FONT-FAMILY: 宋体">的资料</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">"|"&nbsp; </span><span style="FONT-FAMILY: 宋体">配合</span><span lang="EN-US"> awk getline </span><span style="FONT-FAMILY: 宋体">指令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">可呼叫</span><span lang="EN-US"> Shell </span><span style="FONT-FAMILY: 宋体">执行某一命令</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">再以</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US"> getline </span><span style="FONT-FAMILY: 宋体">指令将该命令的所产生的资料读进</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">程序中</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">范</span> <span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US"> :</span></p>
<p class="a8"><span lang="EN-US">{ print $1, $2 * $3&nbsp; | "sort -k 1 &gt; result" 
}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p>
<p class="a8"><span lang="EN-US">"date" |&nbsp; getline&nbsp; Date_data</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">读者请参考</span><span lang="EN-US">7.2 </span><span style="FONT-FAMILY: 宋体">节</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">其中有完整的范例说明</span><span lang="EN-US">. </span></p>
<p class="MsoBodyText"><span lang="EN-US"></span>&nbsp;</p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">awk 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">释放所占用的记忆体的指令</span><span lang="EN-US"> </span></h2>
<p class="MsoBodyText"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">程式中常使用数组</span><span lang="EN-US">(Array)</span><span style="FONT-FAMILY: 宋体">来记忆大量数据</span><span lang="EN-US">, delete </span><span style="FONT-FAMILY: 宋体">指令便是用来释放数组中的元素所占用的内存空间</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">范</span> <span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US"> :</span></p>
<p class="a8"><span lang="EN-US">for( any in X_arr )&nbsp; </span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; delete X_arr[any]</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">读者请留心</span><span lang="EN-US">, delete </span><span style="FONT-FAMILY: 宋体">指令一次只能释放数组中的一个元素</span><span lang="EN-US">.</span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">awk 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">中的数学运算符</span><span lang="EN-US">(Arithmetic Operators)</span></h2>
<p class="MsoBodyText"><span lang="EN-US">+(</span><span style="FONT-FAMILY: 宋体">加</span><span lang="EN-US">), -(</span><span style="FONT-FAMILY: 宋体">减</span><span lang="EN-US">), *(</span><span style="FONT-FAMILY: 宋体">乘</span><span lang="EN-US">), /(</span><span style="FONT-FAMILY: 宋体">除</span><span lang="EN-US">), %(</span><span style="FONT-FAMILY: 宋体">求余数</span><span lang="EN-US">), ^(</span><span style="FONT-FAMILY: 宋体">指数</span><span lang="EN-US">) </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> C </span><span style="FONT-FAMILY: 宋体">语言中用法相同</span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">awk 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">中的赋值运算符</span><span lang="EN-US">(Assignment Operators)</span></h2>
<p class="MsoBodyText"><span lang="EN-US">=, +=, -=, *= , /=, %=, ^= </span></p>
<p class="MsoBodyText"><span lang="EN-US">x += 5 </span><span style="FONT-FAMILY: 宋体">的意思为</span><span lang="EN-US"> x = x + 5, </span><span style="FONT-FAMILY: 宋体">其余类推</span><span lang="EN-US">.</span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">awk 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">中的条件运算符</span><span lang="EN-US">(Conditional&nbsp; Operator)</span></h2>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">语</span> <span style="FONT-FAMILY: 宋体">法</span><span lang="EN-US"> :</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">判断条件</span><span lang="EN-US"> 
? value1 : value2</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">若</span> <span style="FONT-FAMILY: 宋体">判断条件</span> <span style="FONT-FAMILY: 宋体">成立</span><span lang="EN-US">(true) </span><span style="FONT-FAMILY: 宋体">则返回</span><span lang="EN-US"> value1, </span><span style="FONT-FAMILY: 宋体">否则返回</span><span lang="EN-US"> value2. </span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">awk 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">中的逻辑运算符</span><span lang="EN-US">(Logical Operators) </span></h2>
<p class="MsoBodyText"><span lang="EN-US">&amp;&amp;( and ), ||(or), 
!(not)</span></p>
<p class="MsoBodyText"><span lang="EN-US">Extended Regular Expression </span><span style="FONT-FAMILY: 宋体">中使用</span><span lang="EN-US"> "|" </span><span style="FONT-FAMILY: 宋体">表示</span><span lang="EN-US"> or </span><span style="FONT-FAMILY: 宋体">请勿混淆</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US"></span>&nbsp;</p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">awk 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">中的关系运算符</span><span lang="EN-US">(Relational Operators)</span></h2>
<p class="MsoBodyText"><span lang="EN-US">&gt;, &gt;=, &lt;, &lt; =, ==, !=, ~, 
!~</span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">awk 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">中其它的运算符</span></h2>
<p class="MsoBodyText"><span lang="EN-US">+(</span><span style="FONT-FAMILY: 宋体">正号</span><span lang="EN-US">), -(</span><span style="FONT-FAMILY: 宋体">负号</span><span lang="EN-US">),&nbsp; ++(Increment 
Operator), - -(Decrement Operator) </span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">awk 
</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">中各运算符的运算级</span></h2>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">按优先高低排列</span><span lang="EN-US">:</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp; 
$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="FONT-FAMILY: 宋体">栏位运算元</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : i=3; $i</span><span style="FONT-FAMILY: 宋体">表示第</span><span lang="EN-US">3</span><span style="FONT-FAMILY: 宋体">栏</span><span lang="EN-US">) </span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp; 
^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="FONT-FAMILY: 宋体">指数运算</span><span lang="EN-US">) </span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp; + ,- ,! (</span><span style="FONT-FAMILY: 宋体">正</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">负号</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">及逻辑上的</span><span lang="EN-US"> not) </span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp; * ,/ ,% (</span><span style="FONT-FAMILY: 宋体">乘</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">除</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">余数</span><span lang="EN-US">)</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp; + ,-&nbsp;&nbsp;&nbsp; 
(</span><span style="FONT-FAMILY: 宋体">加</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">减</span><span lang="EN-US">)&nbsp; </span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp; &gt;, &gt;&nbsp; =,&lt; 
, &lt; =, ==, != (</span><span style="FONT-FAMILY: 宋体">关系运算符</span><span lang="EN-US">)</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp; ~, !~&nbsp;&nbsp; 
(match, not match)</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp; 
&amp;&amp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="FONT-FAMILY: 宋体">逻辑上的</span><span lang="EN-US"> and)</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp; 
||&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="FONT-FAMILY: 宋体">逻辑上的</span><span lang="EN-US"> or )</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp; ? 
:&nbsp;&nbsp;&nbsp;&nbsp; (</span><span style="FONT-FAMILY: 宋体">条件运算符</span><span lang="EN-US">)</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp; = , +=, -=,*=, /=, %=, 
^= (</span><span style="FONT-FAMILY: 宋体">赋值运算符</span><span lang="EN-US">)</span></p>
<p class="MsoBodyText"><span lang="EN-US"></span>&nbsp;</p>
<h1><span lang="EN-US">14.<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">附录</span><span lang="EN-US">C 
── awk </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">的内建函数</span><span lang="EN-US">(Built-in Functions)</span></h1>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">一</span><span lang="EN-US">). </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">字串函数</span></h2>
<p class="MsoBodyText"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">index( </span></b><b><span style="FONT-FAMILY: 宋体">原字串</span><span lang="EN-US">, </span></b><b><span style="FONT-FAMILY: 宋体">找寻的子字串</span> <span lang="EN-US">): </span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">若原字串中含有欲找寻的子字串</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">则返回该子字串在原字串中第一次出现的位置</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">若未曾出现该子字串则返回</span><span lang="EN-US">0.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如执行</span><span lang="EN-US"> 
:</span></p>
<p class="a8"><span lang="EN-US">$ awk&nbsp; 'BEGIN{ print index("8-12-94","-") 
}'</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">结果印出</span></p>
<p class="a8"><span lang="EN-US">2</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp; </span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">length( </span></b><b><span style="FONT-FAMILY: 宋体">字串</span> <span lang="EN-US">) : </span></b><b><span style="FONT-FAMILY: 宋体">返回该字串的长度</span><span lang="EN-US">. </span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如执行</span><span lang="EN-US"> 
:</span><span style="FONT-FAMILY: 宋体">　　</span></p>
<p class="a8"><span lang="EN-US">$ awk&nbsp; 'BEGIN { print length("John") 
'}</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">结果印出</span></p>
<p class="a8"><span lang="EN-US">4</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">match( </span></b><b><span style="FONT-FAMILY: 宋体">原字串</span><span lang="EN-US">, </span></b><b><span style="FONT-FAMILY: 宋体">用以找寻比对的正则表达式</span> <span lang="EN-US">):</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">会在原字串中找寻合乎正则表达式的子字串</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">若合乎条件的子字串有多个</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">则以原字串中最左方的子字串为准</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">找到该字串后会依此字串为依据进行下列动作</span><span lang="EN-US">:</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">设定</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">内建变量</span><span lang="EN-US"> 
RSTART, RLENGTH :</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RSTART =&nbsp; 
</span><span style="FONT-FAMILY: 宋体">合条件的子字串在原字串中的位置</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
=&nbsp; 0 ; </span><span style="FONT-FAMILY: 宋体">若未找到合条件的子字串</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RLENGTH = 
</span><span style="FONT-FAMILY: 宋体">合条件的子字串长度</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 
-1 ; </span><span style="FONT-FAMILY: 宋体">若未找到合条件的子字串</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">返回</span><span lang="EN-US"> 
RSTART </span><span style="FONT-FAMILY: 宋体">之值</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如执行</span><span lang="EN-US"> 
:</span></p>
<p class="a8"><span lang="EN-US">awk ' BEGIN {</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; match( "banana", /(an)+/ 
)</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; print RSTART, RLENGTH</span></p>
<p class="a8"><span lang="EN-US">} '&nbsp;&nbsp;&nbsp; </span><span style="FONT-FAMILY: 宋体">　　　</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span><span style="FONT-FAMILY: 宋体">执行结果输出</span></p>
<p class="a8"><span lang="EN-US">2 4</span></p>
<p class="MsoBodyText"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">split( </span></b><b><span style="FONT-FAMILY: 宋体">原字串</span><span lang="EN-US">, </span></b><b><span style="FONT-FAMILY: 宋体">数组名称</span><span lang="EN-US">, </span></b><b><span style="FONT-FAMILY: 宋体">分隔字符</span> <span lang="EN-US">):</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">将依所指定的分隔字符</span><span lang="EN-US">(field 
separator)</span><span style="FONT-FAMILY: 宋体">来分隔原字串成一个个的栏位</span><span lang="EN-US">(field),</span><span style="FONT-FAMILY: 宋体">并以指定的数组记录各个被分隔的栏位</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> 
:</span></p>
<p class="a8"><span lang="EN-US">ArgLst = "5P12p89"</span></p>
<p class="a8"><span lang="EN-US">split( ArgLst, Arr, /[Pp]/)</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="FONT-FAMILY: 宋体">执行后</span><span lang="EN-US"> : Arr[1]=5,&nbsp; 
Arr[2]=12,&nbsp; Arr[3]=89</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">sprintf(</span></b><b><span style="FONT-FAMILY: 宋体">格式字符串</span><span lang="EN-US">, </span></b><b><span style="FONT-FAMILY: 宋体">项</span><span lang="EN-US">1, </span></b><b><span style="FONT-FAMILY: 宋体">项</span><span lang="EN-US">2, ...)</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">该函数的用法与</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US">C</span><span style="FONT-FAMILY: 宋体">的输出函数</span><span lang="EN-US">printf()</span><span style="FONT-FAMILY: 宋体">相同</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">所不同的是</span><span lang="EN-US">sprintf()</span><span style="FONT-FAMILY: 宋体">会将要求印出的结果当成一个字串返回</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">一般最常使用</span><span lang="EN-US">sprintf()</span><span style="FONT-FAMILY: 宋体">来改变资料格式</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US">: x </span><span style="FONT-FAMILY: 宋体">为一数值资料</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若欲将其变成一个含二位小数的资料</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">可执行如下指令</span><span lang="EN-US">:</span></p>
<p class="a8"><span lang="EN-US">x = 28</span></p>
<p class="a8"><span lang="EN-US">x = sprintf("%.2f",x)</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">执行后</span><span lang="EN-US"> x 
= "28.00"</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">sub( </span></b><b><span style="FONT-FAMILY: 宋体">比对用的正则表达式</span><span lang="EN-US">, </span></b><b><span style="FONT-FAMILY: 宋体">将替换的新字串</span><span lang="EN-US">, </span></b><b><span style="FONT-FAMILY: 宋体">原字串</span> <span lang="EN-US">)</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">sub( )</span><span style="FONT-FAMILY: 宋体">将原字串中第一个</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">最左边</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">合乎所指定的正则表达式的子字串改以新字串取代</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">第二个参数</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">将替换的新字串</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">中可用</span><span lang="EN-US">"&amp;"</span><span style="FONT-FAMILY: 宋体">来代表</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">合於条件的子字串</span><span lang="EN-US">"</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">承上例</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">执行下列指令</span><span lang="EN-US">:</span></p>
<p class="a8"><span lang="EN-US">A = "a6b12anan212.45an6a"</span></p>
<p class="a8"><span lang="EN-US">sub( /(an)+[0-9]*/, "[&amp;]", A)</span></p>
<p class="a8"><span lang="EN-US">print A</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">结果输出</span></p>
<p class="a8"><span lang="EN-US">ab12[anan212].45an6a</span></p>
<p class="MsoBodyText"><span lang="EN-US">sub()</span><span style="FONT-FAMILY: 宋体">不仅可执行替换</span><span lang="EN-US">(replacement)</span><span style="FONT-FAMILY: 宋体">的功用</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">当第二个参数为空字串</span><span lang="EN-US">("")</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">,sub()</span><span style="FONT-FAMILY: 宋体">所执行的是</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">去除指定字串</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">的功用</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">通过</span><span lang="EN-US"> 
sub() </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> match() 
</span><span style="FONT-FAMILY: 宋体">的搭配使用</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">可逐次取出原字串中合乎指定条件的所有子字串</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如执行下列程式</span><span lang="EN-US">:</span></p>
<p class="a8"><span lang="EN-US">awk '</span></p>
<p class="a8"><span lang="EN-US">BEGIN {</span></p>
<p class="a8"><span lang="EN-US">data = "p12-P34 P56-p61"</span></p>
<p class="a8"><span lang="EN-US">while( match( data ,/[0-9]+/) &gt; 0) {</span></p>
<p class="a8"><span lang="EN-US">print substr(data, RSTART, RLENGTH )</span></p>
<p class="a8"><span lang="EN-US">sub(/[0-9]+/,"",data)</span></p>
<p class="a8"><span lang="EN-US">}</span></p>
<p class="a8"><span lang="EN-US">}' </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">结果输出</span><span lang="EN-US"> 
:</span></p>
<p class="a8"><span lang="EN-US">12</span></p>
<p class="a8"><span lang="EN-US">34</span></p>
<p class="a8"><span lang="EN-US">56</span></p>
<p class="a8"><span lang="EN-US">61</span></p>
<p class="MsoBodyText"><span lang="EN-US">sub( )</span><span style="FONT-FAMILY: 宋体">中第三个参数</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">原字串</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">若未指定</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">则其预设值为</span><span lang="EN-US">$0.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">可用</span><span lang="EN-US"> 
sub( /[9-0]+/,"digital" ) </span><span style="FONT-FAMILY: 宋体">表示</span><span lang="EN-US"> sub(/[0-9]+/,"digital",$0 )</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">gsub( </span></b><b><span style="FONT-FAMILY: 宋体">比对用的正则表达式</span><span lang="EN-US">, </span></b><b><span style="FONT-FAMILY: 宋体">将替换的新字串</span><span lang="EN-US">, </span></b><b><span style="FONT-FAMILY: 宋体">原字串</span> <span lang="EN-US">)</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">这个函数与</span><span lang="EN-US"> 
sub()</span><span style="FONT-FAMILY: 宋体">一样</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">同样是进行字串取代的函数</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">唯一不同点是</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp; 
gsub()</span><span style="FONT-FAMILY: 宋体">会取代所有合条件的子字串</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp; 
gsub()</span><span style="FONT-FAMILY: 宋体">会返回被取代的子字串个数</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">请参考</span><span lang="EN-US"> 
sub().</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">substr( </span></b><b><span style="FONT-FAMILY: 宋体">字串</span><span lang="EN-US">,</span></b><b><span style="FONT-FAMILY: 宋体">起始位置</span> <span lang="EN-US">[,</span></b><b><span style="FONT-FAMILY: 宋体">长度</span><span lang="EN-US">] ):</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">返回从起始位置起</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">指定长度的子字串</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">若未指定长度</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">则返回起始位置到字串末尾的子字串</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">执行下例</span></p>
<p class="a8"><span lang="EN-US">$ awk 'BEGIN { print substr("User:Wei-Lin Liu", 
6)}'</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">结果印出</span></p>
<p class="a8"><span lang="EN-US">Wei-Lin Liu</span></p>
<h2><span style="FONT-WEIGHT: normal; FONT-FAMILY: Wingdings" lang="EN-US">&#216;</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">二</span><span lang="EN-US">). </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">数学函数</span></h2>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">int(x) : </span></b><b><span style="FONT-FAMILY: 宋体">返回</span><span lang="EN-US">x</span></b><b><span style="FONT-FAMILY: 宋体">的整数部分</span><span lang="EN-US">(</span></b><b><span style="FONT-FAMILY: 宋体">去掉小数</span><span lang="EN-US">).</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span></p>
<p class="MsoBodyText"><span lang="EN-US">int(7.8) </span><span style="FONT-FAMILY: 宋体">将返回</span><span lang="EN-US"> 7</span></p>
<p class="MsoBodyText"><span lang="EN-US">int(-7.8) </span><span style="FONT-FAMILY: 宋体">将返回</span><span lang="EN-US"> -7</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">sqrt(x) : </span></b><b><span style="FONT-FAMILY: 宋体">返回</span><span lang="EN-US">x</span></b><b><span style="FONT-FAMILY: 宋体">的平方根</span><span lang="EN-US">. </span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> 
:</span></p>
<p class="MsoBodyText"><span lang="EN-US">sqrt(9) </span><span style="FONT-FAMILY: 宋体">将返回</span><span lang="EN-US"> 3</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">若</span><span lang="EN-US"> x 
</span><span style="FONT-FAMILY: 宋体">为负数</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">则执行</span><span lang="EN-US"> sqrt(x)</span><span style="FONT-FAMILY: 宋体">时将造成</span><span lang="EN-US"> Run Time Error 
[</span><span style="FONT-FAMILY: 宋体">译者注</span><span lang="EN-US">: </span><span style="FONT-FAMILY: 宋体">我这里没有发生错误</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">返回的是</span><span lang="EN-US">"nan"]</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">exp(x) : </span></b><b><span style="FONT-FAMILY: 宋体">将返回</span><span lang="EN-US">e</span></b><b><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US">x</span></b><b><span style="FONT-FAMILY: 宋体">次方</span><span lang="EN-US">. </span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> 
:</span></p>
<p class="MsoBodyText"><span lang="EN-US">exp(1) </span><span style="FONT-FAMILY: 宋体">将返回</span><span lang="EN-US"> 2.71828</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">log(x) : </span></b><b><span style="FONT-FAMILY: 宋体">将返回</span><span lang="EN-US">x</span></b><b><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US">e</span></b><b><span style="FONT-FAMILY: 宋体">为底的对数值</span><span lang="EN-US">.</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> 
:</span></p>
<p class="MsoBodyText"><span lang="EN-US">log(exp(1))&nbsp; </span><span style="FONT-FAMILY: 宋体">将返回</span><span lang="EN-US"> 1</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">若</span><span lang="EN-US"> 
x&lt; 0 ,</span><span style="FONT-FAMILY: 宋体">则执行</span><span lang="EN-US"> 
sqrt(x)</span><span style="FONT-FAMILY: 宋体">时将造成</span><span lang="EN-US"> Run 
Time Error. [</span><span style="FONT-FAMILY: 宋体">译者注</span><span lang="EN-US">: 
</span><span style="FONT-FAMILY: 宋体">我这里也没有发生错误</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">返回的是</span><span lang="EN-US">"nan"]</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">sin(x) : x </span></b><b><span style="FONT-FAMILY: 宋体">须以弧度为单位</span><span lang="EN-US">,sin(x)</span></b><b><span style="FONT-FAMILY: 宋体">将返回</span><span lang="EN-US">x</span></b><b><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US">sin</span></b><b><span style="FONT-FAMILY: 宋体">函数值</span><span lang="EN-US">.</span></b></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">cos(x) : x </span></b><b><span style="FONT-FAMILY: 宋体">须以弧度为单位</span><span lang="EN-US">,cos(x)</span></b><b><span style="FONT-FAMILY: 宋体">将返回</span><span lang="EN-US">x</span></b><b><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US">cos</span></b><b><span style="FONT-FAMILY: 宋体">函数值</span><span lang="EN-US"> </span></b></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">atan2(y,x) : </span></b><b><span style="FONT-FAMILY: 宋体">返回</span> <span lang="EN-US">y/x </span></b><b><span style="FONT-FAMILY: 宋体">的</span><span lang="EN-US">tan</span></b><b><span style="FONT-FAMILY: 宋体">反函数之值</span><span lang="EN-US">,</span></b><b><span style="FONT-FAMILY: 宋体">返回值系以弧度为单位</span><span lang="EN-US">.</span></b></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">rand() : </span></b><b><span style="FONT-FAMILY: 宋体">返回介于</span> <span lang="EN-US">0</span></b><b><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US">1</span></b><b><span style="FONT-FAMILY: 宋体">之间的</span><span lang="EN-US">(</span></b><b><span style="FONT-FAMILY: 宋体">近似</span><span lang="EN-US">)</span></b><b><span style="FONT-FAMILY: 宋体">随机数值</span><span lang="EN-US">; 0 &lt; 
rand()&lt;1.</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">除非使用者自行指定</span><span lang="EN-US">rand()</span><span style="FONT-FAMILY: 宋体">函数起始的种子</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">否则每次执行</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程式时</span><span lang="EN-US">,&nbsp; rand()</span><span style="FONT-FAMILY: 宋体">函数都将使用同一个内定的种子</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">来产生随机数</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">srand([x]) : </span></b><b><span style="FONT-FAMILY: 宋体">指定以</span><span lang="EN-US">x</span></b><b><span style="FONT-FAMILY: 宋体">为</span><span lang="EN-US">rand( )</span></b><b><span style="FONT-FAMILY: 宋体">函数起始的种子</span><span lang="EN-US">.</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">若省略了</span><span lang="EN-US">x,</span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">会以执行时的日期与时间为</span><span lang="EN-US">rand()</span><span style="FONT-FAMILY: 宋体">函数起始的种子</span><span lang="EN-US">.</span></p>
<h1><span lang="EN-US">15.<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">附录</span><span lang="EN-US">D 
── awk </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">的内建变量</span><span lang="EN-US"> Built-in Variables </span></h1>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">因内建变量的个数不多</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">此处按其相关性分类说明</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并未按其字母顺序排列</span><span lang="EN-US">. </span></p>
<p class="MsoBodyText"><span lang="EN-US"></span>&nbsp;</p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">ARGC</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">ARGC</span><span style="FONT-FAMILY: 宋体">表示命令行上除了选项</span><span lang="EN-US"> -F, -v, -f 
</span><span style="FONT-FAMILY: 宋体">及其所对应的参数之外的所有参数的个数</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">若将</span><span lang="EN-US">"awk</span><span style="FONT-FAMILY: 宋体">程式</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">直接写於命令列上</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US"> ARGC 
</span><span style="FONT-FAMILY: 宋体">亦不将该</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">程式部分</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">列入计算</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">ARGV </span></b></p>
<p class="MsoBodyText"><span lang="EN-US">ARGV</span><span style="FONT-FAMILY: 宋体">数组用以记录命令列上的参数</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US"> : 
</span><span style="FONT-FAMILY: 宋体">执行下列命令</span></p>
<p class="a8"><span lang="EN-US">$ awk&nbsp; -F\t -v a=8 -f prg.awk&nbsp; file1.dat 
file2.dat</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">或</span></p>
<p class="a8"><span lang="EN-US">$ awk&nbsp; -F\t -v a=8 '{ print $1 * a }' 
file1.dat file2.dat</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">执行上列任一程式后</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
ARGC&nbsp;&nbsp;&nbsp; =&nbsp; 3</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
ARGV[0] = "awk"</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
ARGV[1] = "file1.dat"</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
ARGV[2] = "file2.dat"</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">读者请留心</span><span lang="EN-US"> 
: </span><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US"> ARGC = 3 
</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">命令列上仅指定了</span><span lang="EN-US"> 2 </span><span style="FONT-FAMILY: 宋体">个文件</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">注</span><span lang="EN-US"> 
:</span></p>
<p class="MsoBodyText"><span lang="EN-US">-F\t </span><span style="FONT-FAMILY: 宋体">表示以</span><span lang="EN-US"> tab </span><span style="FONT-FAMILY: 宋体">为栏位分隔字符</span><span lang="EN-US"> FS(field 
seporator).</span></p>
<p class="MsoBodyText"><span lang="EN-US">-v a=8 </span><span style="FONT-FAMILY: 宋体">是用以初始化程序中的变量</span><span lang="EN-US"> a.&nbsp; 
</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">FILENAME</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">FILENAME</span><span style="FONT-FAMILY: 宋体">用以表示目前正在处理的文件档名</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">FS</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">栏位分隔字符</span><span lang="EN-US">. </span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">$0</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">表示目前</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">所读入的数据行</span><span lang="EN-US">. </span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">$1,$2..</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">分别表示所读入的数据行之第一栏</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">第二栏</span><span lang="EN-US">,..</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">说明</span><span lang="EN-US">:</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">当</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">读入一笔数据行</span><span lang="EN-US"> "A123&nbsp; 8:15" </span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">会先以</span><span lang="EN-US">$0 
</span><span style="FONT-FAMILY: 宋体">记录</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">故</span><span lang="EN-US"> $0 
= "A123&nbsp; 8:15"</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">若程序中进一步使用了</span><span lang="EN-US"> $1, $2.. </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> NF </span><span style="FONT-FAMILY: 宋体">等内建变量时</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">才会自动分割</span><span lang="EN-US"> $0. </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">以便取得栏位相关的资料</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">切割后各个栏位的资料会分别以</span><span lang="EN-US">$1, $2, $3...</span><span style="FONT-FAMILY: 宋体">予以记录</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">内定</span><span lang="EN-US">(default)</span><span style="FONT-FAMILY: 宋体">的</span> <span style="FONT-FAMILY: 宋体">栏位分隔字符</span><span lang="EN-US">(FS) </span><span style="FONT-FAMILY: 宋体">为</span> <span style="FONT-FAMILY: 宋体">空白字符</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">空格及</span><span lang="EN-US">tab).</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">以本例而言</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">读者若未改变</span><span lang="EN-US"> 
FS, </span><span style="FONT-FAMILY: 宋体">则分割后</span><span lang="EN-US">: 
</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">第一栏</span><span lang="EN-US">($1)="A123",&nbsp; </span><span style="FONT-FAMILY: 宋体">第二栏</span><span lang="EN-US">($2)="8:15".</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">使用者可用正则表达式自行定义</span><span lang="EN-US"> FS. awk</span><span style="FONT-FAMILY: 宋体">每次需要分割数据行时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">会参考目前</span><span lang="EN-US">FS</span><span style="FONT-FAMILY: 宋体">的值</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">令</span><span lang="EN-US"> FS 
= "[ :]+" </span><span style="FONT-FAMILY: 宋体">表示任何由</span> <span style="FONT-FAMILY: 宋体">空白</span><span lang="EN-US">" " </span><span style="FONT-FAMILY: 宋体">或</span> <span style="FONT-FAMILY: 宋体">冒号</span><span lang="EN-US">":" </span><span style="FONT-FAMILY: 宋体">所组成的字串都可当成分隔字符</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">则分割后</span><span lang="EN-US"> 
:&nbsp;&nbsp; </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">第一栏</span><span lang="EN-US">($1) = "A123", </span><span style="FONT-FAMILY: 宋体">第二栏</span><span lang="EN-US">($2) = "8", </span><span style="FONT-FAMILY: 宋体">第三栏</span><span lang="EN-US">($3) = "15"</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">NR</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">NR </span><span style="FONT-FAMILY: 宋体">表从</span><span lang="EN-US"> awk </span><span style="FONT-FAMILY: 宋体">开始执行该程序后所读取的数据行数</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">FNR</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">FNR </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> NR </span><span style="FONT-FAMILY: 宋体">功用类似</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">不同的是</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">每打开一个新的文件</span><span lang="EN-US">,FNR </span><span style="FONT-FAMILY: 宋体">便从</span><span lang="EN-US"> 0 </span><span style="FONT-FAMILY: 宋体">重新累计</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">NF</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">NF</span><span style="FONT-FAMILY: 宋体">表目前的数据行所被切分的栏位数</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">awk </span><span style="FONT-FAMILY: 宋体">每读入一笔资料后</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">在程序中可以</span><span lang="EN-US"> NF </span><span style="FONT-FAMILY: 宋体">来得知该行数据包含的栏位个数</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">在下一笔资料被读入之前</span><span lang="EN-US">, NF </span><span style="FONT-FAMILY: 宋体">并不会改变</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">但使用者若自行使用</span><span lang="EN-US">$0</span><span style="FONT-FAMILY: 宋体">来记录数据</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: </span><span style="FONT-FAMILY: 宋体">使用</span><span lang="EN-US"> getline , </span><span style="FONT-FAMILY: 宋体">此时</span><span lang="EN-US"> NF </span><span style="FONT-FAMILY: 宋体">将代表新的</span><span lang="EN-US"> $0 </span><span style="FONT-FAMILY: 宋体">上所记载的资料的栏位个数</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">OFS</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">OFS</span><span style="FONT-FAMILY: 宋体">输出时的栏位分隔字符</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">预设值</span><span lang="EN-US"> " "(</span><span style="FONT-FAMILY: 宋体">一个空白</span><span lang="EN-US">), </span><span style="FONT-FAMILY: 宋体">详见下面说明</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">ORS</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">ORS</span><span style="FONT-FAMILY: 宋体">输出时数据行的分隔字符</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">预设值</span><span lang="EN-US"> "\n"(</span><span style="FONT-FAMILY: 宋体">跳行</span><span lang="EN-US">), </span><span style="FONT-FAMILY: 宋体">见下面说明</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">OFMT</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">OFMT</span><span style="FONT-FAMILY: 宋体">数值资料的输出格式</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">预设值</span><span lang="EN-US"> "%.6g"(</span><span style="FONT-FAMILY: 宋体">若须要时最多印出</span><span lang="EN-US">6</span><span style="FONT-FAMILY: 宋体">位小数</span><span lang="EN-US">)</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">当使用</span><span lang="EN-US"> 
print </span><span style="FONT-FAMILY: 宋体">指令一次印出多项资料时</span><span lang="EN-US">,</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
print $1, $2 </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">输出时</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">会自动在</span><span lang="EN-US"> $1 
</span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> $2 </span><span style="FONT-FAMILY: 宋体">之间补上一个</span><span lang="EN-US"> OFS </span><span style="FONT-FAMILY: 宋体">之值</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">每次使用</span><span lang="EN-US"> 
print </span><span style="FONT-FAMILY: 宋体">输出后</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">会自动补上</span><span lang="EN-US"> ORS 
</span><span style="FONT-FAMILY: 宋体">之值</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">使用</span><span lang="EN-US"> 
print </span><span style="FONT-FAMILY: 宋体">输出数值数据时</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">将采用</span><span lang="EN-US"> OFMT 
</span><span style="FONT-FAMILY: 宋体">之值为输出格式</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span></p>
<p class="a8"><span lang="EN-US">$ awk 'BEGIN { print 2/3,1; OFS=":"; OFMT="%.2g"; 
print 2/3,1 }'</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">输出</span><span lang="EN-US">:</span></p>
<p class="a8"><span lang="EN-US">0.666667 1 </span></p>
<p class="a8"><span lang="EN-US">0.67:1 </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">程序中通过改变</span><span lang="EN-US">OFS</span><span style="FONT-FAMILY: 宋体">和</span><span lang="EN-US">OFMT</span><span style="FONT-FAMILY: 宋体">的值</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">改变了指令</span><span lang="EN-US"> print 
</span><span style="FONT-FAMILY: 宋体">的输出格式</span><span lang="EN-US">.&nbsp; 
</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">RS</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">RS( Record Separator) : awk</span><span style="FONT-FAMILY: 宋体">从文件上读取资料时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">将根据</span><span lang="EN-US"> RS </span><span style="FONT-FAMILY: 宋体">的定义把资料切割成许多</span><span lang="EN-US">Records,</span><span style="FONT-FAMILY: 宋体">而</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">一次仅读入一个</span><span lang="EN-US">Record,</span><span style="FONT-FAMILY: 宋体">以进行处理</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">RS </span><span style="FONT-FAMILY: 宋体">的预设值是</span><span lang="EN-US"> "\n". </span><span style="FONT-FAMILY: 宋体">所以一般</span><span lang="EN-US"> awk</span><span style="FONT-FAMILY: 宋体">一次仅读入一行资料</span><span lang="EN-US">. </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">有时一个</span><span lang="EN-US">Record</span><span style="FONT-FAMILY: 宋体">含括了几行资料</span><span lang="EN-US">(Multi-line Record). </span><span style="FONT-FAMILY: 宋体">这情?下不能再以</span><span lang="EN-US">"\n"</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">来分隔相邻的</span><span lang="EN-US">Records, </span><span style="FONT-FAMILY: 宋体">可改用</span> <span style="FONT-FAMILY: 宋体">空白行</span> <span style="FONT-FAMILY: 宋体">来分隔</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">在</span><span lang="EN-US">awk</span><span style="FONT-FAMILY: 宋体">程式中</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">令</span><span lang="EN-US"> RS = 
"" </span><span style="FONT-FAMILY: 宋体">表示以</span> <span style="FONT-FAMILY: 宋体">空白行</span> <span style="FONT-FAMILY: 宋体">来分隔相邻的</span><span lang="EN-US">Records.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">RSTART</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">RSTART</span><span style="FONT-FAMILY: 宋体">与使用字串函数</span><span lang="EN-US"> match( )</span><span style="FONT-FAMILY: 宋体">有关的变量</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">详见下面说明</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">RLENGTH</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">RLENGTH</span><span style="FONT-FAMILY: 宋体">与使用字串函数</span><span lang="EN-US">match( )</span><span style="FONT-FAMILY: 宋体">有关之变量</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">当使用者使用</span><span lang="EN-US"> match(...) </span><span style="FONT-FAMILY: 宋体">函数后</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">会将</span><span lang="EN-US"> 
match(...) </span><span style="FONT-FAMILY: 宋体">执行的结果以</span><span lang="EN-US">RSTART,RLENGTH </span><span style="FONT-FAMILY: 宋体">记录</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">请参考</span> <span style="FONT-FAMILY: 宋体">附录</span><span lang="EN-US"> C awk</span><span style="FONT-FAMILY: 宋体">的内建函数</span><span lang="EN-US"> match().</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">SUBSEP</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">SUBSEP(Subscript Separator) </span><span style="FONT-FAMILY: 宋体">数组下标的分隔字符</span><span lang="EN-US">, </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">预设值为</span><span lang="EN-US">"\034"</span><span style="FONT-FAMILY: 宋体">实际上</span><span lang="EN-US">, awk</span><span style="FONT-FAMILY: 宋体">中的</span> <span style="FONT-FAMILY: 宋体">数组</span> <span style="FONT-FAMILY: 宋体">只接受</span> <span style="FONT-FAMILY: 宋体">字串</span> <span style="FONT-FAMILY: 宋体">当它的下标</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US">: Arr["John"].</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">但使用者在</span><span lang="EN-US"> 
awk </span><span style="FONT-FAMILY: 宋体">中仍可使用</span> <span style="FONT-FAMILY: 宋体">数字</span> <span style="FONT-FAMILY: 宋体">当阵列的下标</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">甚至可使用多维的数组</span><span lang="EN-US">(Multi-dimenisional 
Array) </span><span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US">: Arr[2,79] 
</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">事实上</span><span lang="EN-US">, 
awk</span><span style="FONT-FAMILY: 宋体">在接受</span><span lang="EN-US"> Arr[2,79] 
</span><span style="FONT-FAMILY: 宋体">之前</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">就已先把其下标转换成字串</span><span lang="EN-US">"2\03479", 
</span><span style="FONT-FAMILY: 宋体">之后便以</span><span lang="EN-US">Arr["2\03479"] 
</span><span style="FONT-FAMILY: 宋体">代替</span><span lang="EN-US"> 
Arr[2,79].</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">可参考下例</span><span lang="EN-US"> 
:</span></p>
<p class="a8"><span lang="EN-US">awk 'BEGIN { </span></p>
<p class="a8"><span lang="EN-US">Arr[2,79] = 78</span></p>
<p class="a8"><span lang="EN-US">print&nbsp; Arr[2,79]</span></p>
<p class="a8"><span lang="EN-US">print&nbsp; Arr[ 2 , 79 ]</span></p>
<p class="a8"><span lang="EN-US">print&nbsp; Arr["2\03479"]</span></p>
<p class="a8"><span lang="EN-US">idx = 2 SUBSEP 79</span></p>
<p class="a8"><span lang="EN-US">print Arr[idx]</span></p>
<p class="a8"><span lang="EN-US">}</span></p>
<p class="a8"><span lang="EN-US">' $*</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">执行结果输出</span><span lang="EN-US">:</span></p>
<p class="a8"><span lang="EN-US">78</span></p>
<p class="a8"><span lang="EN-US">78</span></p>
<p class="a8"><span lang="EN-US">78</span></p>
<p class="a8"><span lang="EN-US">78</span></p>
<h1><span lang="EN-US">16.<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">附录</span><span lang="EN-US">E 
── </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">正则表达式</span><span lang="EN-US">(Regular Expression) </span><span style="FONT-FAMILY: 文鼎PL细上海宋Uni">简介</span></h1>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span style="FONT-FAMILY: 宋体">为什么要使用正则表达式</span></b></p>
<p class="MsoBodyText"><span lang="EN-US">UNIX </span><span style="FONT-FAMILY: 宋体">中提供了许多</span> <span style="FONT-FAMILY: 宋体">指令</span> 
<span style="FONT-FAMILY: 宋体">和</span><span lang="EN-US"> tools, </span><span style="FONT-FAMILY: 宋体">它们具有在文件中</span> <span style="FONT-FAMILY: 宋体">查找</span><span lang="EN-US">(Search)</span><span style="FONT-FAMILY: 宋体">字串或替换</span><span lang="EN-US">(Replace)</span><span style="FONT-FAMILY: 宋体">字串</span> <span style="FONT-FAMILY: 宋体">的功能</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">像</span><span lang="EN-US"> 
grep, vi , sed, awk,...</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">不论是查找字串或替换字串</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">都得先告诉这些指令所要查找</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">被替换</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">的字串为何</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">若未能预先明确知道所要查找</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">被替换</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">的字串为何</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">只知该字串存在的范围或特征时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> 
:</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp; (</span><span style="FONT-FAMILY: 宋体">一</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">找寻</span><span lang="EN-US"> "T0.c", "T1.c", "T2.c".... 
"T9.c" </span><span style="FONT-FAMILY: 宋体">当中的任一字串</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">&nbsp;(</span><span style="FONT-FAMILY: 宋体">二</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">找寻至少存在一个</span><span lang="EN-US"> "A"</span><span style="FONT-FAMILY: 宋体">的任意字串</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">这情?下</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">如何告知执行查找字串的指令所要查找的字串为何</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US"> 
(</span><span style="FONT-FAMILY: 宋体">一</span><span lang="EN-US">) </span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">要查找任一在</span><span lang="EN-US"> "T" </span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> ".c" </span><span style="FONT-FAMILY: 宋体">之间存在一个阿拉伯数字的字串</span><span lang="EN-US">;</span><span style="FONT-FAMILY: 宋体">当然您可以列举的方式</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">一一把所要找寻的字串告诉执行命令的指令</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">但例</span><span lang="EN-US"> (</span><span style="FONT-FAMILY: 宋体">二</span><span lang="EN-US">) </span><span style="FONT-FAMILY: 宋体">中合乎该条件的字串有无限种可能</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">势必无法一一列举</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">此时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">便需要另一种字串表示的方法</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">协定</span><span lang="EN-US">).</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span style="FONT-FAMILY: 宋体">什么是正则表达式</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">正则表达式</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">以下简称</span><span lang="EN-US"> 
Regexp)</span><span style="FONT-FAMILY: 宋体">是一种字串表达的方式</span><span lang="EN-US">. 
</span><span style="FONT-FAMILY: 宋体">可用以指定具有某特征的所有字串</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">注</span><span lang="EN-US">: 
</span><span style="FONT-FAMILY: 宋体">为区别于一般字串</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">本附录中代表</span><span lang="EN-US"> Regexp 
</span><span style="FONT-FAMILY: 宋体">的字串之前皆加</span><span lang="EN-US"> "Regexp". 
awk </span><span style="FONT-FAMILY: 宋体">程式中常以</span><span lang="EN-US">/..../</span><span style="FONT-FAMILY: 宋体">括住</span><span lang="EN-US"> 
Regexp; </span><span style="FONT-FAMILY: 宋体">以区别于一般字串</span><span lang="EN-US">. 
</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span style="FONT-FAMILY: 宋体">组成正则表达式的元素</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">普通字符</span> <span style="FONT-FAMILY: 宋体">除了</span><span lang="EN-US"> . * [ ] + ? ( ) \&nbsp; ^ $ 
</span><span style="FONT-FAMILY: 宋体">外之所有字符</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">由普通字符所组成的</span><span lang="EN-US">Regexp</span><span style="FONT-FAMILY: 宋体">其意义与原字串字面意义相同</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
Regexp "the" </span><span style="FONT-FAMILY: 宋体">与一般字串的</span><span lang="EN-US"> 
"the" </span><span style="FONT-FAMILY: 宋体">代表相同的意义</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">. (Meta character) : </span><span style="FONT-FAMILY: 宋体">用以代表任意一字符</span><span lang="EN-US">. </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">须留心</span><span lang="EN-US"> 
UNIX Shell </span><span style="FONT-FAMILY: 宋体">中使用</span><span lang="EN-US"> 
"*"</span><span style="FONT-FAMILY: 宋体">表示</span><span lang="EN-US"> Wild card, 
</span><span style="FONT-FAMILY: 宋体">可用以代表任意长度的字串</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">而</span><span lang="EN-US"> 
Regexp </span><span style="FONT-FAMILY: 宋体">中使用</span><span lang="EN-US"> "." 
</span><span style="FONT-FAMILY: 宋体">来代表一个任意字符</span><span lang="EN-US">.(</span><span style="FONT-FAMILY: 宋体">注意</span><span lang="EN-US">: 
</span><span style="FONT-FAMILY: 宋体">并非任意长度的字串</span><span lang="EN-US">)Regexp 
</span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US"> "*" </span><span style="FONT-FAMILY: 宋体">另有其它涵意</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">并不代表任意长度的字串</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">^ </span><span style="FONT-FAMILY: 宋体">表示该字串必须出现于行首</span><span lang="EN-US">.&nbsp;&nbsp; 
</span></p>
<p class="MsoBodyText"><span lang="EN-US">$ </span><span style="FONT-FAMILY: 宋体">表示该字串必须出现于行末</span><span lang="EN-US">.&nbsp; </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> 
:</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp /^The/ </span><span style="FONT-FAMILY: 宋体">用以表示所有出现于行首的字串</span><span lang="EN-US"> "The".</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp /The$/ </span><span style="FONT-FAMILY: 宋体">用以表示所有出现于行末字串</span><span lang="EN-US"> "The".</span></p>
<p class="MsoBodyText"><span lang="EN-US">\ </span><span style="FONT-FAMILY: 宋体">将特殊字符还原成字面意义的字符</span><span lang="EN-US">(Escape 
character)</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp </span><span style="FONT-FAMILY: 宋体">中特殊字符将被解释成特定的意义</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">若要表示特殊字符的字面</span><span lang="EN-US">(literal 
meaning)</span><span style="FONT-FAMILY: 宋体">意义时</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">在特殊字符之前加上</span><span lang="EN-US">"\"</span><span style="FONT-FAMILY: 宋体">即可</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> 
:</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">使用</span><span lang="EN-US">Regexp</span><span style="FONT-FAMILY: 宋体">来表示字串</span><span lang="EN-US"> "a.out"</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">不可写成</span><span lang="EN-US"> 
/a.out/.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">因为</span><span lang="EN-US"> 
"."</span><span style="FONT-FAMILY: 宋体">是特殊字符</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">表任一字符</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">可符合</span><span lang="EN-US"> Regexp / a.out/ </span><span style="FONT-FAMILY: 宋体">的字串将不只</span><span lang="EN-US"> "a.out" </span><span style="FONT-FAMILY: 宋体">一个</span><span lang="EN-US">; </span><span style="FONT-FAMILY: 宋体">字串</span><span lang="EN-US"> "a2out", "a3out", "aaout" 
...</span><span style="FONT-FAMILY: 宋体">都符合</span><span lang="EN-US"> Regexp 
/a.out/&nbsp; </span><span style="FONT-FAMILY: 宋体">正确的用法为</span><span lang="EN-US">:&nbsp; / a\.out/</span></p>
<p class="MsoBodyText"><span lang="EN-US">[...]</span><span style="FONT-FAMILY: 宋体">字符集合</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">用以表示两中括号间所有的字符当中的任一个</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp /[Tt]/ </span><span style="FONT-FAMILY: 宋体">可用以表示字符</span><span lang="EN-US"> "T" </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> "t".</span><span style="FONT-FAMILY: 宋体">故</span><span lang="EN-US"> Regexp /[Tt]he/ </span><span style="FONT-FAMILY: 宋体">表示</span> <span style="FONT-FAMILY: 宋体">字串</span><span lang="EN-US"> "The" </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> 
"the".</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">字符集合</span><span lang="EN-US"> 
[...] </span><span style="FONT-FAMILY: 宋体">内不可随意留空白</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
Regexp /[ Tt ]/ </span><span style="FONT-FAMILY: 宋体">其中括号内有空白字符</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">除表示</span><span lang="EN-US">"T", "t" </span><span style="FONT-FAMILY: 宋体">中任一个字符</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">也可代表一个</span><span lang="EN-US"> 
" "(</span><span style="FONT-FAMILY: 宋体">空白字符</span><span lang="EN-US">)</span></p>
<p class="MsoBodyText"><span lang="EN-US">- </span><span style="FONT-FAMILY: 宋体">字符集合中可使用</span><span lang="EN-US"> "-" </span><span style="FONT-FAMILY: 宋体">来指定字符的区间</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">其用法如下</span><span lang="EN-US">:</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp /[0-9]/ </span><span style="FONT-FAMILY: 宋体">等于</span><span lang="EN-US"> /[0123456789]/ </span><span style="FONT-FAMILY: 宋体">用以表示任意一个阿拉伯数字</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">同理</span><span lang="EN-US"> 
Regexp /[A-Z]/ </span><span style="FONT-FAMILY: 宋体">用以表示任意一个大写英文字母</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">但应留心</span><span lang="EN-US">:</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp /[0-9a-z]/ </span><span style="FONT-FAMILY: 宋体">并不等于</span><span lang="EN-US"> /[0-9][a-z]/; </span><span style="FONT-FAMILY: 宋体">前者表示一个字符</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">后者表示二个字符</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp /[-9]/ </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> /[9-]/ </span><span style="FONT-FAMILY: 宋体">只代表字符</span><span lang="EN-US"> "9"</span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> "-".</span></p>
<p class="MsoBodyText"><span lang="EN-US">[^...]</span><span style="FONT-FAMILY: 宋体">使用</span><span lang="EN-US">[^..] </span><span style="FONT-FAMILY: 宋体">产生字符集合的补集</span><span lang="EN-US">(complement 
set).</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">其用法如下</span><span lang="EN-US"> 
:</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
</span><span style="FONT-FAMILY: 宋体">要指定</span><span lang="EN-US"> "T" 
</span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> "t" </span><span style="FONT-FAMILY: 宋体">之外的任一个字符</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">可用</span><span lang="EN-US"> /[^Tt]/ </span><span style="FONT-FAMILY: 宋体">表之</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">同理</span><span lang="EN-US"> 
Regexp /[^a-zA-Z]/ </span><span style="FONT-FAMILY: 宋体">表示英文字母之外的任一个字符</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">须留心</span><span lang="EN-US"> 
"^" </span><span style="FONT-FAMILY: 宋体">的位置</span><span lang="EN-US"> : 
"^"</span><span style="FONT-FAMILY: 宋体">必须紧接於</span><span lang="EN-US">"["</span><span style="FONT-FAMILY: 宋体">之后</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">才代表字符集合的补集</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> 
:Regexp /[0-9\^]/ </span><span style="FONT-FAMILY: 宋体">只是用以表示一个阿拉伯数字或字符</span><span lang="EN-US">"^".</span></p>
<p class="MsoBodyText"><span lang="EN-US">* </span><span style="FONT-FAMILY: 宋体">形容字符重复次数的特殊字符</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">"*" </span><span style="FONT-FAMILY: 宋体">形容它前方之字符可出现</span><span lang="EN-US"> 1 </span><span style="FONT-FAMILY: 宋体">次或多次</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">或不出现</span><span lang="EN-US">(0</span><span style="FONT-FAMILY: 宋体">次</span><span lang="EN-US">).</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">:</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp /T[0-9]*\.c/ </span><span style="FONT-FAMILY: 宋体">中</span><span lang="EN-US"> * </span><span style="FONT-FAMILY: 宋体">形容其前</span><span lang="EN-US"> [0-9] (</span><span style="FONT-FAMILY: 宋体">一个阿拉伯数字</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">出现的次数可为</span><span lang="EN-US"> 0</span><span style="FONT-FAMILY: 宋体">次或</span> <span style="FONT-FAMILY: 宋体">多次</span><span lang="EN-US">.</span><span style="FONT-FAMILY: 宋体">故</span><span lang="EN-US">Regexp 
/T[0-9]*\.c/ </span><span style="FONT-FAMILY: 宋体">可用以表示</span><span lang="EN-US">"T.c", "T0.c", "T1.c"..."T19.c"</span></p>
<p class="MsoBodyText"><span lang="EN-US">+</span><span style="FONT-FAMILY: 宋体">形容其前的字符出现一次或一次以上</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp /[0-9]+/ </span><span style="FONT-FAMILY: 宋体">用以表示一位或一位以上的数字</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">?&nbsp; </span><span style="FONT-FAMILY: 宋体">形容其前的字符可出现一次或不出现</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">:</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp /[+-]?[0-9]+/ </span><span style="FONT-FAMILY: 宋体">表示数字</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">一位以上</span><span lang="EN-US">)</span><span style="FONT-FAMILY: 宋体">之前可出现正负号或不出现正负号</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span lang="EN-US">(...)</span><span style="FONT-FAMILY: 宋体">用以括住一群字符</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">且将之视成一个</span><span lang="EN-US">group(</span><span style="FONT-FAMILY: 宋体">见下面说明</span><span lang="EN-US">)</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US"> : 
</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp /12+/&nbsp;&nbsp; </span><span style="FONT-FAMILY: 宋体">表示字串</span><span lang="EN-US"> "12", "122", "1222", 
"12222",...</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp /(12)+/ </span><span style="FONT-FAMILY: 宋体">表示字串</span><span lang="EN-US"> "12", "1212", "121212", 
"12121212"....</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">上式中</span><span lang="EN-US"> 
12 </span><span style="FONT-FAMILY: 宋体">以</span><span lang="EN-US">( )</span><span style="FONT-FAMILY: 宋体">括住</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">故</span><span lang="EN-US"> "+" </span><span style="FONT-FAMILY: 宋体">所形容的是</span><span lang="EN-US"> 12, </span><span style="FONT-FAMILY: 宋体">重复出现的也是</span><span lang="EN-US"> 12.</span></p>
<p class="MsoBodyText"><span lang="EN-US">| </span><span style="FONT-FAMILY: 宋体">表示逻辑上的</span><span lang="EN-US">"</span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US">"(or)</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">: 
</span></p>
<p class="MsoBodyText"><span lang="EN-US">Regexp / Oranges? | apples?&nbsp; | water/ 
</span><span style="FONT-FAMILY: 宋体">可用以表示</span><span lang="EN-US"> :&nbsp; 
</span><span style="FONT-FAMILY: 宋体">字串</span><span lang="EN-US"> "Orange", 
"Oranges" </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> 
"apple", "apples"&nbsp; </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> "water"</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">match</span></b><b><span style="FONT-FAMILY: 宋体">是什么</span><span lang="EN-US">?&nbsp; </span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">讨论</span><span lang="EN-US"> 
Regexp </span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">经常遇到</span><span lang="EN-US"> "</span><span style="FONT-FAMILY: 宋体">某字串匹配</span><span lang="EN-US">( match )</span><span style="FONT-FAMILY: 宋体">某</span><span lang="EN-US"> Regexp"</span><span style="FONT-FAMILY: 宋体">的字眼</span><span lang="EN-US">. </span><span style="FONT-FAMILY: 宋体">其意思为</span><span lang="EN-US"> :&nbsp; "</span><span style="FONT-FAMILY: 宋体">这个</span><span lang="EN-US"> Regexp </span><span style="FONT-FAMILY: 宋体">可被解释成该字串</span><span lang="EN-US">".</span></p>
<p class="MsoBodyText"><span lang="EN-US">[ </span><span style="FONT-FAMILY: 宋体">例如</span><span lang="EN-US">] : </span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">字串</span><span lang="EN-US"> 
"the" </span><span style="FONT-FAMILY: 宋体">匹配</span><span lang="EN-US">(match) 
Regexp /[Tt]he/.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">因为</span><span lang="EN-US"> 
Regexp /[Tt]he/ </span><span style="FONT-FAMILY: 宋体">可解释成字串</span><span lang="EN-US"> "the" </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> 
"The", </span><span style="FONT-FAMILY: 宋体">故字串</span><span lang="EN-US"> "the" 
</span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> "The"</span><span style="FONT-FAMILY: 宋体">都匹配</span><span lang="EN-US">(match) Regexp 
/[Th]he/.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span lang="EN-US">awk </span></b><b><span style="FONT-FAMILY: 宋体">中提供二个关系运算符</span><span lang="EN-US">(Relational 
Operator,</span></b><b><span style="FONT-FAMILY: 宋体">见注一</span><span lang="EN-US">) ~&nbsp;&nbsp; !~, </span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">它们也称之为</span><span lang="EN-US"> match, not match.</span><span style="FONT-FAMILY: 宋体">但函义与一般常称的</span><span lang="EN-US"> match </span><span style="FONT-FAMILY: 宋体">略有不同</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">其定义如下</span><span lang="EN-US">: </span></p>
<p class="MsoBodyText"><span lang="EN-US">A&nbsp; </span><span style="FONT-FAMILY: 宋体">表一字串</span><span lang="EN-US">, B </span><span style="FONT-FAMILY: 宋体">表一</span><span lang="EN-US"> Regular Expression</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">只要</span><span lang="EN-US"> A 
</span><span style="FONT-FAMILY: 宋体">字串中存在有子字串可</span><span lang="EN-US"> match( 
</span><span style="FONT-FAMILY: 宋体">一般定义的</span><span lang="EN-US"> match) 
Regexp&nbsp; B , </span><span style="FONT-FAMILY: 宋体">则</span><span lang="EN-US"> 
A ~B </span><span style="FONT-FAMILY: 宋体">就算成立</span><span lang="EN-US">, 
</span><span style="FONT-FAMILY: 宋体">其值为</span><span lang="EN-US"> true, 
</span><span style="FONT-FAMILY: 宋体">反之则为</span><span lang="EN-US"> 
false.</span></p>
<p class="MsoBodyText"><span lang="EN-US">! ~ </span><span style="FONT-FAMILY: 宋体">的定义与</span><span lang="EN-US">~</span><span style="FONT-FAMILY: 宋体">恰好相反</span><span lang="EN-US">.</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">例</span> <span style="FONT-FAMILY: 宋体">如</span><span lang="EN-US"> : </span></p>
<p class="MsoBodyText"><span lang="EN-US">"another" </span><span style="FONT-FAMILY: 宋体">中含有子字串</span><span lang="EN-US"> "the" </span><span style="FONT-FAMILY: 宋体">可</span><span lang="EN-US"> match Regexp /[Tt]he/ , 
</span><span style="FONT-FAMILY: 宋体">所以</span></p>
<p class="MsoBodyText"><span lang="EN-US">"another" ~ /[Tt]he/&nbsp; </span><span style="FONT-FAMILY: 宋体">之值为</span><span lang="EN-US"> true.</span></p>
<p class="MsoBodyText"><span lang="EN-US">[</span><span style="FONT-FAMILY: 宋体">注</span> <span style="FONT-FAMILY: 宋体">一</span><span lang="EN-US">] : </span><span style="FONT-FAMILY: 宋体">有些论著不把这两个运算符</span><span lang="EN-US">( ~, !~)</span><span style="FONT-FAMILY: 宋体">与</span><span lang="EN-US"> Relational Operators </span><span style="FONT-FAMILY: 宋体">归为一类</span><span lang="EN-US">.</span></p>
<p class="MsoNormal" style="MARGIN-LEFT: 36pt; TEXT-INDENT: -18pt"><span style="FONT-SIZE: 9pt; FONT-FAMILY: Wingdings" lang="EN-US">l<span style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</span></span><b><span style="FONT-FAMILY: 宋体">应用</span> <span lang="EN-US">Regular Expression </span></b><b><span style="FONT-FAMILY: 宋体">解题的简例</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">下面列出一些应用</span><span lang="EN-US"> Regular Expression </span><span style="FONT-FAMILY: 宋体">的简例</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">部分范例中会更改</span><span lang="EN-US">$0 </span><span style="FONT-FAMILY: 宋体">之值</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">若您使用的</span><span lang="EN-US"> awk</span><span style="FONT-FAMILY: 宋体">不允许用户更改</span><span lang="EN-US"> $0</span><span style="FONT-FAMILY: 宋体">时</span><span lang="EN-US">, </span><span style="FONT-FAMILY: 宋体">请改用</span><span lang="EN-US"> gawk.&nbsp;&nbsp; 
</span></p>
<p class="MsoBodyText"><b><span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US">1:</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">将文件中所有的字串</span><span lang="EN-US"> "Regular Expression" </span><span style="FONT-FAMILY: 宋体">或</span><span lang="EN-US"> "Regular expression" 
</span><span style="FONT-FAMILY: 宋体">换成</span><span lang="EN-US"> 
"Regexp"</span></p>
<p class="a8"><span lang="EN-US">awk '</span></p>
<p class="a8"><span lang="EN-US">{ gsub( /Regular[ \t]+[Ee]xpression/, "Regexp") 
</span></p>
<p class="a8"><span lang="EN-US">print</span></p>
<p class="a8"><span lang="EN-US">}</span></p>
<p class="a8"><span lang="EN-US">' $*</span></p>
<p class="MsoBodyText"><b><span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US">2:</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">去除文件中的空白行</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">或仅含空白字符或</span><span lang="EN-US">tab</span><span style="FONT-FAMILY: 宋体">的行</span><span lang="EN-US">)</span></p>
<p class="a8"><span lang="EN-US">awk '$0 !~ /^[ \t]*$/ { print }' $*</span></p>
<p class="MsoBodyText"><b><span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US">3:</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">在文件中具有</span><span lang="EN-US"> ddd-dddd (</span><span style="FONT-FAMILY: 宋体">电话号码型态</span><span lang="EN-US">, d </span><span style="FONT-FAMILY: 宋体">表</span><span lang="EN-US">digital)</span><span style="FONT-FAMILY: 宋体">的字串前加上</span><span lang="EN-US">"TEL : "</span></p>
<p class="a8"><span lang="EN-US">awk '</span></p>
<p class="a8"><span lang="EN-US">{ gsub( /[0-9][0-9][0-9]-[0-9][0-9][0-9][0-9]/, 
"TEL : &amp;" )</span></p>
<p class="a8"><span lang="EN-US">print</span></p>
<p class="a8"><span lang="EN-US">}</span></p>
<p class="a8"><span lang="EN-US">' $*</span></p>
<p class="MsoBodyText"><b><span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US">4:</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">从文件的</span><span lang="EN-US"> 
Fullname </span><span style="FONT-FAMILY: 宋体">中分离出</span> <span style="FONT-FAMILY: 宋体">路径</span> <span style="FONT-FAMILY: 宋体">与</span> <span style="FONT-FAMILY: 宋体">档名</span></p>
<p class="a8"><span lang="EN-US">awk '</span></p>
<p class="a8"><span lang="EN-US">BEGIN{</span></p>
<p class="a8"><span lang="EN-US">Fullname = "/usr/local/bin/xdvi"</span></p>
<p class="a8"><span lang="EN-US">match( Fullname, /.*\//)</span></p>
<p class="a8"><span lang="EN-US">path = substr(Fullname, 1, RLENGTH-1)</span></p>
<p class="a8"><span lang="EN-US">name = substr(Fullname, RLENGTH+1)</span></p>
<p class="a8"><span lang="EN-US">print "path :", path,"&nbsp; name 
:",name</span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">' $*</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">结果印出</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">path : /usr/local/bin&nbsp;&nbsp; name : xdvi 
</span></p>
<p class="MsoBodyText"><b><span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US">5:</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">将某一数值改以现金表示法表示</span><span lang="EN-US">(</span><span style="FONT-FAMILY: 宋体">整数部分每三位加一撇</span><span lang="EN-US">,</span><span style="FONT-FAMILY: 宋体">且含二位小数</span><span lang="EN-US">)</span></p>
<p class="a8"><span lang="EN-US">awk ' </span></p>
<p class="a8"><span lang="EN-US">BEGIN {</span></p>
<p class="a8"><span lang="EN-US">Number = 123456789</span></p>
<p class="a8"><span lang="EN-US">Number = sprintf("$%.2f",Number)</span></p>
<p class="a8"><span lang="EN-US">while( match(Number,/[0-9][0-9][0-9][0-9]/ ) 
)</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; sub(/[0-9][0-9][0-9][.,]/, 
",&amp;", Number)</span></p>
<p class="a8"><span lang="EN-US">print Number</span></p>
<p class="a8"><span lang="EN-US">}</span></p>
<p class="a8"><span lang="EN-US">' $*</span></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">结果输出</span><span lang="EN-US"> 
</span></p>
<p class="a8"><span lang="EN-US">$123,456,789.00</span></p>
<p class="MsoBodyText"><b><span style="FONT-FAMILY: 宋体">例</span><span lang="EN-US">6:</span></b></p>
<p class="MsoBodyText"><span style="FONT-FAMILY: 宋体">把文件中所有具</span><span lang="EN-US"> "program</span><span style="FONT-FAMILY: 宋体">数字</span><span lang="EN-US">.f"</span><span style="FONT-FAMILY: 宋体">形态的字串改为</span><span lang="EN-US">"[Ref : program</span><span style="FONT-FAMILY: 宋体">数字</span><span lang="EN-US">.c]"</span></p>
<p class="a8"><span lang="EN-US">awk '</span></p>
<p class="a8"><span lang="EN-US">{ </span></p>
<p class="a8"><span lang="EN-US">while( match( $0, /program[0-9]+\.f/ )&nbsp; 
){</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; Replace = "[Ref : " substr( $0, 
RSTART, RLENGTH-2) ".c]"</span></p>
<p class="a8"><span lang="EN-US">&nbsp;&nbsp;&nbsp; sub( /program[0-9]+\.f/, 
Replace)</span></p>
<p class="a8"><span lang="EN-US">} </span></p>
<p class="a8"><span lang="EN-US">print</span></p>
<p class="a8"><span lang="EN-US">}</span></p>
<p class="a8"><span lang="EN-US">' $*</span></p></div>

<div style="display:none">
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="awk_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-8234542-1");
pageTracker._trackPageview();
} catch(err) {}</script>
<script src="awk_files/stat.php" language="JavaScript"></script><script src="awk_files/cnzz_core.php" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=2836070" target="_blank" title="站长统计">站长统计</a>
</div>


</body></html>